<!DOCTYPE html><html lang=zh class=no-js data-version=v19.14 data-single-page=false> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link href=https://clickhouse.yandex/docs/zh/getting_started/example_datasets/nyc_taxi/ rel=canonical><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=zh><meta name=lang:search.pipeline.stopwords content><meta name=lang:search.pipeline.trimmer content><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><title>纽约市出租车数据 - ClickHouse文档 v19.14</title><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css><link rel=stylesheet href=../../../assets/stylesheets/application.2a88008a.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.792431c1.css><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=../../../assets/stylesheets/custom.css?1582323801></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=white class=md-lang-zh> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=drawer> <input class=md-toggle data-md-toggle=search type=checkbox id=search> <label class=md-overlay data-md-component=overlay for=drawer></label> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=/ title="ClickHouse文档 v19.14" class="md-header-nav__button md-logo"> <img src=../../../images/logo.svg width=40 height=40> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> ClickHouse文档 v19.14 </span> <span class=md-header-nav__topic> 纽约市出租车数据 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=search></label> <div class=md-search__inner> <form class=md-search__form name=search> <input type=text id=md-search__input class=md-search__input name=query required placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false> <label class="md-icon md-search__icon" for=search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset>&#xE5CD;</button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div id=md-language-switch class=md-header-nav__source> <a class=md-alt-lang href=../../../../en/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 60 30" preserveaspectratio=none> <clippath id=t> <path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/> </clippath> <path fill=#00247d d="M0,0 v30 h60 v-30 z"/> <path stroke=#fff stroke-width=6 d="M0,0 L60,30 M60,0 L0,30"/> <path clip-path=url(#t) stroke=#cf142b stroke-width=4 d="M0,0 L60,30 M60,0 L0,30"/> <path stroke=#fff stroke-width=10 d="M30,0 v30 M0,15 h60"/> <path stroke=#cf142b stroke-width=6 d="M30,0 v30 M0,15 h60"/> </svg> </a> <a class=md-alt-lang href=../../../../ru/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Russian> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 9 6" preserveaspectratio=none> <rect fill=#fff width=9 height=3 /> <rect fill=#d52b1e y=3 width=9 height=3 /> <rect fill=#0039a6 y=2 width=9 height=2 /> </svg> </a> <a class="md-alt-lang md-current-lang" href=../../../../zh/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Chinese> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewbox="0 0 30 20" preserveaspectratio=none> <defs> <path id=s fill=#ffde00 d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/> </defs> <rect width=30 height=20 fill=#de2910 /> <use xlink:href=#s transform="translate(5,5) scale(3)"/> <use xlink:href=#s transform="translate(10,2) rotate(23.036243)"/> <use xlink:href=#s transform="translate(12,4) rotate(45.869898)"/> <use xlink:href=#s transform="translate(12,7) rotate(69.945396)"/> <use xlink:href=#s transform="translate(10,9) rotate(20.659808)"/> </svg> </a> <a class=md-alt-lang href=../../../../ja/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Japanese> <?xml version="1.0" encoding="UTF-8"?> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink width=90px height=60px viewbox="0 0 90 60" version=1.1> <g id=surface1> <rect x=0 y=0 width=90 height=60 style=fill:rgb(62.7451%,62.7451%,62.7451%);fill-opacity:1;stroke:none; /> <path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562 "/> <path style=" stroke:none;fill-rule:nonzero;fill:rgb(74.509805%,0%,14.901961%);fill-opacity:1;" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30 "/> </g> </svg> </a> <a class=md-alt-lang href=../../../../fa/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Farsi> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewbox="0 0 630 360" preserveaspectratio=none> <rect width=630 height=360 fill=#da0000 /> <rect width=630 height=240 fill=#fff /> <rect width=630 height=120 fill=#239f40 /> <g transform=translate(8.4,100.4)> <g id=tb4> <g id=tb1 fill=none stroke=#fff stroke-width=2> <path id=tbp1 d=M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9 transform=scale(1.4) /> <path id=tbp2 d=M0,7H9M10,7H19 transform=scale(2.8) /> <use xlink:href=#tbp2 y=120 /> <use xlink:href=#tbp1 y=145.2 /> </g> <g id=tb3> <use xlink:href=#tb1 x=56 /> <use xlink:href=#tb1 x=112 /> <use xlink:href=#tb1 x=168 /> </g> </g> <use xlink:href=#tb3 x=168 /> <use xlink:href=#tb4 x=392 /> </g> <g fill=#da0000 transform=matrix(45,0,0,45,315,180)> <g id=emblem_half> <path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/> <path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/> <path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/> <path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/> </g> <use xlink:href=#emblem_half transform=scale(-1,1) /> </g> </svg> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=drawer> ClickHouse文档 v19.14 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> 介绍 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> 介绍 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ title=概貌 class=md-nav__link> 概貌 </a> </li> <li class=md-nav__item> <a href=../../../introduction/distinctive_features/ title=ClickHouse的独特功能 class=md-nav__link> ClickHouse的独特功能 </a> </li> <li class=md-nav__item> <a href=../../../introduction/features_considered_disadvantages/ title=ClickHouse功能可被视为缺点 class=md-nav__link> ClickHouse功能可被视为缺点 </a> </li> <li class=md-nav__item> <a href=../../../introduction/performance/ title=性能 class=md-nav__link> 性能 </a> </li> <li class=md-nav__item> <a href=../../../introduction/ya_metrika_task/ title=Yandex.Metrica使用案例 class=md-nav__link> Yandex.Metrica使用案例 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> 入门指南 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> 入门指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting_started/ title=部署运行 class=md-nav__link> 部署运行 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2 checked> <label class=md-nav__link for=nav-2-2> 示例数据集 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> 示例数据集 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting_started/example_datasets/ontime/ title=航班飞行数据 class=md-nav__link> 航班飞行数据 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=toc> <label class="md-nav__link md-nav__link--active" for=toc> 纽约市出租车数据 </label> <a href=../../../getting_started/example_datasets/nyc_taxi/ title=纽约市出租车数据 class="md-nav__link md-nav__link--active"> <strong>纽约市出租车数据</strong> </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#zen-yang-dao-ru-yuan-shi-shu-ju title=怎样导入原始数据 class=md-nav__link> 怎样导入原始数据 </a> </li> <li class=md-nav__item> <a href=#dan-tai-fu-wu-qi-yun-xing-jie-guo title=单台服务器运行结果 class=md-nav__link> 单台服务器运行结果 </a> </li> <li class=md-nav__item> <a href=#zong-jie title=总结 class=md-nav__link> 总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../getting_started/example_datasets/amplab_benchmark/ title=AMPLab大数据基准测试 class=md-nav__link> AMPLab大数据基准测试 </a> </li> <li class=md-nav__item> <a href=../../../getting_started/example_datasets/wikistat/ title=维基访问数据 class=md-nav__link> 维基访问数据 </a> </li> <li class=md-nav__item> <a href=../../../getting_started/example_datasets/criteo/ title="Criteo TB级别点击日志" class=md-nav__link> Criteo TB级别点击日志 </a> </li> <li class=md-nav__item> <a href=../../../getting_started/example_datasets/star_schema/ title="Star Schema基准测试" class=md-nav__link> Star Schema基准测试 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> 客户端 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> 客户端 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../interfaces/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/cli/ title=命令行客户端接口 class=md-nav__link> 命令行客户端接口 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/tcp/ title="原生客户端接口 (TCP)" class=md-nav__link> 原生客户端接口 (TCP) </a> </li> <li class=md-nav__item> <a href=../../../interfaces/http/ title="HTTP 客户端接口" class=md-nav__link> HTTP 客户端接口 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/formats/ title=输入输出格式 class=md-nav__link> 输入输出格式 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/jdbc/ title="JDBC 驱动" class=md-nav__link> JDBC 驱动 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/odbc/ title="ODBC 驱动" class=md-nav__link> ODBC 驱动 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-8 type=checkbox id=nav-3-8> <label class=md-nav__link for=nav-3-8> 第三方 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-8> 第三方 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../interfaces/third-party/client_libraries/ title=客户端库 class=md-nav__link> 客户端库 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/third-party/integrations/ title=集成 class=md-nav__link> 集成 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/third-party/gui/ title=可视界面 class=md-nav__link> 可视界面 </a> </li> <li class=md-nav__item> <a href=../../../interfaces/third-party/proxy/ title=代理 class=md-nav__link> 代理 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> 数据类型 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> 数据类型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data_types/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../data_types/int_uint/ title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class=md-nav__link> UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64 </a> </li> <li class=md-nav__item> <a href=../../../data_types/float/ title="Float32, Float64" class=md-nav__link> Float32, Float64 </a> </li> <li class=md-nav__item> <a href=../../../data_types/decimal/ title=Decimal class=md-nav__link> Decimal </a> </li> <li class=md-nav__item> <a href=../../../data_types/boolean/ title="Boolean values" class=md-nav__link> Boolean values </a> </li> <li class=md-nav__item> <a href=../../../data_types/string/ title=String class=md-nav__link> String </a> </li> <li class=md-nav__item> <a href=../../../data_types/fixedstring/ title=FixedString(N) class=md-nav__link> FixedString(N) </a> </li> <li class=md-nav__item> <a href=../../../data_types/uuid/ title=UUID class=md-nav__link> UUID </a> </li> <li class=md-nav__item> <a href=../../../data_types/date/ title=Date class=md-nav__link> Date </a> </li> <li class=md-nav__item> <a href=../../../data_types/datetime/ title=DateTime class=md-nav__link> DateTime </a> </li> <li class=md-nav__item> <a href=../../../data_types/enum/ title=Enum class=md-nav__link> Enum </a> </li> <li class=md-nav__item> <a href=../../../data_types/array/ title=Array(T) class=md-nav__link> Array(T) </a> </li> <li class=md-nav__item> <a href=../../../data_types/nested_data_structures/aggregatefunction/ title="AggregateFunction(name, types_of_arguments...)" class=md-nav__link> AggregateFunction(name, types_of_arguments...) </a> </li> <li class=md-nav__item> <a href=../../../data_types/tuple/ title="Tuple(T1, T2, ...)" class=md-nav__link> Tuple(T1, T2, ...) </a> </li> <li class=md-nav__item> <a href=../../../data_types/nullable/ title=Nullable class=md-nav__link> Nullable </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-16 type=checkbox id=nav-4-16> <label class=md-nav__link for=nav-4-16> 嵌套数据结构 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-16> 嵌套数据结构 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data_types/nested_data_structures/nested/ title="Nested(Name1 Type1, Name2 Type2, ...)" class=md-nav__link> Nested(Name1 Type1, Name2 Type2, ...) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-17 type=checkbox id=nav-4-17> <label class=md-nav__link for=nav-4-17> 特殊数据类型 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-17> 特殊数据类型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data_types/special_data_types/expression/ title=Expression class=md-nav__link> Expression </a> </li> <li class=md-nav__item> <a href=../../../data_types/special_data_types/set/ title=Set class=md-nav__link> Set </a> </li> <li class=md-nav__item> <a href=../../../data_types/special_data_types/nothing/ title=Nothing class=md-nav__link> Nothing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-18 type=checkbox id=nav-4-18> <label class=md-nav__link for=nav-4-18> Domain类型 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-18> Domain类型 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../data_types/domains/overview/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../data_types/domains/ipv4/ title=IPv4 class=md-nav__link> IPv4 </a> </li> <li class=md-nav__item> <a href=../../../data_types/domains/ipv6/ title=IPv6 class=md-nav__link> IPv6 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> 数据库引擎 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> 数据库引擎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../database_engines/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../database_engines/mysql/ title=MySQL class=md-nav__link> MySQL </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> 表引擎 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> 表引擎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/table_engines/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> MergeTree </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> MergeTree </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/table_engines/mergetree/ title=MergeTree class=md-nav__link> MergeTree </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/replication/ title="Data Replication" class=md-nav__link> Data Replication </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/custom_partitioning_key/ title="Custom Partitioning Key" class=md-nav__link> Custom Partitioning Key </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/replacingmergetree/ title=ReplacingMergeTree class=md-nav__link> ReplacingMergeTree </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/summingmergetree/ title=SummingMergeTree class=md-nav__link> SummingMergeTree </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/aggregatingmergetree/ title=AggregatingMergeTree class=md-nav__link> AggregatingMergeTree </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/collapsingmergetree/ title=CollapsingMergeTree class=md-nav__link> CollapsingMergeTree </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/versionedcollapsingmergetree/ title=VersionedCollapsingMergeTree class=md-nav__link> VersionedCollapsingMergeTree </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/graphitemergetree/ title=GraphiteMergeTree class=md-nav__link> GraphiteMergeTree </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Log </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-3> Log </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/table_engines/log_family/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/stripelog/ title=StripeLog class=md-nav__link> StripeLog </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/log/ title=Log class=md-nav__link> Log </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/tinylog/ title=TinyLog class=md-nav__link> TinyLog </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> 外部表引擎 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-4> 外部表引擎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/table_engines/kafka/ title=Kafka class=md-nav__link> Kafka </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/mysql/ title=MySQL class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/jdbc/ title=JDBC class=md-nav__link> JDBC </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/odbc/ title=ODBC class=md-nav__link> ODBC </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-5 type=checkbox id=nav-6-5> <label class=md-nav__link for=nav-6-5> 其他表引擎 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-5> 其他表引擎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/table_engines/distributed/ title=Distributed class=md-nav__link> Distributed </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/external_data/ title="External data" class=md-nav__link> External data </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/dictionary/ title=Dictionary class=md-nav__link> Dictionary </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/merge/ title=Merge class=md-nav__link> Merge </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/file/ title=File class=md-nav__link> File </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/null/ title=Null class=md-nav__link> Null </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/set/ title=Set class=md-nav__link> Set </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/join/ title=Join class=md-nav__link> Join </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/url/ title=URL class=md-nav__link> URL </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/view/ title=View class=md-nav__link> View </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/materializedview/ title=MaterializedView class=md-nav__link> MaterializedView </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/memory/ title=Memory class=md-nav__link> Memory </a> </li> <li class=md-nav__item> <a href=../../../operations/table_engines/buffer/ title=Buffer class=md-nav__link> Buffer </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> SQL语法 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> SQL语法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../query_language/select/ title=SELECT class=md-nav__link> SELECT </a> </li> <li class=md-nav__item> <a href=../../../query_language/insert_into/ title="INSERT INTO" class=md-nav__link> INSERT INTO </a> </li> <li class=md-nav__item> <a href=../../../query_language/create/ title=CREATE class=md-nav__link> CREATE </a> </li> <li class=md-nav__item> <a href=../../../query_language/alter/ title=ALTER class=md-nav__link> ALTER </a> </li> <li class=md-nav__item> <a href=../../../query_language/system/ title=SYSTEM class=md-nav__link> SYSTEM </a> </li> <li class=md-nav__item> <a href=../../../query_language/misc/ title=其他类型的查询 class=md-nav__link> 其他类型的查询 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-8 type=checkbox id=nav-7-8> <label class=md-nav__link for=nav-7-8> 函数 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-8> 函数 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../query_language/functions/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/arithmetic_functions/ title=算术函数 class=md-nav__link> 算术函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/comparison_functions/ title=比较函数 class=md-nav__link> 比较函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/logical_functions/ title=逻辑函数 class=md-nav__link> 逻辑函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/type_conversion_functions/ title=类型转换函数 class=md-nav__link> 类型转换函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/date_time_functions/ title=时间日期函数 class=md-nav__link> 时间日期函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/string_functions/ title=字符串函数 class=md-nav__link> 字符串函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/string_search_functions/ title=字符串搜索函数 class=md-nav__link> 字符串搜索函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/string_replace_functions/ title=字符串替换函数 class=md-nav__link> 字符串替换函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/conditional_functions/ title="条件函数 " class=md-nav__link> 条件函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/math_functions/ title=数学函数 class=md-nav__link> 数学函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/rounding_functions/ title=取整函数 class=md-nav__link> 取整函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/array_functions/ title=数组函数 class=md-nav__link> 数组函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/splitting_merging_functions/ title=字符串拆分合并函数 class=md-nav__link> 字符串拆分合并函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/bit_functions/ title=位操作函数 class=md-nav__link> 位操作函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/bitmap_functions/ title=位图函数 class=md-nav__link> 位图函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/hash_functions/ title=Hash函数 class=md-nav__link> Hash函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/random_functions/ title=随机函数 class=md-nav__link> 随机函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/encoding_functions/ title=编码函数 class=md-nav__link> 编码函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/uuid_functions/ title=UUID函数 class=md-nav__link> UUID函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/url_functions/ title=URL函数 class=md-nav__link> URL函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/ip_address_functions/ title=IP函数 class=md-nav__link> IP函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/json_functions/ title=JSON函数 class=md-nav__link> JSON函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/higher_order_functions/ title=高阶函数 class=md-nav__link> 高阶函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/ext_dict_functions/ title=字典函数 class=md-nav__link> 字典函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/ym_dict_functions/ title=Yandex.Metrica字典函数 class=md-nav__link> Yandex.Metrica字典函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/in_functions/ title=IN运算符相关函数 class=md-nav__link> IN运算符相关函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/array_join/ title=arrayJoin函数 class=md-nav__link> arrayJoin函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/geo/ title=GEO函数 class=md-nav__link> GEO函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/functions_for_nulls/ title=Nullable处理函数 class=md-nav__link> Nullable处理函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/machine_learning_functions/ title=机器学习函数 class=md-nav__link> 机器学习函数 </a> </li> <li class=md-nav__item> <a href=../../../query_language/functions/other_functions/ title=其他函数 class=md-nav__link> 其他函数 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-9 type=checkbox id=nav-7-9> <label class=md-nav__link for=nav-7-9> 聚合函数 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-9> 聚合函数 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../query_language/agg_functions/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../query_language/agg_functions/reference/ title=函数列表 class=md-nav__link> 函数列表 </a> </li> <li class=md-nav__item> <a href=../../../query_language/agg_functions/combinators/ title=聚合函数组合子 class=md-nav__link> 聚合函数组合子 </a> </li> <li class=md-nav__item> <a href=../../../query_language/agg_functions/parametric_functions/ title=参数化聚合函数 class=md-nav__link> 参数化聚合函数 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-10 type=checkbox id=nav-7-10> <label class=md-nav__link for=nav-7-10> 表引擎函数 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-10> 表引擎函数 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../query_language/table_functions/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/file/ title=file class=md-nav__link> file </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/merge/ title=merge class=md-nav__link> merge </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/numbers/ title=numbers class=md-nav__link> numbers </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/remote/ title=remote class=md-nav__link> remote </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/url/ title=url class=md-nav__link> url </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/mysql/ title=mysql class=md-nav__link> mysql </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/jdbc/ title=jdbc class=md-nav__link> jdbc </a> </li> <li class=md-nav__item> <a href=../../../query_language/table_functions/odbc/ title=odbc class=md-nav__link> odbc </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-11 type=checkbox id=nav-7-11> <label class=md-nav__link for=nav-7-11> 字典 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-11> 字典 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../query_language/dicts/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-11-2 type=checkbox id=nav-7-11-2> <label class=md-nav__link for=nav-7-11-2> 外部字典 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-7-11-2> 外部字典 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../query_language/dicts/external_dicts/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../query_language/dicts/external_dicts_dict/ title=配置外部字典 class=md-nav__link> 配置外部字典 </a> </li> <li class=md-nav__item> <a href=../../../query_language/dicts/external_dicts_dict_layout/ title=字典的内存布局 class=md-nav__link> 字典的内存布局 </a> </li> <li class=md-nav__item> <a href=../../../query_language/dicts/external_dicts_dict_lifetime/ title=字典的刷新策略 class=md-nav__link> 字典的刷新策略 </a> </li> <li class=md-nav__item> <a href=../../../query_language/dicts/external_dicts_dict_sources/ title=字典的外部数据源 class=md-nav__link> 字典的外部数据源 </a> </li> <li class=md-nav__item> <a href=../../../query_language/dicts/external_dicts_dict_structure/ title=字典的键和字段值 class=md-nav__link> 字典的键和字段值 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../query_language/dicts/internal_dicts/ title=内部字典 class=md-nav__link> 内部字典 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../query_language/operators/ title=操作符 class=md-nav__link> 操作符 </a> </li> <li class=md-nav__item> <a href=../../../query_language/syntax/ title=语法说明 class=md-nav__link> 语法说明 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> 运维 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> 运维 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../operations/requirements/ title=环境要求 class=md-nav__link> 环境要求 </a> </li> <li class=md-nav__item> <a href=../../../operations/monitoring/ title=监控 class=md-nav__link> 监控 </a> </li> <li class=md-nav__item> <a href=../../../operations/troubleshooting/ title=故障排查 class=md-nav__link> 故障排查 </a> </li> <li class=md-nav__item> <a href=../../../operations/tips/ title=使用建议 class=md-nav__link> 使用建议 </a> </li> <li class=md-nav__item> <a href=../../../operations/update/ title=版本升级 class=md-nav__link> 版本升级 </a> </li> <li class=md-nav__item> <a href=../../../operations/access_rights/ title=访问权限控制 class=md-nav__link> 访问权限控制 </a> </li> <li class=md-nav__item> <a href=../../../operations/backup/ title=数据备份 class=md-nav__link> 数据备份 </a> </li> <li class=md-nav__item> <a href=../../../operations/configuration_files/ title=配置文件 class=md-nav__link> 配置文件 </a> </li> <li class=md-nav__item> <a href=../../../operations/quotas/ title=配额 class=md-nav__link> 配额 </a> </li> <li class=md-nav__item> <a href=../../../operations/system_tables/ title=系统表 class=md-nav__link> 系统表 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-12 type=checkbox id=nav-8-12> <label class=md-nav__link for=nav-8-12> Server参数配置 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-12> Server参数配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/server_settings/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../operations/server_settings/settings/ title=Server参数说明 class=md-nav__link> Server参数说明 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-13 type=checkbox id=nav-8-13> <label class=md-nav__link for=nav-8-13> Settings配置 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-13> Settings配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/settings/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../operations/settings/permissions_for_queries/ title=查询权限管理 class=md-nav__link> 查询权限管理 </a> </li> <li class=md-nav__item> <a href=../../../operations/settings/query_complexity/ title=查询复杂性的限制 class=md-nav__link> 查询复杂性的限制 </a> </li> <li class=md-nav__item> <a href=../../../operations/settings/settings/ title=Setting列表 class=md-nav__link> Setting列表 </a> </li> <li class=md-nav__item> <a href=../../../operations/settings/settings_profiles/ title=Setting配置组 class=md-nav__link> Setting配置组 </a> </li> <li class=md-nav__item> <a href=../../../operations/settings/settings_users/ title=用户配置 class=md-nav__link> 用户配置 </a> </li> <li class=md-nav__item> <a href=../../../operations/settings/constraints_on_settings/ title=Settings的约束 class=md-nav__link> Settings的约束 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-14 type=checkbox id=nav-8-14> <label class=md-nav__link for=nav-8-14> 常用工具 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-14> 常用工具 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../operations/utils/ title=介绍 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=../../../operations/utils/clickhouse-copier/ title=clickhouse-copier class=md-nav__link> clickhouse-copier </a> </li> <li class=md-nav__item> <a href=../../../operations/utils/clickhouse-local/ title=clickhouse-local class=md-nav__link> clickhouse-local </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> 常见问题 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-9> 常见问题 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../faq/general/ title=一般的问题 class=md-nav__link> 一般的问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class=md-nav__link for=nav-10> 开发者指南 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-10> 开发者指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../development/architecture/ title=ClickHouse架构概述 class=md-nav__link> ClickHouse架构概述 </a> </li> <li class=md-nav__item> <a href=../../../development/build/ title=如何在Linux中编译ClickHouse class=md-nav__link> 如何在Linux中编译ClickHouse </a> </li> <li class=md-nav__item> <a href=../../../development/build_osx/ title="如何在Mac OS X中编译ClickHouse" class=md-nav__link> 如何在Mac OS X中编译ClickHouse </a> </li> <li class=md-nav__item> <a href=../../../development/style/ title=如何编写C++代码 class=md-nav__link> 如何编写C++代码 </a> </li> <li class=md-nav__item> <a href=../../../development/tests/ title=如何运行ClickHouse测试 class=md-nav__link> 如何运行ClickHouse测试 </a> </li> <li class=md-nav__item> <a href=../../../development/contrib/ title=使用的第三方库 class=md-nav__link> 使用的第三方库 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-11 type=checkbox id=nav-11> <label class=md-nav__link for=nav-11> 新功能特性 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-11> 新功能特性 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../roadmap/ title=路线图 class=md-nav__link> 路线图 </a> </li> <li class=md-nav__item> <a href=../../../changelog/ title=更新日志 class=md-nav__link> 更新日志 </a> </li> <li class=md-nav__item> <a href=../../../security_changelog/ title=安全更改日志 class=md-nav__link> 安全更改日志 </a> </li> </ul> </nav> </li> </ul> <ul id=md-extra-nav class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> 发布: <span class=md-selector> <select id=releases-selector> <option value>最新</option> <option value=v20.1>v20.1</option> <option value=v19.17>v19.17</option> <option value=v19.16>v19.16</option> <option value=v19.15>v19.15</option> <option value=v19.14 selected=selected>v19.14</option> <option value=v19.13>v19.13</option> <option value=v19.11>v19.11</option> <option value=v19.10>v19.10</option> <option value=v19.9>v19.9</option> <option value=v19.8>v19.8</option> <option value=v19.7>v19.7</option> </select><span id=releases-selector-after>&nbsp;▾</span> </span> </li> <li class="md-nav__item md-nav__item--active"> <a href=../../../single/ class="md-nav__link md-nav__link--active">单页版本</a> </li> <li class="md-nav__item md-nav__item--active"> <a href=../../../single/clickhouse_zh.pdf class="md-nav__link md-nav__link--active">PDF版本</a> </li> <li class="md-nav__item md-nav__item--active"> <a href=https://github.com/ClickHouse/ClickHouse/ rel="external nofollow" target=_blank class=md-nav__link> ClickHouse源代码 </a> </li> <li class="md-nav__item md-nav__item--active"> <span id=md-sidebar-flags class=md-nav__link> <a class=md-alt-lang href=../../../../en/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 60 30" preserveaspectratio=none> <clippath id=t> <path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/> </clippath> <path fill=#00247d d="M0,0 v30 h60 v-30 z"/> <path stroke=#fff stroke-width=6 d="M0,0 L60,30 M60,0 L0,30"/> <path clip-path=url(#t) stroke=#cf142b stroke-width=4 d="M0,0 L60,30 M60,0 L0,30"/> <path stroke=#fff stroke-width=10 d="M30,0 v30 M0,15 h60"/> <path stroke=#cf142b stroke-width=6 d="M30,0 v30 M0,15 h60"/> </svg> </a> <a class=md-alt-lang href=../../../../ru/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Russian> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 9 6" preserveaspectratio=none> <rect fill=#fff width=9 height=3 /> <rect fill=#d52b1e y=3 width=9 height=3 /> <rect fill=#0039a6 y=2 width=9 height=2 /> </svg> </a> <a class="md-alt-lang md-current-lang" href=../../../../zh/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Chinese> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewbox="0 0 30 20" preserveaspectratio=none> <defs> <path id=s fill=#ffde00 d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/> </defs> <rect width=30 height=20 fill=#de2910 /> <use xlink:href=#s transform="translate(5,5) scale(3)"/> <use xlink:href=#s transform="translate(10,2) rotate(23.036243)"/> <use xlink:href=#s transform="translate(12,4) rotate(45.869898)"/> <use xlink:href=#s transform="translate(12,7) rotate(69.945396)"/> <use xlink:href=#s transform="translate(10,9) rotate(20.659808)"/> </svg> </a> <a class=md-alt-lang href=../../../../ja/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Japanese> <?xml version="1.0" encoding="UTF-8"?> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink width=90px height=60px viewbox="0 0 90 60" version=1.1> <g id=surface1> <rect x=0 y=0 width=90 height=60 style=fill:rgb(62.7451%,62.7451%,62.7451%);fill-opacity:1;stroke:none; /> <path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562 "/> <path style=" stroke:none;fill-rule:nonzero;fill:rgb(74.509805%,0%,14.901961%);fill-opacity:1;" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30 "/> </g> </svg> </a> <a class=md-alt-lang href=../../../../fa/getting_started/example_datasets/nyc_taxi/ class="md-flex__ellipsis md-header-nav__title" title=Farsi> <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink viewbox="0 0 630 360" preserveaspectratio=none> <rect width=630 height=360 fill=#da0000 /> <rect width=630 height=240 fill=#fff /> <rect width=630 height=120 fill=#239f40 /> <g transform=translate(8.4,100.4)> <g id=tb4> <g id=tb1 fill=none stroke=#fff stroke-width=2> <path id=tbp1 d=M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9 transform=scale(1.4) /> <path id=tbp2 d=M0,7H9M10,7H19 transform=scale(2.8) /> <use xlink:href=#tbp2 y=120 /> <use xlink:href=#tbp1 y=145.2 /> </g> <g id=tb3> <use xlink:href=#tb1 x=56 /> <use xlink:href=#tb1 x=112 /> <use xlink:href=#tb1 x=168 /> </g> </g> <use xlink:href=#tb3 x=168 /> <use xlink:href=#tb4 x=392 /> </g> <g fill=#da0000 transform=matrix(45,0,0,45,315,180)> <g id=emblem_half> <path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/> <path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/> <path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/> <path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/> </g> <use xlink:href=#emblem_half transform=scale(-1,1) /> </g> </svg> </a> </span> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#zen-yang-dao-ru-yuan-shi-shu-ju title=怎样导入原始数据 class=md-nav__link> 怎样导入原始数据 </a> </li> <li class=md-nav__item> <a href=#dan-tai-fu-wu-qi-yun-xing-jie-guo title=单台服务器运行结果 class=md-nav__link> 单台服务器运行结果 </a> </li> <li class=md-nav__item> <a href=#zong-jie title=总结 class=md-nav__link> 总结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ClickHouse/ClickHouse/edit/master/docs/zh/getting_started/example_datasets/nyc_taxi.md title=编辑此页 class="md-icon md-content__icon" rel="external nofollow">&#xE3C9;</a> <div id=content> <h1 id=niu-yue-shi-chu-zu-che-shu-ju>纽约市出租车数据<a class=headerlink href=#niu-yue-shi-chu-zu-che-shu-ju title="Permanent link">&para;</a></h1> <h2 id=zen-yang-dao-ru-yuan-shi-shu-ju>怎样导入原始数据<a class=headerlink href=#zen-yang-dao-ru-yuan-shi-shu-ju title="Permanent link">&para;</a></h2> <p>可以参考<a href=https://github.com/toddwschneider/nyc-taxi-data rel="external nofollow">https://github.com/toddwschneider/nyc-taxi-data</a>和<a href=http://tech.marksblogg.com/billion-nyc-taxi-rides-redshift.html rel="external nofollow">http://tech.marksblogg.com/billion-nyc-taxi-rides-redshift.html</a>中的关于数据集结构描述与数据下载指令说明。</p> <p>数据集包含227GB的CSV文件。这大约需要一个小时的下载时间(1Gbit带宽下，并行下载大概是一半时间)。 下载时注意损坏的文件。可以检查文件大小并重新下载损坏的文件。</p> <p>有些文件中包含一些无效的行，您可以使用如下语句修复他们：</p> <div class=codehilite><pre><span></span>sed -E <span class=s1>&#39;/(.*,){18,}/d&#39;</span> data/yellow_tripdata_2010-02.csv &gt; data/yellow_tripdata_2010-02.csv_
sed -E <span class=s1>&#39;/(.*,){18,}/d&#39;</span> data/yellow_tripdata_2010-03.csv &gt; data/yellow_tripdata_2010-03.csv_
mv data/yellow_tripdata_2010-02.csv_ data/yellow_tripdata_2010-02.csv
mv data/yellow_tripdata_2010-03.csv_ data/yellow_tripdata_2010-03.csv
</pre></div> <p>然后您必须在PostgreSQL中预处理这些数据。这将创建多边形中的点（以匹配在地图中纽约市中范围），然后通过使用JOIN查询将数据关联组合到一个规范的表中。为了完成这部分操作，您需要安装PostgreSQL的同时安装PostGIS插件。</p> <p>运行<code>initialize_database.sh</code>时要小心，并手动重新检查是否正确创建了所有表。</p> <p>在PostgreSQL中处理每个月的数据大约需要20-30分钟，总共大约需要48小时。</p> <p>您可以按如下方式检查下载的行数：</p> <div class=codehilite><pre><span></span>time psql nyc-taxi-data -c &quot;SELECT count(*) FROM trips;&quot;
## Count
 1298979494
(1 row)

real    7m9.164s
</pre></div> <p>(根据Mark Litwintschik的系列博客报道数据略多余11亿行)</p> <p>PostgreSQL处理这些数据大概需要370GB的磁盘空间。</p> <p>从PostgreSQL中导出数据：</p> <div class=codehilite><pre><span></span><span class=k>COPY</span>
<span class=p>(</span>
    <span class=k>SELECT</span> <span class=n>trips</span><span class=p>.</span><span class=n>id</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>vendor_id</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>pickup_datetime</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>dropoff_datetime</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>store_and_fwd_flag</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>rate_code_id</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>pickup_longitude</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>pickup_latitude</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>dropoff_longitude</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>dropoff_latitude</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>passenger_count</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>trip_distance</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>fare_amount</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>extra</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>mta_tax</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>tip_amount</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>tolls_amount</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>ehail_fee</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>improvement_surcharge</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>total_amount</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>payment_type</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>trip_type</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>pickup</span><span class=p>,</span>
           <span class=n>trips</span><span class=p>.</span><span class=n>dropoff</span><span class=p>,</span>

           <span class=n>cab_types</span><span class=p>.</span><span class=k>type</span> <span class=n>cab_type</span><span class=p>,</span>

           <span class=n>weather</span><span class=p>.</span><span class=n>precipitation_tenths_of_mm</span> <span class=n>rain</span><span class=p>,</span>
           <span class=n>weather</span><span class=p>.</span><span class=n>snow_depth_mm</span><span class=p>,</span>
           <span class=n>weather</span><span class=p>.</span><span class=n>snowfall_mm</span><span class=p>,</span>
           <span class=n>weather</span><span class=p>.</span><span class=n>max_temperature_tenths_degrees_celsius</span> <span class=n>max_temp</span><span class=p>,</span>
           <span class=n>weather</span><span class=p>.</span><span class=n>min_temperature_tenths_degrees_celsius</span> <span class=n>min_temp</span><span class=p>,</span>
           <span class=n>weather</span><span class=p>.</span><span class=n>average_wind_speed_tenths_of_meters_per_second</span> <span class=n>wind</span><span class=p>,</span>

           <span class=n>pick_up</span><span class=p>.</span><span class=n>gid</span> <span class=n>pickup_nyct2010_gid</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>ctlabel</span> <span class=n>pickup_ctlabel</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>borocode</span> <span class=n>pickup_borocode</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>boroname</span> <span class=n>pickup_boroname</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>ct2010</span> <span class=n>pickup_ct2010</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>boroct2010</span> <span class=n>pickup_boroct2010</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>cdeligibil</span> <span class=n>pickup_cdeligibil</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>ntacode</span> <span class=n>pickup_ntacode</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>ntaname</span> <span class=n>pickup_ntaname</span><span class=p>,</span>
           <span class=n>pick_up</span><span class=p>.</span><span class=n>puma</span> <span class=n>pickup_puma</span><span class=p>,</span>

           <span class=n>drop_off</span><span class=p>.</span><span class=n>gid</span> <span class=n>dropoff_nyct2010_gid</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>ctlabel</span> <span class=n>dropoff_ctlabel</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>borocode</span> <span class=n>dropoff_borocode</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>boroname</span> <span class=n>dropoff_boroname</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>ct2010</span> <span class=n>dropoff_ct2010</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>boroct2010</span> <span class=n>dropoff_boroct2010</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>cdeligibil</span> <span class=n>dropoff_cdeligibil</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>ntacode</span> <span class=n>dropoff_ntacode</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>ntaname</span> <span class=n>dropoff_ntaname</span><span class=p>,</span>
           <span class=n>drop_off</span><span class=p>.</span><span class=n>puma</span> <span class=n>dropoff_puma</span>
    <span class=k>FROM</span> <span class=n>trips</span>
    <span class=k>LEFT</span> <span class=k>JOIN</span> <span class=n>cab_types</span>
        <span class=k>ON</span> <span class=n>trips</span><span class=p>.</span><span class=n>cab_type_id</span> <span class=o>=</span> <span class=n>cab_types</span><span class=p>.</span><span class=n>id</span>
    <span class=k>LEFT</span> <span class=k>JOIN</span> <span class=n>central_park_weather_observations_raw</span> <span class=n>weather</span>
        <span class=k>ON</span> <span class=n>weather</span><span class=p>.</span><span class=nb>date</span> <span class=o>=</span> <span class=n>trips</span><span class=p>.</span><span class=n>pickup_datetime</span><span class=p>::</span><span class=nb>date</span>
    <span class=k>LEFT</span> <span class=k>JOIN</span> <span class=n>nyct2010</span> <span class=n>pick_up</span>
        <span class=k>ON</span> <span class=n>pick_up</span><span class=p>.</span><span class=n>gid</span> <span class=o>=</span> <span class=n>trips</span><span class=p>.</span><span class=n>pickup_nyct2010_gid</span>
    <span class=k>LEFT</span> <span class=k>JOIN</span> <span class=n>nyct2010</span> <span class=n>drop_off</span>
        <span class=k>ON</span> <span class=n>drop_off</span><span class=p>.</span><span class=n>gid</span> <span class=o>=</span> <span class=n>trips</span><span class=p>.</span><span class=n>dropoff_nyct2010_gid</span>
<span class=p>)</span> <span class=k>TO</span> <span class=s1>&#39;/opt/milovidov/nyc-taxi-data/trips.tsv&#39;</span><span class=p>;</span>
</pre></div> <p>数据快照的创建速度约为每秒50 MB。 在创建快照时，PostgreSQL以每秒约28 MB的速度从磁盘读取数据。 这大约需要5个小时。 最终生成的TSV文件为590612904969 bytes。</p> <p>在ClickHouse中创建临时表：</p> <div class=codehilite><pre><span></span><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>trips</span>
<span class=p>(</span>
<span class=n>trip_id</span>                 <span class=n>UInt32</span><span class=p>,</span>
<span class=n>vendor_id</span>               <span class=n>String</span><span class=p>,</span>
<span class=n>pickup_datetime</span>         <span class=n>DateTime</span><span class=p>,</span>
<span class=n>dropoff_datetime</span>        <span class=k>Nullable</span><span class=p>(</span><span class=n>DateTime</span><span class=p>),</span>
<span class=n>store_and_fwd_flag</span>      <span class=k>Nullable</span><span class=p>(</span><span class=n>FixedString</span><span class=p>(</span><span class=mi>1</span><span class=p>)),</span>
<span class=n>rate_code_id</span>            <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>pickup_longitude</span>        <span class=k>Nullable</span><span class=p>(</span><span class=n>Float64</span><span class=p>),</span>
<span class=n>pickup_latitude</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>Float64</span><span class=p>),</span>
<span class=n>dropoff_longitude</span>       <span class=k>Nullable</span><span class=p>(</span><span class=n>Float64</span><span class=p>),</span>
<span class=n>dropoff_latitude</span>        <span class=k>Nullable</span><span class=p>(</span><span class=n>Float64</span><span class=p>),</span>
<span class=n>passenger_count</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>trip_distance</span>           <span class=k>Nullable</span><span class=p>(</span><span class=n>Float64</span><span class=p>),</span>
<span class=n>fare_amount</span>             <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>extra</span>                   <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>mta_tax</span>                 <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>tip_amount</span>              <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>tolls_amount</span>            <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>ehail_fee</span>               <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>improvement_surcharge</span>   <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>total_amount</span>            <span class=k>Nullable</span><span class=p>(</span><span class=n>Float32</span><span class=p>),</span>
<span class=n>payment_type</span>            <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>trip_type</span>               <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>pickup</span>                  <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff</span>                 <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>cab_type</span>                <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>precipitation</span>           <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>snow_depth</span>              <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>snowfall</span>                <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>max_temperature</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>min_temperature</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>average_wind_speed</span>      <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>pickup_nyct2010_gid</span>     <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>pickup_ctlabel</span>          <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>pickup_borocode</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>pickup_boroname</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>pickup_ct2010</span>           <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>pickup_boroct2010</span>       <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>pickup_cdeligibil</span>       <span class=k>Nullable</span><span class=p>(</span><span class=n>FixedString</span><span class=p>(</span><span class=mi>1</span><span class=p>)),</span>
<span class=n>pickup_ntacode</span>          <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>pickup_ntaname</span>          <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>pickup_puma</span>             <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_nyct2010_gid</span>    <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>dropoff_ctlabel</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_borocode</span>        <span class=k>Nullable</span><span class=p>(</span><span class=n>UInt8</span><span class=p>),</span>
<span class=n>dropoff_boroname</span>        <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_ct2010</span>          <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_boroct2010</span>      <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_cdeligibil</span>      <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_ntacode</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_ntaname</span>         <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>),</span>
<span class=n>dropoff_puma</span>            <span class=k>Nullable</span><span class=p>(</span><span class=n>String</span><span class=p>)</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>Log</span><span class=p>;</span>
</pre></div> <p>接下来,需要将字段转换为更正确的数据类型，并且在可能的情况下，消除NULL。</p> <div class=codehilite><pre><span></span>time clickhouse-client --query=&quot;INSERT INTO trips FORMAT TabSeparated&quot; &lt; trips.tsv

real    75m56.214s
</pre></div> <p>数据的读取速度为112-140 Mb/秒。 通过这种方式将数据加载到Log表中需要76分钟。 这个表中的数据需要使用142 GB的磁盘空间.</p> <p>（也可以直接使用<code>COPY ... TO PROGRAM</code>从Postgres中导入数据）</p> <p>由于数据中与天气相关的所有数据（precipitation......average_wind_speed）都填充了NULL。 所以，我们将从最终数据集中删除它们</p> <p>首先，我们使用单台服务器创建表，后面我们将在多台节点上创建这些表。</p> <p>创建表结构并写入数据：</p> <div class=codehilite><pre><span></span>CREATE TABLE trips_mergetree
ENGINE = MergeTree(pickup_date, pickup_datetime, 8192)
AS SELECT

trip_id,
CAST(vendor_id AS Enum8(&#39;1&#39; = 1, &#39;2&#39; = 2, &#39;CMT&#39; = 3, &#39;VTS&#39; = 4, &#39;DDS&#39; = 5, &#39;B02512&#39; = 10, &#39;B02598&#39; = 11, &#39;B02617&#39; = 12, &#39;B02682&#39; = 13, &#39;B02764&#39; = 14)) AS vendor_id,
toDate(pickup_datetime) AS pickup_date,
ifNull(pickup_datetime, toDateTime(0)) AS pickup_datetime,
toDate(dropoff_datetime) AS dropoff_date,
ifNull(dropoff_datetime, toDateTime(0)) AS dropoff_datetime,
assumeNotNull(store_and_fwd_flag) IN (&#39;Y&#39;, &#39;1&#39;, &#39;2&#39;) AS store_and_fwd_flag,
assumeNotNull(rate_code_id) AS rate_code_id,
assumeNotNull(pickup_longitude) AS pickup_longitude,
assumeNotNull(pickup_latitude) AS pickup_latitude,
assumeNotNull(dropoff_longitude) AS dropoff_longitude,
assumeNotNull(dropoff_latitude) AS dropoff_latitude,
assumeNotNull(passenger_count) AS passenger_count,
assumeNotNull(trip_distance) AS trip_distance,
assumeNotNull(fare_amount) AS fare_amount,
assumeNotNull(extra) AS extra,
assumeNotNull(mta_tax) AS mta_tax,
assumeNotNull(tip_amount) AS tip_amount,
assumeNotNull(tolls_amount) AS tolls_amount,
assumeNotNull(ehail_fee) AS ehail_fee,
assumeNotNull(improvement_surcharge) AS improvement_surcharge,
assumeNotNull(total_amount) AS total_amount,
CAST((assumeNotNull(payment_type) AS pt) IN (&#39;CSH&#39;, &#39;CASH&#39;, &#39;Cash&#39;, &#39;CAS&#39;, &#39;Cas&#39;, &#39;1&#39;) ? &#39;CSH&#39; : (pt IN (&#39;CRD&#39;, &#39;Credit&#39;, &#39;Cre&#39;, &#39;CRE&#39;, &#39;CREDIT&#39;, &#39;2&#39;) ? &#39;CRE&#39; : (pt IN (&#39;NOC&#39;, &#39;No Charge&#39;, &#39;No&#39;, &#39;3&#39;) ? &#39;NOC&#39; : (pt IN (&#39;DIS&#39;, &#39;Dispute&#39;, &#39;Dis&#39;, &#39;4&#39;) ? &#39;DIS&#39; : &#39;UNK&#39;))) AS Enum8(&#39;CSH&#39; = 1, &#39;CRE&#39; = 2, &#39;UNK&#39; = 0, &#39;NOC&#39; = 3, &#39;DIS&#39; = 4)) AS payment_type_,
assumeNotNull(trip_type) AS trip_type,
ifNull(toFixedString(unhex(pickup), 25), toFixedString(&#39;&#39;, 25)) AS pickup,
ifNull(toFixedString(unhex(dropoff), 25), toFixedString(&#39;&#39;, 25)) AS dropoff,
CAST(assumeNotNull(cab_type) AS Enum8(&#39;yellow&#39; = 1, &#39;green&#39; = 2, &#39;uber&#39; = 3)) AS cab_type,

assumeNotNull(pickup_nyct2010_gid) AS pickup_nyct2010_gid,
toFloat32(ifNull(pickup_ctlabel, &#39;0&#39;)) AS pickup_ctlabel,
assumeNotNull(pickup_borocode) AS pickup_borocode,
CAST(assumeNotNull(pickup_boroname) AS Enum8(&#39;Manhattan&#39; = 1, &#39;Queens&#39; = 4, &#39;Brooklyn&#39; = 3, &#39;&#39; = 0, &#39;Bronx&#39; = 2, &#39;Staten Island&#39; = 5)) AS pickup_boroname,
toFixedString(ifNull(pickup_ct2010, &#39;000000&#39;), 6) AS pickup_ct2010,
toFixedString(ifNull(pickup_boroct2010, &#39;0000000&#39;), 7) AS pickup_boroct2010,
CAST(assumeNotNull(ifNull(pickup_cdeligibil, &#39; &#39;)) AS Enum8(&#39; &#39; = 0, &#39;E&#39; = 1, &#39;I&#39; = 2)) AS pickup_cdeligibil,
toFixedString(ifNull(pickup_ntacode, &#39;0000&#39;), 4) AS pickup_ntacode,

CAST(assumeNotNull(pickup_ntaname) AS Enum16(&#39;&#39; = 0, &#39;Airport&#39; = 1, &#39;Allerton-Pelham Gardens&#39; = 2, &#39;Annadale-Huguenot-Prince\&#39;s Bay-Eltingville&#39; = 3, &#39;Arden Heights&#39; = 4, &#39;Astoria&#39; = 5, &#39;Auburndale&#39; = 6, &#39;Baisley Park&#39; = 7, &#39;Bath Beach&#39; = 8, &#39;Battery Park City-Lower Manhattan&#39; = 9, &#39;Bay Ridge&#39; = 10, &#39;Bayside-Bayside Hills&#39; = 11, &#39;Bedford&#39; = 12, &#39;Bedford Park-Fordham North&#39; = 13, &#39;Bellerose&#39; = 14, &#39;Belmont&#39; = 15, &#39;Bensonhurst East&#39; = 16, &#39;Bensonhurst West&#39; = 17, &#39;Borough Park&#39; = 18, &#39;Breezy Point-Belle Harbor-Rockaway Park-Broad Channel&#39; = 19, &#39;Briarwood-Jamaica Hills&#39; = 20, &#39;Brighton Beach&#39; = 21, &#39;Bronxdale&#39; = 22, &#39;Brooklyn Heights-Cobble Hill&#39; = 23, &#39;Brownsville&#39; = 24, &#39;Bushwick North&#39; = 25, &#39;Bushwick South&#39; = 26, &#39;Cambria Heights&#39; = 27, &#39;Canarsie&#39; = 28, &#39;Carroll Gardens-Columbia Street-Red Hook&#39; = 29, &#39;Central Harlem North-Polo Grounds&#39; = 30, &#39;Central Harlem South&#39; = 31, &#39;Charleston-Richmond Valley-Tottenville&#39; = 32, &#39;Chinatown&#39; = 33, &#39;Claremont-Bathgate&#39; = 34, &#39;Clinton&#39; = 35, &#39;Clinton Hill&#39; = 36, &#39;Co-op City&#39; = 37, &#39;College Point&#39; = 38, &#39;Corona&#39; = 39, &#39;Crotona Park East&#39; = 40, &#39;Crown Heights North&#39; = 41, &#39;Crown Heights South&#39; = 42, &#39;Cypress Hills-City Line&#39; = 43, &#39;DUMBO-Vinegar Hill-Downtown Brooklyn-Boerum Hill&#39; = 44, &#39;Douglas Manor-Douglaston-Little Neck&#39; = 45, &#39;Dyker Heights&#39; = 46, &#39;East Concourse-Concourse Village&#39; = 47, &#39;East Elmhurst&#39; = 48, &#39;East Flatbush-Farragut&#39; = 49, &#39;East Flushing&#39; = 50, &#39;East Harlem North&#39; = 51, &#39;East Harlem South&#39; = 52, &#39;East New York&#39; = 53, &#39;East New York (Pennsylvania Ave)&#39; = 54, &#39;East Tremont&#39; = 55, &#39;East Village&#39; = 56, &#39;East Williamsburg&#39; = 57, &#39;Eastchester-Edenwald-Baychester&#39; = 58, &#39;Elmhurst&#39; = 59, &#39;Elmhurst-Maspeth&#39; = 60, &#39;Erasmus&#39; = 61, &#39;Far Rockaway-Bayswater&#39; = 62, &#39;Flatbush&#39; = 63, &#39;Flatlands&#39; = 64, &#39;Flushing&#39; = 65, &#39;Fordham South&#39; = 66, &#39;Forest Hills&#39; = 67, &#39;Fort Greene&#39; = 68, &#39;Fresh Meadows-Utopia&#39; = 69, &#39;Ft. Totten-Bay Terrace-Clearview&#39; = 70, &#39;Georgetown-Marine Park-Bergen Beach-Mill Basin&#39; = 71, &#39;Glen Oaks-Floral Park-New Hyde Park&#39; = 72, &#39;Glendale&#39; = 73, &#39;Gramercy&#39; = 74, &#39;Grasmere-Arrochar-Ft. Wadsworth&#39; = 75, &#39;Gravesend&#39; = 76, &#39;Great Kills&#39; = 77, &#39;Greenpoint&#39; = 78, &#39;Grymes Hill-Clifton-Fox Hills&#39; = 79, &#39;Hamilton Heights&#39; = 80, &#39;Hammels-Arverne-Edgemere&#39; = 81, &#39;Highbridge&#39; = 82, &#39;Hollis&#39; = 83, &#39;Homecrest&#39; = 84, &#39;Hudson Yards-Chelsea-Flatiron-Union Square&#39; = 85, &#39;Hunters Point-Sunnyside-West Maspeth&#39; = 86, &#39;Hunts Point&#39; = 87, &#39;Jackson Heights&#39; = 88, &#39;Jamaica&#39; = 89, &#39;Jamaica Estates-Holliswood&#39; = 90, &#39;Kensington-Ocean Parkway&#39; = 91, &#39;Kew Gardens&#39; = 92, &#39;Kew Gardens Hills&#39; = 93, &#39;Kingsbridge Heights&#39; = 94, &#39;Laurelton&#39; = 95, &#39;Lenox Hill-Roosevelt Island&#39; = 96, &#39;Lincoln Square&#39; = 97, &#39;Lindenwood-Howard Beach&#39; = 98, &#39;Longwood&#39; = 99, &#39;Lower East Side&#39; = 100, &#39;Madison&#39; = 101, &#39;Manhattanville&#39; = 102, &#39;Marble Hill-Inwood&#39; = 103, &#39;Mariner\&#39;s Harbor-Arlington-Port Ivory-Graniteville&#39; = 104, &#39;Maspeth&#39; = 105, &#39;Melrose South-Mott Haven North&#39; = 106, &#39;Middle Village&#39; = 107, &#39;Midtown-Midtown South&#39; = 108, &#39;Midwood&#39; = 109, &#39;Morningside Heights&#39; = 110, &#39;Morrisania-Melrose&#39; = 111, &#39;Mott Haven-Port Morris&#39; = 112, &#39;Mount Hope&#39; = 113, &#39;Murray Hill&#39; = 114, &#39;Murray Hill-Kips Bay&#39; = 115, &#39;New Brighton-Silver Lake&#39; = 116, &#39;New Dorp-Midland Beach&#39; = 117, &#39;New Springville-Bloomfield-Travis&#39; = 118, &#39;North Corona&#39; = 119, &#39;North Riverdale-Fieldston-Riverdale&#39; = 120, &#39;North Side-South Side&#39; = 121, &#39;Norwood&#39; = 122, &#39;Oakland Gardens&#39; = 123, &#39;Oakwood-Oakwood Beach&#39; = 124, &#39;Ocean Hill&#39; = 125, &#39;Ocean Parkway South&#39; = 126, &#39;Old Astoria&#39; = 127, &#39;Old Town-Dongan Hills-South Beach&#39; = 128, &#39;Ozone Park&#39; = 129, &#39;Park Slope-Gowanus&#39; = 130, &#39;Parkchester&#39; = 131, &#39;Pelham Bay-Country Club-City Island&#39; = 132, &#39;Pelham Parkway&#39; = 133, &#39;Pomonok-Flushing Heights-Hillcrest&#39; = 134, &#39;Port Richmond&#39; = 135, &#39;Prospect Heights&#39; = 136, &#39;Prospect Lefferts Gardens-Wingate&#39; = 137, &#39;Queens Village&#39; = 138, &#39;Queensboro Hill&#39; = 139, &#39;Queensbridge-Ravenswood-Long Island City&#39; = 140, &#39;Rego Park&#39; = 141, &#39;Richmond Hill&#39; = 142, &#39;Ridgewood&#39; = 143, &#39;Rikers Island&#39; = 144, &#39;Rosedale&#39; = 145, &#39;Rossville-Woodrow&#39; = 146, &#39;Rugby-Remsen Village&#39; = 147, &#39;Schuylerville-Throgs Neck-Edgewater Park&#39; = 148, &#39;Seagate-Coney Island&#39; = 149, &#39;Sheepshead Bay-Gerritsen Beach-Manhattan Beach&#39; = 150, &#39;SoHo-TriBeCa-Civic Center-Little Italy&#39; = 151, &#39;Soundview-Bruckner&#39; = 152, &#39;Soundview-Castle Hill-Clason Point-Harding Park&#39; = 153, &#39;South Jamaica&#39; = 154, &#39;South Ozone Park&#39; = 155, &#39;Springfield Gardens North&#39; = 156, &#39;Springfield Gardens South-Brookville&#39; = 157, &#39;Spuyten Duyvil-Kingsbridge&#39; = 158, &#39;St. Albans&#39; = 159, &#39;Stapleton-Rosebank&#39; = 160, &#39;Starrett City&#39; = 161, &#39;Steinway&#39; = 162, &#39;Stuyvesant Heights&#39; = 163, &#39;Stuyvesant Town-Cooper Village&#39; = 164, &#39;Sunset Park East&#39; = 165, &#39;Sunset Park West&#39; = 166, &#39;Todt Hill-Emerson Hill-Heartland Village-Lighthouse Hill&#39; = 167, &#39;Turtle Bay-East Midtown&#39; = 168, &#39;University Heights-Morris Heights&#39; = 169, &#39;Upper East Side-Carnegie Hill&#39; = 170, &#39;Upper West Side&#39; = 171, &#39;Van Cortlandt Village&#39; = 172, &#39;Van Nest-Morris Park-Westchester Square&#39; = 173, &#39;Washington Heights North&#39; = 174, &#39;Washington Heights South&#39; = 175, &#39;West Brighton&#39; = 176, &#39;West Concourse&#39; = 177, &#39;West Farms-Bronx River&#39; = 178, &#39;West New Brighton-New Brighton-St. George&#39; = 179, &#39;West Village&#39; = 180, &#39;Westchester-Unionport&#39; = 181, &#39;Westerleigh&#39; = 182, &#39;Whitestone&#39; = 183, &#39;Williamsbridge-Olinville&#39; = 184, &#39;Williamsburg&#39; = 185, &#39;Windsor Terrace&#39; = 186, &#39;Woodhaven&#39; = 187, &#39;Woodlawn-Wakefield&#39; = 188, &#39;Woodside&#39; = 189, &#39;Yorkville&#39; = 190, &#39;park-cemetery-etc-Bronx&#39; = 191, &#39;park-cemetery-etc-Brooklyn&#39; = 192, &#39;park-cemetery-etc-Manhattan&#39; = 193, &#39;park-cemetery-etc-Queens&#39; = 194, &#39;park-cemetery-etc-Staten Island&#39; = 195)) AS pickup_ntaname,

toUInt16(ifNull(pickup_puma, &#39;0&#39;)) AS pickup_puma,

assumeNotNull(dropoff_nyct2010_gid) AS dropoff_nyct2010_gid,
toFloat32(ifNull(dropoff_ctlabel, &#39;0&#39;)) AS dropoff_ctlabel,
assumeNotNull(dropoff_borocode) AS dropoff_borocode,
CAST(assumeNotNull(dropoff_boroname) AS Enum8(&#39;Manhattan&#39; = 1, &#39;Queens&#39; = 4, &#39;Brooklyn&#39; = 3, &#39;&#39; = 0, &#39;Bronx&#39; = 2, &#39;Staten Island&#39; = 5)) AS dropoff_boroname,
toFixedString(ifNull(dropoff_ct2010, &#39;000000&#39;), 6) AS dropoff_ct2010,
toFixedString(ifNull(dropoff_boroct2010, &#39;0000000&#39;), 7) AS dropoff_boroct2010,
CAST(assumeNotNull(ifNull(dropoff_cdeligibil, &#39; &#39;)) AS Enum8(&#39; &#39; = 0, &#39;E&#39; = 1, &#39;I&#39; = 2)) AS dropoff_cdeligibil,
toFixedString(ifNull(dropoff_ntacode, &#39;0000&#39;), 4) AS dropoff_ntacode,

CAST(assumeNotNull(dropoff_ntaname) AS Enum16(&#39;&#39; = 0, &#39;Airport&#39; = 1, &#39;Allerton-Pelham Gardens&#39; = 2, &#39;Annadale-Huguenot-Prince\&#39;s Bay-Eltingville&#39; = 3, &#39;Arden Heights&#39; = 4, &#39;Astoria&#39; = 5, &#39;Auburndale&#39; = 6, &#39;Baisley Park&#39; = 7, &#39;Bath Beach&#39; = 8, &#39;Battery Park City-Lower Manhattan&#39; = 9, &#39;Bay Ridge&#39; = 10, &#39;Bayside-Bayside Hills&#39; = 11, &#39;Bedford&#39; = 12, &#39;Bedford Park-Fordham North&#39; = 13, &#39;Bellerose&#39; = 14, &#39;Belmont&#39; = 15, &#39;Bensonhurst East&#39; = 16, &#39;Bensonhurst West&#39; = 17, &#39;Borough Park&#39; = 18, &#39;Breezy Point-Belle Harbor-Rockaway Park-Broad Channel&#39; = 19, &#39;Briarwood-Jamaica Hills&#39; = 20, &#39;Brighton Beach&#39; = 21, &#39;Bronxdale&#39; = 22, &#39;Brooklyn Heights-Cobble Hill&#39; = 23, &#39;Brownsville&#39; = 24, &#39;Bushwick North&#39; = 25, &#39;Bushwick South&#39; = 26, &#39;Cambria Heights&#39; = 27, &#39;Canarsie&#39; = 28, &#39;Carroll Gardens-Columbia Street-Red Hook&#39; = 29, &#39;Central Harlem North-Polo Grounds&#39; = 30, &#39;Central Harlem South&#39; = 31, &#39;Charleston-Richmond Valley-Tottenville&#39; = 32, &#39;Chinatown&#39; = 33, &#39;Claremont-Bathgate&#39; = 34, &#39;Clinton&#39; = 35, &#39;Clinton Hill&#39; = 36, &#39;Co-op City&#39; = 37, &#39;College Point&#39; = 38, &#39;Corona&#39; = 39, &#39;Crotona Park East&#39; = 40, &#39;Crown Heights North&#39; = 41, &#39;Crown Heights South&#39; = 42, &#39;Cypress Hills-City Line&#39; = 43, &#39;DUMBO-Vinegar Hill-Downtown Brooklyn-Boerum Hill&#39; = 44, &#39;Douglas Manor-Douglaston-Little Neck&#39; = 45, &#39;Dyker Heights&#39; = 46, &#39;East Concourse-Concourse Village&#39; = 47, &#39;East Elmhurst&#39; = 48, &#39;East Flatbush-Farragut&#39; = 49, &#39;East Flushing&#39; = 50, &#39;East Harlem North&#39; = 51, &#39;East Harlem South&#39; = 52, &#39;East New York&#39; = 53, &#39;East New York (Pennsylvania Ave)&#39; = 54, &#39;East Tremont&#39; = 55, &#39;East Village&#39; = 56, &#39;East Williamsburg&#39; = 57, &#39;Eastchester-Edenwald-Baychester&#39; = 58, &#39;Elmhurst&#39; = 59, &#39;Elmhurst-Maspeth&#39; = 60, &#39;Erasmus&#39; = 61, &#39;Far Rockaway-Bayswater&#39; = 62, &#39;Flatbush&#39; = 63, &#39;Flatlands&#39; = 64, &#39;Flushing&#39; = 65, &#39;Fordham South&#39; = 66, &#39;Forest Hills&#39; = 67, &#39;Fort Greene&#39; = 68, &#39;Fresh Meadows-Utopia&#39; = 69, &#39;Ft. Totten-Bay Terrace-Clearview&#39; = 70, &#39;Georgetown-Marine Park-Bergen Beach-Mill Basin&#39; = 71, &#39;Glen Oaks-Floral Park-New Hyde Park&#39; = 72, &#39;Glendale&#39; = 73, &#39;Gramercy&#39; = 74, &#39;Grasmere-Arrochar-Ft. Wadsworth&#39; = 75, &#39;Gravesend&#39; = 76, &#39;Great Kills&#39; = 77, &#39;Greenpoint&#39; = 78, &#39;Grymes Hill-Clifton-Fox Hills&#39; = 79, &#39;Hamilton Heights&#39; = 80, &#39;Hammels-Arverne-Edgemere&#39; = 81, &#39;Highbridge&#39; = 82, &#39;Hollis&#39; = 83, &#39;Homecrest&#39; = 84, &#39;Hudson Yards-Chelsea-Flatiron-Union Square&#39; = 85, &#39;Hunters Point-Sunnyside-West Maspeth&#39; = 86, &#39;Hunts Point&#39; = 87, &#39;Jackson Heights&#39; = 88, &#39;Jamaica&#39; = 89, &#39;Jamaica Estates-Holliswood&#39; = 90, &#39;Kensington-Ocean Parkway&#39; = 91, &#39;Kew Gardens&#39; = 92, &#39;Kew Gardens Hills&#39; = 93, &#39;Kingsbridge Heights&#39; = 94, &#39;Laurelton&#39; = 95, &#39;Lenox Hill-Roosevelt Island&#39; = 96, &#39;Lincoln Square&#39; = 97, &#39;Lindenwood-Howard Beach&#39; = 98, &#39;Longwood&#39; = 99, &#39;Lower East Side&#39; = 100, &#39;Madison&#39; = 101, &#39;Manhattanville&#39; = 102, &#39;Marble Hill-Inwood&#39; = 103, &#39;Mariner\&#39;s Harbor-Arlington-Port Ivory-Graniteville&#39; = 104, &#39;Maspeth&#39; = 105, &#39;Melrose South-Mott Haven North&#39; = 106, &#39;Middle Village&#39; = 107, &#39;Midtown-Midtown South&#39; = 108, &#39;Midwood&#39; = 109, &#39;Morningside Heights&#39; = 110, &#39;Morrisania-Melrose&#39; = 111, &#39;Mott Haven-Port Morris&#39; = 112, &#39;Mount Hope&#39; = 113, &#39;Murray Hill&#39; = 114, &#39;Murray Hill-Kips Bay&#39; = 115, &#39;New Brighton-Silver Lake&#39; = 116, &#39;New Dorp-Midland Beach&#39; = 117, &#39;New Springville-Bloomfield-Travis&#39; = 118, &#39;North Corona&#39; = 119, &#39;North Riverdale-Fieldston-Riverdale&#39; = 120, &#39;North Side-South Side&#39; = 121, &#39;Norwood&#39; = 122, &#39;Oakland Gardens&#39; = 123, &#39;Oakwood-Oakwood Beach&#39; = 124, &#39;Ocean Hill&#39; = 125, &#39;Ocean Parkway South&#39; = 126, &#39;Old Astoria&#39; = 127, &#39;Old Town-Dongan Hills-South Beach&#39; = 128, &#39;Ozone Park&#39; = 129, &#39;Park Slope-Gowanus&#39; = 130, &#39;Parkchester&#39; = 131, &#39;Pelham Bay-Country Club-City Island&#39; = 132, &#39;Pelham Parkway&#39; = 133, &#39;Pomonok-Flushing Heights-Hillcrest&#39; = 134, &#39;Port Richmond&#39; = 135, &#39;Prospect Heights&#39; = 136, &#39;Prospect Lefferts Gardens-Wingate&#39; = 137, &#39;Queens Village&#39; = 138, &#39;Queensboro Hill&#39; = 139, &#39;Queensbridge-Ravenswood-Long Island City&#39; = 140, &#39;Rego Park&#39; = 141, &#39;Richmond Hill&#39; = 142, &#39;Ridgewood&#39; = 143, &#39;Rikers Island&#39; = 144, &#39;Rosedale&#39; = 145, &#39;Rossville-Woodrow&#39; = 146, &#39;Rugby-Remsen Village&#39; = 147, &#39;Schuylerville-Throgs Neck-Edgewater Park&#39; = 148, &#39;Seagate-Coney Island&#39; = 149, &#39;Sheepshead Bay-Gerritsen Beach-Manhattan Beach&#39; = 150, &#39;SoHo-TriBeCa-Civic Center-Little Italy&#39; = 151, &#39;Soundview-Bruckner&#39; = 152, &#39;Soundview-Castle Hill-Clason Point-Harding Park&#39; = 153, &#39;South Jamaica&#39; = 154, &#39;South Ozone Park&#39; = 155, &#39;Springfield Gardens North&#39; = 156, &#39;Springfield Gardens South-Brookville&#39; = 157, &#39;Spuyten Duyvil-Kingsbridge&#39; = 158, &#39;St. Albans&#39; = 159, &#39;Stapleton-Rosebank&#39; = 160, &#39;Starrett City&#39; = 161, &#39;Steinway&#39; = 162, &#39;Stuyvesant Heights&#39; = 163, &#39;Stuyvesant Town-Cooper Village&#39; = 164, &#39;Sunset Park East&#39; = 165, &#39;Sunset Park West&#39; = 166, &#39;Todt Hill-Emerson Hill-Heartland Village-Lighthouse Hill&#39; = 167, &#39;Turtle Bay-East Midtown&#39; = 168, &#39;University Heights-Morris Heights&#39; = 169, &#39;Upper East Side-Carnegie Hill&#39; = 170, &#39;Upper West Side&#39; = 171, &#39;Van Cortlandt Village&#39; = 172, &#39;Van Nest-Morris Park-Westchester Square&#39; = 173, &#39;Washington Heights North&#39; = 174, &#39;Washington Heights South&#39; = 175, &#39;West Brighton&#39; = 176, &#39;West Concourse&#39; = 177, &#39;West Farms-Bronx River&#39; = 178, &#39;West New Brighton-New Brighton-St. George&#39; = 179, &#39;West Village&#39; = 180, &#39;Westchester-Unionport&#39; = 181, &#39;Westerleigh&#39; = 182, &#39;Whitestone&#39; = 183, &#39;Williamsbridge-Olinville&#39; = 184, &#39;Williamsburg&#39; = 185, &#39;Windsor Terrace&#39; = 186, &#39;Woodhaven&#39; = 187, &#39;Woodlawn-Wakefield&#39; = 188, &#39;Woodside&#39; = 189, &#39;Yorkville&#39; = 190, &#39;park-cemetery-etc-Bronx&#39; = 191, &#39;park-cemetery-etc-Brooklyn&#39; = 192, &#39;park-cemetery-etc-Manhattan&#39; = 193, &#39;park-cemetery-etc-Queens&#39; = 194, &#39;park-cemetery-etc-Staten Island&#39; = 195)) AS dropoff_ntaname,

toUInt16(ifNull(dropoff_puma, &#39;0&#39;)) AS dropoff_puma

FROM trips
</pre></div> <p>这需要3030秒，速度约为每秒428,000行。 要加快速度，可以使用<code>Log</code>引擎替换'MergeTree`引擎来创建表。 在这种情况下，下载速度超过200秒。</p> <p>这个表需要使用126GB的磁盘空间。</p> <div class=codehilite><pre><span></span>:) SELECT formatReadableSize(sum(bytes)) FROM system.parts WHERE table = &#39;trips_mergetree&#39; AND active

SELECT formatReadableSize(sum(bytes))
FROM system.parts
WHERE (table = &#39;trips_mergetree&#39;) AND active

┌─formatReadableSize(sum(bytes))─┐
│ 126.18 GiB                     │
└────────────────────────────────┘
</pre></div> <p>除此之外，你还可以在MergeTree上运行OPTIMIZE查询来进行优化。但这不是必须的，因为即使在没有进行优化的情况下它的表现依然是很好的。</p> <h2 id=dan-tai-fu-wu-qi-yun-xing-jie-guo>单台服务器运行结果<a class=headerlink href=#dan-tai-fu-wu-qi-yun-xing-jie-guo title="Permanent link">&para;</a></h2> <p>Q1:</p> <div class=codehilite><pre><span></span><span class=k>SELECT</span> <span class=n>cab_type</span><span class=p>,</span> <span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>trips_mergetree</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>cab_type</span>
</pre></div> <p>0.490 seconds.</p> <p>Q2:</p> <div class=codehilite><pre><span></span><span class=k>SELECT</span> <span class=n>passenger_count</span><span class=p>,</span> <span class=k>avg</span><span class=p>(</span><span class=n>total_amount</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>trips_mergetree</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>passenger_count</span>
</pre></div> <p>1.224 seconds.</p> <p>Q3:</p> <div class=codehilite><pre><span></span><span class=k>SELECT</span> <span class=n>passenger_count</span><span class=p>,</span> <span class=n>toYear</span><span class=p>(</span><span class=n>pickup_date</span><span class=p>)</span> <span class=k>AS</span> <span class=k>year</span><span class=p>,</span> <span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span> <span class=k>FROM</span> <span class=n>trips_mergetree</span> <span class=k>GROUP</span> <span class=k>BY</span> <span class=n>passenger_count</span><span class=p>,</span> <span class=k>year</span>
</pre></div> <p>2.104 seconds.</p> <p>Q4:</p> <div class=codehilite><pre><span></span><span class=k>SELECT</span> <span class=n>passenger_count</span><span class=p>,</span> <span class=n>toYear</span><span class=p>(</span><span class=n>pickup_date</span><span class=p>)</span> <span class=k>AS</span> <span class=k>year</span><span class=p>,</span> <span class=n>round</span><span class=p>(</span><span class=n>trip_distance</span><span class=p>)</span> <span class=k>AS</span> <span class=n>distance</span><span class=p>,</span> <span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span>
<span class=k>FROM</span> <span class=n>trips_mergetree</span>
<span class=k>GROUP</span> <span class=k>BY</span> <span class=n>passenger_count</span><span class=p>,</span> <span class=k>year</span><span class=p>,</span> <span class=n>distance</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=k>year</span><span class=p>,</span> <span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span> <span class=k>DESC</span>
</pre></div> <p>3.593 seconds.</p> <p>我们使用的是如下配置的服务器：</p> <p>Two Intel(R) Xeon(R) CPU E5-2650 v2 @ 2.60GHz, 16 physical kernels total,128 GiB RAM,8x6 TB HD on hardware RAID-5</p> <p>执行时间是取三次运行中最好的值，但是从第二次查询开始，查询就讲从文件系统的缓存中读取数据。同时在每次读取和处理后不在进行缓存。</p> <p>在三台服务器中创建表结构：</p> <p>在每台服务器中运行：</p> <div class=codehilite><pre><span></span>CREATE TABLE default.trips_mergetree_third ( trip_id UInt32, vendor_id Enum8(&#39;1&#39; = 1, &#39;2&#39; = 2, &#39;CMT&#39; = 3, &#39;VTS&#39; = 4, &#39;DDS&#39; = 5, &#39;B02512&#39; = 10, &#39;B02598&#39; = 11, &#39;B02617&#39; = 12, &#39;B02682&#39; = 13, &#39;B02764&#39; = 14), pickup_date Date, pickup_datetime DateTime, dropoff_date Date, dropoff_datetime DateTime, store_and_fwd_flag UInt8, rate_code_id UInt8, pickup_longitude Float64, pickup_latitude Float64, dropoff_longitude Float64, dropoff_latitude Float64, passenger_count UInt8, trip_distance Float64, fare_amount Float32, extra Float32, mta_tax Float32, tip_amount Float32, tolls_amount Float32, ehail_fee Float32, improvement_surcharge Float32, total_amount Float32, payment_type_ Enum8(&#39;UNK&#39; = 0, &#39;CSH&#39; = 1, &#39;CRE&#39; = 2, &#39;NOC&#39; = 3, &#39;DIS&#39; = 4), trip_type UInt8, pickup FixedString(25), dropoff FixedString(25), cab_type Enum8(&#39;yellow&#39; = 1, &#39;green&#39; = 2, &#39;uber&#39; = 3), pickup_nyct2010_gid UInt8, pickup_ctlabel Float32, pickup_borocode UInt8, pickup_boroname Enum8(&#39;&#39; = 0, &#39;Manhattan&#39; = 1, &#39;Bronx&#39; = 2, &#39;Brooklyn&#39; = 3, &#39;Queens&#39; = 4, &#39;Staten Island&#39; = 5), pickup_ct2010 FixedString(6), pickup_boroct2010 FixedString(7), pickup_cdeligibil Enum8(&#39; &#39; = 0, &#39;E&#39; = 1, &#39;I&#39; = 2), pickup_ntacode FixedString(4), pickup_ntaname Enum16(&#39;&#39; = 0, &#39;Airport&#39; = 1, &#39;Allerton-Pelham Gardens&#39; = 2, &#39;Annadale-Huguenot-Prince\&#39;s Bay-Eltingville&#39; = 3, &#39;Arden Heights&#39; = 4, &#39;Astoria&#39; = 5, &#39;Auburndale&#39; = 6, &#39;Baisley Park&#39; = 7, &#39;Bath Beach&#39; = 8, &#39;Battery Park City-Lower Manhattan&#39; = 9, &#39;Bay Ridge&#39; = 10, &#39;Bayside-Bayside Hills&#39; = 11, &#39;Bedford&#39; = 12, &#39;Bedford Park-Fordham North&#39; = 13, &#39;Bellerose&#39; = 14, &#39;Belmont&#39; = 15, &#39;Bensonhurst East&#39; = 16, &#39;Bensonhurst West&#39; = 17, &#39;Borough Park&#39; = 18, &#39;Breezy Point-Belle Harbor-Rockaway Park-Broad Channel&#39; = 19, &#39;Briarwood-Jamaica Hills&#39; = 20, &#39;Brighton Beach&#39; = 21, &#39;Bronxdale&#39; = 22, &#39;Brooklyn Heights-Cobble Hill&#39; = 23, &#39;Brownsville&#39; = 24, &#39;Bushwick North&#39; = 25, &#39;Bushwick South&#39; = 26, &#39;Cambria Heights&#39; = 27, &#39;Canarsie&#39; = 28, &#39;Carroll Gardens-Columbia Street-Red Hook&#39; = 29, &#39;Central Harlem North-Polo Grounds&#39; = 30, &#39;Central Harlem South&#39; = 31, &#39;Charleston-Richmond Valley-Tottenville&#39; = 32, &#39;Chinatown&#39; = 33, &#39;Claremont-Bathgate&#39; = 34, &#39;Clinton&#39; = 35, &#39;Clinton Hill&#39; = 36, &#39;Co-op City&#39; = 37, &#39;College Point&#39; = 38, &#39;Corona&#39; = 39, &#39;Crotona Park East&#39; = 40, &#39;Crown Heights North&#39; = 41, &#39;Crown Heights South&#39; = 42, &#39;Cypress Hills-City Line&#39; = 43, &#39;DUMBO-Vinegar Hill-Downtown Brooklyn-Boerum Hill&#39; = 44, &#39;Douglas Manor-Douglaston-Little Neck&#39; = 45, &#39;Dyker Heights&#39; = 46, &#39;East Concourse-Concourse Village&#39; = 47, &#39;East Elmhurst&#39; = 48, &#39;East Flatbush-Farragut&#39; = 49, &#39;East Flushing&#39; = 50, &#39;East Harlem North&#39; = 51, &#39;East Harlem South&#39; = 52, &#39;East New York&#39; = 53, &#39;East New York (Pennsylvania Ave)&#39; = 54, &#39;East Tremont&#39; = 55, &#39;East Village&#39; = 56, &#39;East Williamsburg&#39; = 57, &#39;Eastchester-Edenwald-Baychester&#39; = 58, &#39;Elmhurst&#39; = 59, &#39;Elmhurst-Maspeth&#39; = 60, &#39;Erasmus&#39; = 61, &#39;Far Rockaway-Bayswater&#39; = 62, &#39;Flatbush&#39; = 63, &#39;Flatlands&#39; = 64, &#39;Flushing&#39; = 65, &#39;Fordham South&#39; = 66, &#39;Forest Hills&#39; = 67, &#39;Fort Greene&#39; = 68, &#39;Fresh Meadows-Utopia&#39; = 69, &#39;Ft. Totten-Bay Terrace-Clearview&#39; = 70, &#39;Georgetown-Marine Park-Bergen Beach-Mill Basin&#39; = 71, &#39;Glen Oaks-Floral Park-New Hyde Park&#39; = 72, &#39;Glendale&#39; = 73, &#39;Gramercy&#39; = 74, &#39;Grasmere-Arrochar-Ft. Wadsworth&#39; = 75, &#39;Gravesend&#39; = 76, &#39;Great Kills&#39; = 77, &#39;Greenpoint&#39; = 78, &#39;Grymes Hill-Clifton-Fox Hills&#39; = 79, &#39;Hamilton Heights&#39; = 80, &#39;Hammels-Arverne-Edgemere&#39; = 81, &#39;Highbridge&#39; = 82, &#39;Hollis&#39; = 83, &#39;Homecrest&#39; = 84, &#39;Hudson Yards-Chelsea-Flatiron-Union Square&#39; = 85, &#39;Hunters Point-Sunnyside-West Maspeth&#39; = 86, &#39;Hunts Point&#39; = 87, &#39;Jackson Heights&#39; = 88, &#39;Jamaica&#39; = 89, &#39;Jamaica Estates-Holliswood&#39; = 90, &#39;Kensington-Ocean Parkway&#39; = 91, &#39;Kew Gardens&#39; = 92, &#39;Kew Gardens Hills&#39; = 93, &#39;Kingsbridge Heights&#39; = 94, &#39;Laurelton&#39; = 95, &#39;Lenox Hill-Roosevelt Island&#39; = 96, &#39;Lincoln Square&#39; = 97, &#39;Lindenwood-Howard Beach&#39; = 98, &#39;Longwood&#39; = 99, &#39;Lower East Side&#39; = 100, &#39;Madison&#39; = 101, &#39;Manhattanville&#39; = 102, &#39;Marble Hill-Inwood&#39; = 103, &#39;Mariner\&#39;s Harbor-Arlington-Port Ivory-Graniteville&#39; = 104, &#39;Maspeth&#39; = 105, &#39;Melrose South-Mott Haven North&#39; = 106, &#39;Middle Village&#39; = 107, &#39;Midtown-Midtown South&#39; = 108, &#39;Midwood&#39; = 109, &#39;Morningside Heights&#39; = 110, &#39;Morrisania-Melrose&#39; = 111, &#39;Mott Haven-Port Morris&#39; = 112, &#39;Mount Hope&#39; = 113, &#39;Murray Hill&#39; = 114, &#39;Murray Hill-Kips Bay&#39; = 115, &#39;New Brighton-Silver Lake&#39; = 116, &#39;New Dorp-Midland Beach&#39; = 117, &#39;New Springville-Bloomfield-Travis&#39; = 118, &#39;North Corona&#39; = 119, &#39;North Riverdale-Fieldston-Riverdale&#39; = 120, &#39;North Side-South Side&#39; = 121, &#39;Norwood&#39; = 122, &#39;Oakland Gardens&#39; = 123, &#39;Oakwood-Oakwood Beach&#39; = 124, &#39;Ocean Hill&#39; = 125, &#39;Ocean Parkway South&#39; = 126, &#39;Old Astoria&#39; = 127, &#39;Old Town-Dongan Hills-South Beach&#39; = 128, &#39;Ozone Park&#39; = 129, &#39;Park Slope-Gowanus&#39; = 130, &#39;Parkchester&#39; = 131, &#39;Pelham Bay-Country Club-City Island&#39; = 132, &#39;Pelham Parkway&#39; = 133, &#39;Pomonok-Flushing Heights-Hillcrest&#39; = 134, &#39;Port Richmond&#39; = 135, &#39;Prospect Heights&#39; = 136, &#39;Prospect Lefferts Gardens-Wingate&#39; = 137, &#39;Queens Village&#39; = 138, &#39;Queensboro Hill&#39; = 139, &#39;Queensbridge-Ravenswood-Long Island City&#39; = 140, &#39;Rego Park&#39; = 141, &#39;Richmond Hill&#39; = 142, &#39;Ridgewood&#39; = 143, &#39;Rikers Island&#39; = 144, &#39;Rosedale&#39; = 145, &#39;Rossville-Woodrow&#39; = 146, &#39;Rugby-Remsen Village&#39; = 147, &#39;Schuylerville-Throgs Neck-Edgewater Park&#39; = 148, &#39;Seagate-Coney Island&#39; = 149, &#39;Sheepshead Bay-Gerritsen Beach-Manhattan Beach&#39; = 150, &#39;SoHo-TriBeCa-Civic Center-Little Italy&#39; = 151, &#39;Soundview-Bruckner&#39; = 152, &#39;Soundview-Castle Hill-Clason Point-Harding Park&#39; = 153, &#39;South Jamaica&#39; = 154, &#39;South Ozone Park&#39; = 155, &#39;Springfield Gardens North&#39; = 156, &#39;Springfield Gardens South-Brookville&#39; = 157, &#39;Spuyten Duyvil-Kingsbridge&#39; = 158, &#39;St. Albans&#39; = 159, &#39;Stapleton-Rosebank&#39; = 160, &#39;Starrett City&#39; = 161, &#39;Steinway&#39; = 162, &#39;Stuyvesant Heights&#39; = 163, &#39;Stuyvesant Town-Cooper Village&#39; = 164, &#39;Sunset Park East&#39; = 165, &#39;Sunset Park West&#39; = 166, &#39;Todt Hill-Emerson Hill-Heartland Village-Lighthouse Hill&#39; = 167, &#39;Turtle Bay-East Midtown&#39; = 168, &#39;University Heights-Morris Heights&#39; = 169, &#39;Upper East Side-Carnegie Hill&#39; = 170, &#39;Upper West Side&#39; = 171, &#39;Van Cortlandt Village&#39; = 172, &#39;Van Nest-Morris Park-Westchester Square&#39; = 173, &#39;Washington Heights North&#39; = 174, &#39;Washington Heights South&#39; = 175, &#39;West Brighton&#39; = 176, &#39;West Concourse&#39; = 177, &#39;West Farms-Bronx River&#39; = 178, &#39;West New Brighton-New Brighton-St. George&#39; = 179, &#39;West Village&#39; = 180, &#39;Westchester-Unionport&#39; = 181, &#39;Westerleigh&#39; = 182, &#39;Whitestone&#39; = 183, &#39;Williamsbridge-Olinville&#39; = 184, &#39;Williamsburg&#39; = 185, &#39;Windsor Terrace&#39; = 186, &#39;Woodhaven&#39; = 187, &#39;Woodlawn-Wakefield&#39; = 188, &#39;Woodside&#39; = 189, &#39;Yorkville&#39; = 190, &#39;park-cemetery-etc-Bronx&#39; = 191, &#39;park-cemetery-etc-Brooklyn&#39; = 192, &#39;park-cemetery-etc-Manhattan&#39; = 193, &#39;park-cemetery-etc-Queens&#39; = 194, &#39;park-cemetery-etc-Staten Island&#39; = 195), pickup_puma UInt16, dropoff_nyct2010_gid UInt8, dropoff_ctlabel Float32, dropoff_borocode UInt8, dropoff_boroname Enum8(&#39;&#39; = 0, &#39;Manhattan&#39; = 1, &#39;Bronx&#39; = 2, &#39;Brooklyn&#39; = 3, &#39;Queens&#39; = 4, &#39;Staten Island&#39; = 5), dropoff_ct2010 FixedString(6), dropoff_boroct2010 FixedString(7), dropoff_cdeligibil Enum8(&#39; &#39; = 0, &#39;E&#39; = 1, &#39;I&#39; = 2), dropoff_ntacode FixedString(4), dropoff_ntaname Enum16(&#39;&#39; = 0, &#39;Airport&#39; = 1, &#39;Allerton-Pelham Gardens&#39; = 2, &#39;Annadale-Huguenot-Prince\&#39;s Bay-Eltingville&#39; = 3, &#39;Arden Heights&#39; = 4, &#39;Astoria&#39; = 5, &#39;Auburndale&#39; = 6, &#39;Baisley Park&#39; = 7, &#39;Bath Beach&#39; = 8, &#39;Battery Park City-Lower Manhattan&#39; = 9, &#39;Bay Ridge&#39; = 10, &#39;Bayside-Bayside Hills&#39; = 11, &#39;Bedford&#39; = 12, &#39;Bedford Park-Fordham North&#39; = 13, &#39;Bellerose&#39; = 14, &#39;Belmont&#39; = 15, &#39;Bensonhurst East&#39; = 16, &#39;Bensonhurst West&#39; = 17, &#39;Borough Park&#39; = 18, &#39;Breezy Point-Belle Harbor-Rockaway Park-Broad Channel&#39; = 19, &#39;Briarwood-Jamaica Hills&#39; = 20, &#39;Brighton Beach&#39; = 21, &#39;Bronxdale&#39; = 22, &#39;Brooklyn Heights-Cobble Hill&#39; = 23, &#39;Brownsville&#39; = 24, &#39;Bushwick North&#39; = 25, &#39;Bushwick South&#39; = 26, &#39;Cambria Heights&#39; = 27, &#39;Canarsie&#39; = 28, &#39;Carroll Gardens-Columbia Street-Red Hook&#39; = 29, &#39;Central Harlem North-Polo Grounds&#39; = 30, &#39;Central Harlem South&#39; = 31, &#39;Charleston-Richmond Valley-Tottenville&#39; = 32, &#39;Chinatown&#39; = 33, &#39;Claremont-Bathgate&#39; = 34, &#39;Clinton&#39; = 35, &#39;Clinton Hill&#39; = 36, &#39;Co-op City&#39; = 37, &#39;College Point&#39; = 38, &#39;Corona&#39; = 39, &#39;Crotona Park East&#39; = 40, &#39;Crown Heights North&#39; = 41, &#39;Crown Heights South&#39; = 42, &#39;Cypress Hills-City Line&#39; = 43, &#39;DUMBO-Vinegar Hill-Downtown Brooklyn-Boerum Hill&#39; = 44, &#39;Douglas Manor-Douglaston-Little Neck&#39; = 45, &#39;Dyker Heights&#39; = 46, &#39;East Concourse-Concourse Village&#39; = 47, &#39;East Elmhurst&#39; = 48, &#39;East Flatbush-Farragut&#39; = 49, &#39;East Flushing&#39; = 50, &#39;East Harlem North&#39; = 51, &#39;East Harlem South&#39; = 52, &#39;East New York&#39; = 53, &#39;East New York (Pennsylvania Ave)&#39; = 54, &#39;East Tremont&#39; = 55, &#39;East Village&#39; = 56, &#39;East Williamsburg&#39; = 57, &#39;Eastchester-Edenwald-Baychester&#39; = 58, &#39;Elmhurst&#39; = 59, &#39;Elmhurst-Maspeth&#39; = 60, &#39;Erasmus&#39; = 61, &#39;Far Rockaway-Bayswater&#39; = 62, &#39;Flatbush&#39; = 63, &#39;Flatlands&#39; = 64, &#39;Flushing&#39; = 65, &#39;Fordham South&#39; = 66, &#39;Forest Hills&#39; = 67, &#39;Fort Greene&#39; = 68, &#39;Fresh Meadows-Utopia&#39; = 69, &#39;Ft. Totten-Bay Terrace-Clearview&#39; = 70, &#39;Georgetown-Marine Park-Bergen Beach-Mill Basin&#39; = 71, &#39;Glen Oaks-Floral Park-New Hyde Park&#39; = 72, &#39;Glendale&#39; = 73, &#39;Gramercy&#39; = 74, &#39;Grasmere-Arrochar-Ft. Wadsworth&#39; = 75, &#39;Gravesend&#39; = 76, &#39;Great Kills&#39; = 77, &#39;Greenpoint&#39; = 78, &#39;Grymes Hill-Clifton-Fox Hills&#39; = 79, &#39;Hamilton Heights&#39; = 80, &#39;Hammels-Arverne-Edgemere&#39; = 81, &#39;Highbridge&#39; = 82, &#39;Hollis&#39; = 83, &#39;Homecrest&#39; = 84, &#39;Hudson Yards-Chelsea-Flatiron-Union Square&#39; = 85, &#39;Hunters Point-Sunnyside-West Maspeth&#39; = 86, &#39;Hunts Point&#39; = 87, &#39;Jackson Heights&#39; = 88, &#39;Jamaica&#39; = 89, &#39;Jamaica Estates-Holliswood&#39; = 90, &#39;Kensington-Ocean Parkway&#39; = 91, &#39;Kew Gardens&#39; = 92, &#39;Kew Gardens Hills&#39; = 93, &#39;Kingsbridge Heights&#39; = 94, &#39;Laurelton&#39; = 95, &#39;Lenox Hill-Roosevelt Island&#39; = 96, &#39;Lincoln Square&#39; = 97, &#39;Lindenwood-Howard Beach&#39; = 98, &#39;Longwood&#39; = 99, &#39;Lower East Side&#39; = 100, &#39;Madison&#39; = 101, &#39;Manhattanville&#39; = 102, &#39;Marble Hill-Inwood&#39; = 103, &#39;Mariner\&#39;s Harbor-Arlington-Port Ivory-Graniteville&#39; = 104, &#39;Maspeth&#39; = 105, &#39;Melrose South-Mott Haven North&#39; = 106, &#39;Middle Village&#39; = 107, &#39;Midtown-Midtown South&#39; = 108, &#39;Midwood&#39; = 109, &#39;Morningside Heights&#39; = 110, &#39;Morrisania-Melrose&#39; = 111, &#39;Mott Haven-Port Morris&#39; = 112, &#39;Mount Hope&#39; = 113, &#39;Murray Hill&#39; = 114, &#39;Murray Hill-Kips Bay&#39; = 115, &#39;New Brighton-Silver Lake&#39; = 116, &#39;New Dorp-Midland Beach&#39; = 117, &#39;New Springville-Bloomfield-Travis&#39; = 118, &#39;North Corona&#39; = 119, &#39;North Riverdale-Fieldston-Riverdale&#39; = 120, &#39;North Side-South Side&#39; = 121, &#39;Norwood&#39; = 122, &#39;Oakland Gardens&#39; = 123, &#39;Oakwood-Oakwood Beach&#39; = 124, &#39;Ocean Hill&#39; = 125, &#39;Ocean Parkway South&#39; = 126, &#39;Old Astoria&#39; = 127, &#39;Old Town-Dongan Hills-South Beach&#39; = 128, &#39;Ozone Park&#39; = 129, &#39;Park Slope-Gowanus&#39; = 130, &#39;Parkchester&#39; = 131, &#39;Pelham Bay-Country Club-City Island&#39; = 132, &#39;Pelham Parkway&#39; = 133, &#39;Pomonok-Flushing Heights-Hillcrest&#39; = 134, &#39;Port Richmond&#39; = 135, &#39;Prospect Heights&#39; = 136, &#39;Prospect Lefferts Gardens-Wingate&#39; = 137, &#39;Queens Village&#39; = 138, &#39;Queensboro Hill&#39; = 139, &#39;Queensbridge-Ravenswood-Long Island City&#39; = 140, &#39;Rego Park&#39; = 141, &#39;Richmond Hill&#39; = 142, &#39;Ridgewood&#39; = 143, &#39;Rikers Island&#39; = 144, &#39;Rosedale&#39; = 145, &#39;Rossville-Woodrow&#39; = 146, &#39;Rugby-Remsen Village&#39; = 147, &#39;Schuylerville-Throgs Neck-Edgewater Park&#39; = 148, &#39;Seagate-Coney Island&#39; = 149, &#39;Sheepshead Bay-Gerritsen Beach-Manhattan Beach&#39; = 150, &#39;SoHo-TriBeCa-Civic Center-Little Italy&#39; = 151, &#39;Soundview-Bruckner&#39; = 152, &#39;Soundview-Castle Hill-Clason Point-Harding Park&#39; = 153, &#39;South Jamaica&#39; = 154, &#39;South Ozone Park&#39; = 155, &#39;Springfield Gardens North&#39; = 156, &#39;Springfield Gardens South-Brookville&#39; = 157, &#39;Spuyten Duyvil-Kingsbridge&#39; = 158, &#39;St. Albans&#39; = 159, &#39;Stapleton-Rosebank&#39; = 160, &#39;Starrett City&#39; = 161, &#39;Steinway&#39; = 162, &#39;Stuyvesant Heights&#39; = 163, &#39;Stuyvesant Town-Cooper Village&#39; = 164, &#39;Sunset Park East&#39; = 165, &#39;Sunset Park West&#39; = 166, &#39;Todt Hill-Emerson Hill-Heartland Village-Lighthouse Hill&#39; = 167, &#39;Turtle Bay-East Midtown&#39; = 168, &#39;University Heights-Morris Heights&#39; = 169, &#39;Upper East Side-Carnegie Hill&#39; = 170, &#39;Upper West Side&#39; = 171, &#39;Van Cortlandt Village&#39; = 172, &#39;Van Nest-Morris Park-Westchester Square&#39; = 173, &#39;Washington Heights North&#39; = 174, &#39;Washington Heights South&#39; = 175, &#39;West Brighton&#39; = 176, &#39;West Concourse&#39; = 177, &#39;West Farms-Bronx River&#39; = 178, &#39;West New Brighton-New Brighton-St. George&#39; = 179, &#39;West Village&#39; = 180, &#39;Westchester-Unionport&#39; = 181, &#39;Westerleigh&#39; = 182, &#39;Whitestone&#39; = 183, &#39;Williamsbridge-Olinville&#39; = 184, &#39;Williamsburg&#39; = 185, &#39;Windsor Terrace&#39; = 186, &#39;Woodhaven&#39; = 187, &#39;Woodlawn-Wakefield&#39; = 188, &#39;Woodside&#39; = 189, &#39;Yorkville&#39; = 190, &#39;park-cemetery-etc-Bronx&#39; = 191, &#39;park-cemetery-etc-Brooklyn&#39; = 192, &#39;park-cemetery-etc-Manhattan&#39; = 193, &#39;park-cemetery-etc-Queens&#39; = 194, &#39;park-cemetery-etc-Staten Island&#39; = 195), dropoff_puma UInt16) ENGINE = MergeTree(pickup_date, pickup_datetime, 8192)
</pre></div> <p>在之前的服务器中运行：</p> <div class=codehilite><pre><span></span><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>trips_mergetree_x3</span> <span class=k>AS</span> <span class=n>trips_mergetree_third</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>Distributed</span><span class=p>(</span><span class=n>perftest</span><span class=p>,</span> <span class=k>default</span><span class=p>,</span> <span class=n>trips_mergetree_third</span><span class=p>,</span> <span class=n>rand</span><span class=p>())</span>
</pre></div> <p>运行如下查询重新分布数据：</p> <div class=codehilite><pre><span></span><span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>trips_mergetree_x3</span> <span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>trips_mergetree</span>
</pre></div> <p>这个查询需要运行2454秒。</p> <p>在三台服务器集群中运行的结果：</p> <p>Q1: 0.212 seconds. Q2: 0.438 seconds. Q3: 0.733 seconds. Q4: 1.241 seconds.</p> <p>不出意料，查询是线性扩展的。</p> <p>我们同时在140台服务器的集群中运行的结果：</p> <p>Q1: 0.028 sec. Q2: 0.043 sec. Q3: 0.051 sec. Q4: 0.072 sec.</p> <p>在这种情况下，查询处理时间首先由网络延迟确定。 我们使用位于芬兰的Yandex数据中心中的客户端去位于俄罗斯的集群上运行查询，这增加了大约20毫秒的延迟。</p> <h2 id=zong-jie>总结<a class=headerlink href=#zong-jie title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>servers</th> <th>Q1</th> <th>Q2</th> <th>Q3</th> <th>Q4</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>0.490</td> <td>1.224</td> <td>2.104</td> <td>3.593</td> </tr> <tr> <td>3</td> <td>0.212</td> <td>0.438</td> <td>0.733</td> <td>1.241</td> </tr> <tr> <td>140</td> <td>0.028</td> <td>0.043</td> <td>0.051</td> <td>0.072</td> </tr> </tbody> </table> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../../getting_started/example_datasets/ontime/ title=航班飞行数据 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 后退 </span> 航班飞行数据 </span> </div> </a> <a href=../../../getting_started/example_datasets/amplab_benchmark/ title=AMPLab大数据基准测试 class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 前进 </span> AMPLab大数据基准测试 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> ©2016–2020 Yandex LLC </div> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/modernizr.js></script> <script src=../../../assets/javascripts/application.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/lunr.zh.js></script> <script src=../../../assets/javascripts/lunr/lunr.multi.js></script> <script type=text/javascript>
      function ready(callback){
          if (document.readyState != 'loading') {
              callback();
          } else if (document.addEventListener) {
              document.addEventListener('DOMContentLoaded', callback);
          } else document.attachEvent('onreadystatechange', function() {
              if (document.readyState == 'complete') {
                  callback();
              }
          });
      }
      ready(function () {
          var i;
          
          app.initialize({
              version: "1.0.4",
              url: {
                  base: "../../.."
              }
          });
          var beforePrint = function() {
            var details = document.getElementsByTagName("details");
            for (i = 0; i < details.length; ++i) {
                details[i].open = 1;
            }
          };
          if (window.matchMedia) {
              window.matchMedia('print').addListener(function(q) {
                  if (q.matches) {
                      beforePrint();
                  }
              });
          }
          window.onbeforeprint = beforePrint;

          var name = window.location.hostname.split('.')[0];
          var feedback_address = name + '-feedback' + '@yandex-team.ru';
          var feedback_email = document.getElementsByClassName('feedback-email');
          for (i = 0; i < feedback_email.length; i++) {
            feedback_email[i].setAttribute('href', 'mailto:' + feedback_address);
            feedback_email[i].innerHTML = feedback_address;
          }

          document.getElementById("releases-selector").addEventListener(
            "change",
            function() {
              var target = window.location.href.split('docs')[0] + 'docs/';
              if (this.value) {
                target = target + this.value + '/';
              }
              window.location = target + 'zh';
            }
          )
      });
    </script> <script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script> <script type=text/javascript> docsearch({
apiKey: 'e239649803024433599de47a53b2d416',
indexName: 'yandex_clickhouse',
inputSelector: '#md-search__input',
algoliaOptions: {
  advancedSyntax: true,
  clickAnalytics: true,
  hitsPerPage: 25,
  'facetFilters': ["lang:zh"]
},
debug: false
});
</script> <!-- Yandex.Metrika counter --> <script type=text/javascript>
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter18343495 = new Ya.Metrika2({
                        id:18343495,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor: true
                    });
                } catch(e) { }
            });
            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/tag.js";
            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks2");
    </script> <noscript> <div><img src=https://mc.yandex.ru/watch/18343495 style="position:absolute; left:-9999px;" alt></div> </noscript> <!-- /Yandex.Metrika counter --> </body> </html>