



<!DOCTYPE html>
<html lang="ru" class="no-js" data-version="v19.10" data-single-page="false">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://clickhouse.yandex/docs/ru/query_language/select/">
      
      
      
      <meta name="lang:clipboard.copy" content="Копировать в буфер">
      
      <meta name="lang:clipboard.copied" content="Скопировано в буфер">
      
      <meta name="lang:search.language" content="ru">
      
      <meta name="lang:search.pipeline.stopwords" content="">
      
      <meta name="lang:search.pipeline.trimmer" content="">
      
      <meta name="lang:search.result.none" content="Совпадений не найдено">
      
      <meta name="lang:search.result.one" content="Найдено 1 совпадение">
      
      <meta name="lang:search.result.other" content="Найдено # совпадений">
      
      <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.ico">
    
    
      
        <title>SELECT - Документация ClickHouse v19.10</title>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
      <link rel="stylesheet" href="../../assets/stylesheets/application.2a88008a.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/custom.css?b34fe92?1582275008">
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="white" class="md-lang-ru">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">

  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="/" title="Документация ClickHouse v19.10" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.svg" width="40" height="40">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Документация ClickHouse v19.10
              </span>
              <span class="md-header-nav__topic">
                SELECT
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" id="md-search__input" class="md-search__input" name="query" required placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Начните печатать для поиска
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div id="md-language-switch" class="md-header-nav__source">
            

  <a class="md-alt-lang"
     href="../../../en/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="English">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 60 30"><clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath><path fill="#00247d" d="M0,0 v30 h60 v-30 z"/><path stroke="#fff" stroke-width="6" d="M0,0 L60,30 M60,0 L0,30"/><path stroke="#cf142b" stroke-width="4" d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)"/><path stroke="#fff" stroke-width="10" d="M30,0 v30 M0,15 h60"/><path stroke="#cf142b" stroke-width="6" d="M30,0 v30 M0,15 h60"/></svg>
  </a>

  <a class="md-alt-lang md-current-lang"
     href="../../../ru/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Russian">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 9 6"><rect width="9" height="3" fill="#fff"/><rect width="9" height="3" y="3" fill="#d52b1e"/><rect width="9" height="2" y="2" fill="#0039a6"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../zh/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Chinese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 30 20"><defs><path id="s" fill="#ffde00" d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/></defs><rect width="30" height="20" fill="#de2910"/><use transform="translate(5,5) scale(3)" xlink:href="#s"/><use transform="translate(10,2) rotate(23.036243)" xlink:href="#s"/><use transform="translate(12,4) rotate(45.869898)" xlink:href="#s"/><use transform="translate(12,7) rotate(69.945396)" xlink:href="#s"/><use transform="translate(10,9) rotate(20.659808)" xlink:href="#s"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../ja/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Japanese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="90" height="60" version="1.1" viewBox="0 0 90 60"><g id="surface1"><rect width="90" height="60" x="0" y="0" fill="#A0A0A0" fill-opacity="1" stroke="none"/><path fill="#FFF" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562"/><path fill="#BE0026" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30"/></g></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../fa/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Farsi">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 630 360"><rect width="630" height="360" fill="#da0000"/><rect width="630" height="240" fill="#fff"/><rect width="630" height="120" fill="#239f40"/><g transform="translate(8.4,100.4)"><g id="tb4"><g id="tb1" fill="none" stroke="#fff" stroke-width="2"><path id="tbp1" d="M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9" transform="scale(1.4)"/><path id="tbp2" d="M0,7H9M10,7H19" transform="scale(2.8)"/><use y="120" xlink:href="#tbp2"/><use y="145.2" xlink:href="#tbp1"/></g><g id="tb3"><use x="56" xlink:href="#tb1"/><use x="112" xlink:href="#tb1"/><use x="168" xlink:href="#tb1"/></g></g><use x="168" xlink:href="#tb3"/><use x="392" xlink:href="#tb4"/></g><g fill="#da0000" transform="matrix(45,0,0,45,315,180)"><g id="emblem_half"><path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/><path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/><path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/><path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/></g><use transform="scale(-1,1)" xlink:href="#emblem_half"/></g></svg>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
                      <nav class="md-nav md-nav--primary" data-md-level="0">
  
  <label class="md-nav__title md-nav__title--site" for="drawer">
    Документация ClickHouse v19.10
  </label>

  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Введение
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Введение
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../" title="Обзор" class="md-nav__link">
      Обзор
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/distinctive_features/" title="Отличительные возможности ClickHouse" class="md-nav__link">
      Отличительные возможности ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/features_considered_disadvantages/" title="Особенности ClickHouse, которые могут считаться недостатками" class="md-nav__link">
      Особенности ClickHouse, которые могут считаться недостатками
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/performance/" title="Производительность" class="md-nav__link">
      Производительность
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/ya_metrika_task/" title="Постановка задачи в Яндекс.Метрике" class="md-nav__link">
      Постановка задачи в Яндекс.Метрике
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/info/" title="Информационная поддержка" class="md-nav__link">
      Информационная поддержка
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Начало работы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Начало работы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/" title="Установка и запуск" class="md-nav__link">
      Установка и запуск
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Тестовые наборы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Тестовые наборы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/ontime/" title="OnTime" class="md-nav__link">
      OnTime
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/nyc_taxi/" title="Данные о такси в Нью-Йорке" class="md-nav__link">
      Данные о такси в Нью-Йорке
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/amplab_benchmark/" title="AMPLab Big Data Benchmark" class="md-nav__link">
      AMPLab Big Data Benchmark
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/wikistat/" title="WikiStat" class="md-nav__link">
      WikiStat
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/criteo/" title="Терабайт логов кликов от Criteo" class="md-nav__link">
      Терабайт логов кликов от Criteo
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/star_schema/" title="Схема «Звезда»" class="md-nav__link">
      Схема «Звезда»
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/metrica/" title="Данные Яндекс.Метрики" class="md-nav__link">
      Данные Яндекс.Метрики
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Интерфейсы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Интерфейсы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/cli/" title="Клиент командной строки" class="md-nav__link">
      Клиент командной строки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/tcp/" title="Нативный интерфейс (TCP)" class="md-nav__link">
      Нативный интерфейс (TCP)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/http/" title="HTTP-интерфейс" class="md-nav__link">
      HTTP-интерфейс
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/formats/" title="Форматы входных и выходных данных" class="md-nav__link">
      Форматы входных и выходных данных
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/jdbc/" title="JDBC-драйвер" class="md-nav__link">
      JDBC-драйвер
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/odbc/" title="ODBC-драйвер" class="md-nav__link">
      ODBC-драйвер
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      От сторонних разработчиков
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        От сторонних разработчиков
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/client_libraries/" title="Клиентские библиотеки" class="md-nav__link">
      Клиентские библиотеки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/integrations/" title="Интеграции" class="md-nav__link">
      Интеграции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/gui/" title="Визуальные интерфейсы" class="md-nav__link">
      Визуальные интерфейсы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/proxy/" title="Прокси" class="md-nav__link">
      Прокси
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Типы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Типы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/int_uint/" title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="md-nav__link">
      UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/float/" title="Float32, Float64" class="md-nav__link">
      Float32, Float64
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/decimal/" title="Decimal" class="md-nav__link">
      Decimal
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/boolean/" title="Булевы значения" class="md-nav__link">
      Булевы значения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/string/" title="String" class="md-nav__link">
      String
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/fixedstring/" title="FixedString(N)" class="md-nav__link">
      FixedString(N)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/uuid/" title="UUID" class="md-nav__link">
      UUID
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/date/" title="Date" class="md-nav__link">
      Date
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/datetime/" title="DateTime" class="md-nav__link">
      DateTime
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/enum/" title="Enum" class="md-nav__link">
      Enum
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/array/" title="Array(T)" class="md-nav__link">
      Array(T)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/nested_data_structures/aggregatefunction/" title="AggregateFunction(name, types_of_arguments...)" class="md-nav__link">
      AggregateFunction(name, types_of_arguments...)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/tuple/" title="Tuple(T1, T2, ...)" class="md-nav__link">
      Tuple(T1, T2, ...)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/nullable/" title="Nullable" class="md-nav__link">
      Nullable
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-16" type="checkbox" id="nav-4-16">
    
    <label class="md-nav__link" for="nav-4-16">
      Вложенные структуры данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-16">
        Вложенные структуры данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/nested_data_structures/nested/" title="Nested(Name1 Type1, Name2 Type2, ...)" class="md-nav__link">
      Nested(Name1 Type1, Name2 Type2, ...)
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-17" type="checkbox" id="nav-4-17">
    
    <label class="md-nav__link" for="nav-4-17">
      Служебные типы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-17">
        Служебные типы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/special_data_types/expression/" title="Expression" class="md-nav__link">
      Expression
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/special_data_types/set/" title="Set" class="md-nav__link">
      Set
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/special_data_types/nothing/" title="Nothing" class="md-nav__link">
      Nothing
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-18" type="checkbox" id="nav-4-18">
    
    <label class="md-nav__link" for="nav-4-18">
      Domains
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-18">
        Domains
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/domains/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/domains/ipv4/" title="IPv4" class="md-nav__link">
      IPv4
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/domains/ipv6/" title="IPv6" class="md-nav__link">
      IPv6
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Движки таблиц
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Движки таблиц
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Семейство MergeTree
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Семейство MergeTree
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/mergetree/" title="MergeTree" class="md-nav__link">
      MergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/replication/" title="Репликация данных" class="md-nav__link">
      Репликация данных
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/custom_partitioning_key/" title="Произвольный ключ партиционирования" class="md-nav__link">
      Произвольный ключ партиционирования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/replacingmergetree/" title="ReplacingMergeTree" class="md-nav__link">
      ReplacingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/summingmergetree/" title="SummingMergeTree" class="md-nav__link">
      SummingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/aggregatingmergetree/" title="AggregatingMergeTree" class="md-nav__link">
      AggregatingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/collapsingmergetree/" title="CollapsingMergeTree" class="md-nav__link">
      CollapsingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/versionedcollapsingmergetree/" title="VersionedCollapsingMergeTree" class="md-nav__link">
      VersionedCollapsingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/graphitemergetree/" title="GraphiteMergeTree" class="md-nav__link">
      GraphiteMergeTree
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Семейство Log
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Семейство Log
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/log_family/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/stripelog/" title="StripeLog" class="md-nav__link">
      StripeLog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/tinylog/" title="TinyLog" class="md-nav__link">
      TinyLog
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Интеграции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        Интеграции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/kafka/" title="Kafka" class="md-nav__link">
      Kafka
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/mysql/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      Особые
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        Особые
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/distributed/" title="Distributed" class="md-nav__link">
      Distributed
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/external_data/" title="Внешние данные" class="md-nav__link">
      Внешние данные
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/dictionary/" title="Dictionary" class="md-nav__link">
      Dictionary
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/merge/" title="Merge" class="md-nav__link">
      Merge
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/file/" title="File" class="md-nav__link">
      File
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/null/" title="Null" class="md-nav__link">
      Null
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/set/" title="Set" class="md-nav__link">
      Set
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/join/" title="Join" class="md-nav__link">
      Join
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/url/" title="URL" class="md-nav__link">
      URL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/view/" title="View" class="md-nav__link">
      View
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/materializedview/" title="MaterializedView" class="md-nav__link">
      MaterializedView
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/memory/" title="Memory" class="md-nav__link">
      Memory
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/buffer/" title="Buffer" class="md-nav__link">
      Buffer
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/jdbc/" title="JDBC" class="md-nav__link">
      JDBC
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/odbc/" title="ODBC" class="md-nav__link">
      ODBC
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      


  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Справка по SQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Справка по SQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        SELECT
      </label>
    
    <a href="../../query_language/select/" title="SELECT" class="md-nav__link md-nav__link--active">
      <strong>SELECT</strong>
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sektsiia-from" title="Секция FROM" class="md-nav__link">
    Секция FROM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-sample-clause" title="Секция SAMPLE" class="md-nav__link">
    Секция SAMPLE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-sample-k" title="SAMPLE k" class="md-nav__link">
    SAMPLE k
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-sample-n" title="SAMPLE n" class="md-nav__link">
    SAMPLE n
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-sample-offset" title="SAMPLE k OFFSET m" class="md-nav__link">
    SAMPLE k OFFSET m
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-array-join-clause" title="Секция ARRAY JOIN" class="md-nav__link">
    Секция ARRAY JOIN
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ispolzovanie-aliasov" title="Использование алиасов" class="md-nav__link">
    Использование алиасов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-join-s-vlozhennymi-strukturami-dannykh" title="ARRAY JOIN с вложенными структурами данных" class="md-nav__link">
    ARRAY JOIN с вложенными структурами данных
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-join" title="Секция JOIN" class="md-nav__link">
    Секция JOIN
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mnozhestvennyi-join" title="Множественный JOIN" class="md-nav__link">
    Множественный JOIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#any-ili-all-strogost" title="ANY или ALL - строгость:" class="md-nav__link">
    ANY или ALL - строгость:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obrabotka-pustykh-iacheek-i-null" title="Обработка пустых ячеек и NULL" class="md-nav__link">
    Обработка пустых ячеек и NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ogranicheniia-sintaksisa" title="Ограничения синтаксиса" class="md-nav__link">
    Ограничения синтаксиса
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-where" title="Секция WHERE" class="md-nav__link">
    Секция WHERE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-prewhere" title="Секция PREWHERE" class="md-nav__link">
    Секция PREWHERE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-group-by-clause" title="Секция GROUP BY" class="md-nav__link">
    Секция GROUP BY
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obrabotka-null" title="Обработка NULL" class="md-nav__link">
    Обработка NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifikator-with-totals" title="Модификатор WITH TOTALS" class="md-nav__link">
    Модификатор WITH TOTALS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-group-by-in-external-memory" title="GROUP BY во внешней памяти" class="md-nav__link">
    GROUP BY во внешней памяти
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-limit-by" title="Секция LIMIT BY" class="md-nav__link">
    Секция LIMIT BY
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-having" title="Секция HAVING" class="md-nav__link">
    Секция HAVING
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-order-by" title="Секция ORDER BY" class="md-nav__link">
    Секция ORDER BY
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-select" title="Секция SELECT" class="md-nav__link">
    Секция SELECT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-distinct" title="Секция DISTINCT" class="md-nav__link">
    Секция DISTINCT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-limit" title="Секция LIMIT" class="md-nav__link">
    Секция LIMIT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-union-all" title="Секция UNION ALL" class="md-nav__link">
    Секция UNION ALL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-into-outfile" title="Секция INTO OUTFILE" class="md-nav__link">
    Секция INTO OUTFILE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-format" title="Секция FORMAT" class="md-nav__link">
    Секция FORMAT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-in-operators" title="Операторы IN" class="md-nav__link">
    Операторы IN
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obrabotka-null_1" title="Обработка NULL" class="md-nav__link">
    Обработка NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-distributed-subqueries" title="Распределённые подзапросы" class="md-nav__link">
    Распределённые подзапросы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ekstremalnye-znacheniia" title="Экстремальные значения" class="md-nav__link">
    Экстремальные значения
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamechaniia" title="Замечания" class="md-nav__link">
    Замечания
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/insert_into/" title="INSERT INTO" class="md-nav__link">
      INSERT INTO
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/create/" title="CREATE" class="md-nav__link">
      CREATE
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/alter/" title="ALTER" class="md-nav__link">
      ALTER
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/misc/" title="Прочие виды запросов" class="md-nav__link">
      Прочие виды запросов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7" type="checkbox" id="nav-6-7">
    
    <label class="md-nav__link" for="nav-6-7">
      Функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-7">
        Функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/arithmetic_functions/" title="Арифметические функции" class="md-nav__link">
      Арифметические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/comparison_functions/" title="Функции сравнения" class="md-nav__link">
      Функции сравнения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/logical_functions/" title="Логические функции" class="md-nav__link">
      Логические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/type_conversion_functions/" title="Функции преобразования типов" class="md-nav__link">
      Функции преобразования типов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/date_time_functions/" title="Функции для работы с датами и временем" class="md-nav__link">
      Функции для работы с датами и временем
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/string_functions/" title="Функции для работы со строками" class="md-nav__link">
      Функции для работы со строками
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/string_search_functions/" title="Функции поиска в строках" class="md-nav__link">
      Функции поиска в строках
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/string_replace_functions/" title="Функции поиска и замены в строках" class="md-nav__link">
      Функции поиска и замены в строках
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/conditional_functions/" title="Условные функции" class="md-nav__link">
      Условные функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/math_functions/" title="Математические функции" class="md-nav__link">
      Математические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/rounding_functions/" title="Функции округления" class="md-nav__link">
      Функции округления
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/array_functions/" title="Функции по работе с массивами" class="md-nav__link">
      Функции по работе с массивами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/splitting_merging_functions/" title="Функции разбиения и слияния строк и массивов" class="md-nav__link">
      Функции разбиения и слияния строк и массивов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/bit_functions/" title="Битовые функции" class="md-nav__link">
      Битовые функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/bitmap_functions/" title="Функции для битмапов" class="md-nav__link">
      Функции для битмапов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/hash_functions/" title="Функции хэширования" class="md-nav__link">
      Функции хэширования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/random_functions/" title="Функции генерации псевдослучайных чисел" class="md-nav__link">
      Функции генерации псевдослучайных чисел
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/uuid_functions/" title="Функции для работы с UUID" class="md-nav__link">
      Функции для работы с UUID
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/encoding_functions/" title="Функции кодирования" class="md-nav__link">
      Функции кодирования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/url_functions/" title="Функции для работы с URL" class="md-nav__link">
      Функции для работы с URL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/ip_address_functions/" title="Функции для работы с IP-адресами" class="md-nav__link">
      Функции для работы с IP-адресами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/json_functions/" title="Функции для работы с JSON." class="md-nav__link">
      Функции для работы с JSON.
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/higher_order_functions/" title="Функции высшего порядка" class="md-nav__link">
      Функции высшего порядка
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/ext_dict_functions/" title="Функции для работы с внешними словарями" class="md-nav__link">
      Функции для работы с внешними словарями
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/ym_dict_functions/" title="Функции для работы со словарями Яндекс.Метрики" class="md-nav__link">
      Функции для работы со словарями Яндекс.Метрики
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/in_functions/" title="Функции для реализации оператора IN." class="md-nav__link">
      Функции для реализации оператора IN.
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/array_join/" title="Функция arrayJoin" class="md-nav__link">
      Функция arrayJoin
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/geo/" title="Функции для работы с географическими координатами" class="md-nav__link">
      Функции для работы с географическими координатами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/functions_for_nulls/" title="Функции c Nullable агрументами" class="md-nav__link">
      Функции c Nullable агрументами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/machine_learning_functions/" title="Функции машинного обучения" class="md-nav__link">
      Функции машинного обучения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/other_functions/" title="Прочие функции" class="md-nav__link">
      Прочие функции
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-8" type="checkbox" id="nav-6-8">
    
    <label class="md-nav__link" for="nav-6-8">
      Агрегатные функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-8">
        Агрегатные функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/reference/" title="Справочник функций" class="md-nav__link">
      Справочник функций
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/combinators/" title="Комбинаторы агрегатных функций" class="md-nav__link">
      Комбинаторы агрегатных функций
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/parametric_functions/" title="Параметрические агрегатные функции" class="md-nav__link">
      Параметрические агрегатные функции
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-9" type="checkbox" id="nav-6-9">
    
    <label class="md-nav__link" for="nav-6-9">
      Табличные функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-9">
        Табличные функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/file/" title="file" class="md-nav__link">
      file
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/merge/" title="merge" class="md-nav__link">
      merge
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/numbers/" title="numbers" class="md-nav__link">
      numbers
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/remote/" title="remote" class="md-nav__link">
      remote
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/url/" title="url" class="md-nav__link">
      url
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/mysql/" title="mysql" class="md-nav__link">
      mysql
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/jdbc/" title="jdbc" class="md-nav__link">
      jdbc
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/odbc/" title="odbc" class="md-nav__link">
      odbc
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-10" type="checkbox" id="nav-6-10">
    
    <label class="md-nav__link" for="nav-6-10">
      Словари
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-10">
        Словари
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-10-2" type="checkbox" id="nav-6-10-2">
    
    <label class="md-nav__link" for="nav-6-10-2">
      Внешние словари
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-10-2">
        Внешние словари
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts/" title="Общее описание" class="md-nav__link">
      Общее описание
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict/" title="Настройка внешнего словаря" class="md-nav__link">
      Настройка внешнего словаря
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_layout/" title="Хранение словарей в памяти" class="md-nav__link">
      Хранение словарей в памяти
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_lifetime/" title="Обновление словарей" class="md-nav__link">
      Обновление словарей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_sources/" title="Источники внешних словарей" class="md-nav__link">
      Источники внешних словарей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_structure/" title="Ключ и поля словаря" class="md-nav__link">
      Ключ и поля словаря
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/internal_dicts/" title="Встроенные словари" class="md-nav__link">
      Встроенные словари
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/operators/" title="Операторы" class="md-nav__link">
      Операторы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/syntax/" title="Общий синтаксис" class="md-nav__link">
      Общий синтаксис
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Эксплуатация
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Эксплуатация
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/requirements/" title="Требования" class="md-nav__link">
      Требования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/monitoring/" title="Мониторинг" class="md-nav__link">
      Мониторинг
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/troubleshooting/" title="Устранение неисправностей" class="md-nav__link">
      Устранение неисправностей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/tips/" title="Советы по эксплуатации" class="md-nav__link">
      Советы по эксплуатации
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/update/" title="Обновление ClickHouse" class="md-nav__link">
      Обновление ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/access_rights/" title="Права доступа" class="md-nav__link">
      Права доступа
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/backup/" title="Резервное копирование" class="md-nav__link">
      Резервное копирование
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/configuration_files/" title="Конфигурационные файлы" class="md-nav__link">
      Конфигурационные файлы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/quotas/" title="Квоты" class="md-nav__link">
      Квоты
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/system_tables/" title="Системные таблицы" class="md-nav__link">
      Системные таблицы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-12" type="checkbox" id="nav-7-12">
    
    <label class="md-nav__link" for="nav-7-12">
      Конфигурационные параметры сервера
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-12">
        Конфигурационные параметры сервера
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/server_settings/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/server_settings/settings/" title="Серверные настройки" class="md-nav__link">
      Серверные настройки
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-13" type="checkbox" id="nav-7-13">
    
    <label class="md-nav__link" for="nav-7-13">
      Настройки
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-13">
        Настройки
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/permissions_for_queries/" title="Разрешения на выполнение запросов" class="md-nav__link">
      Разрешения на выполнение запросов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/query_complexity/" title="Ограничения на сложность запроса" class="md-nav__link">
      Ограничения на сложность запроса
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/settings/" title="Настройки" class="md-nav__link">
      Настройки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/constraints_on_settings/" title="Ограничения на изменение настроек" class="md-nav__link">
      Ограничения на изменение настроек
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/settings_profiles/" title="Профили настроек" class="md-nav__link">
      Профили настроек
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-14" type="checkbox" id="nav-7-14">
    
    <label class="md-nav__link" for="nav-7-14">
      Утилиты
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-14">
        Утилиты
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/utils/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/utils/clickhouse-copier/" title="clickhouse-copier" class="md-nav__link">
      clickhouse-copier
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/utils/clickhouse-local/" title="clickhouse-local" class="md-nav__link">
      clickhouse-local
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      F.A.Q.
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        F.A.Q.
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../faq/general/" title="Общие вопросы" class="md-nav__link">
      Общие вопросы
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Разработка
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Разработка
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/architecture/" title="Обзор архитектуры ClickHouse" class="md-nav__link">
      Обзор архитектуры ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/build/" title="Как собрать ClickHouse на Linux" class="md-nav__link">
      Как собрать ClickHouse на Linux
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/build_osx/" title="Как собрать ClickHouse на Mac OS X" class="md-nav__link">
      Как собрать ClickHouse на Mac OS X
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/style/" title="Как писать код на C++" class="md-nav__link">
      Как писать код на C++
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/tests/" title="Как запустить тесты" class="md-nav__link">
      Как запустить тесты
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/contrib/" title="Сторонние библиотеки" class="md-nav__link">
      Сторонние библиотеки
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Что нового
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Что нового
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../security_changelog/" title="Security changelog" class="md-nav__link">
      Security changelog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
  </ul>
  

  <ul id="md-extra-nav" class="md-nav__list" data-md-scrollfix>
    <li class="md-nav__item md-nav__item--active">
      Релиз:
      <span class="md-selector">
        <select id="releases-selector">
          <option value="">последний</option>
          
            <option value="v20.1"
              
            >v20.1</option>
          
            <option value="v19.17"
              
            >v19.17</option>
          
            <option value="v19.16"
              
            >v19.16</option>
          
            <option value="v19.15"
              
            >v19.15</option>
          
            <option value="v19.14"
              
            >v19.14</option>
          
            <option value="v19.13"
              
            >v19.13</option>
          
            <option value="v19.11"
              
            >v19.11</option>
          
            <option value="v19.10"
              
                selected="selected"
              
            >v19.10</option>
          
            <option value="v19.9"
              
            >v19.9</option>
          
            <option value="v19.8"
              
            >v19.8</option>
          
            <option value="v19.7"
              
            >v19.7</option>
          
        </select><span id="releases-selector-after">&nbsp;▾</span>
      </span>
    </li>
    <li class="md-nav__item md-nav__item--active">
        
          <a href="../../single/" class="md-nav__link md-nav__link--active">Одностраничная версия</a>
        
    </li>
    <li class="md-nav__item md-nav__item--active">
          <a href="../../single/clickhouse_ru.pdf" class="md-nav__link md-nav__link--active">PDF версия</a>
    </li>
    
    <li class="md-nav__item md-nav__item--active">
      <a href="https://github.com/ClickHouse/ClickHouse/" rel="external nofollow" target="_blank" class="md-nav__link">
        Исходный код ClickHouse
      </a>
    </li>
    
    <li class="md-nav__item md-nav__item--active">
        <span id="md-sidebar-flags" class="md-nav__link">
        

  <a class="md-alt-lang"
     href="../../../en/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="English">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 60 30"><clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath><path fill="#00247d" d="M0,0 v30 h60 v-30 z"/><path stroke="#fff" stroke-width="6" d="M0,0 L60,30 M60,0 L0,30"/><path stroke="#cf142b" stroke-width="4" d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)"/><path stroke="#fff" stroke-width="10" d="M30,0 v30 M0,15 h60"/><path stroke="#cf142b" stroke-width="6" d="M30,0 v30 M0,15 h60"/></svg>
  </a>

  <a class="md-alt-lang md-current-lang"
     href="../../../ru/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Russian">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 9 6"><rect width="9" height="3" fill="#fff"/><rect width="9" height="3" y="3" fill="#d52b1e"/><rect width="9" height="2" y="2" fill="#0039a6"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../zh/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Chinese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 30 20"><defs><path id="s" fill="#ffde00" d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/></defs><rect width="30" height="20" fill="#de2910"/><use transform="translate(5,5) scale(3)" xlink:href="#s"/><use transform="translate(10,2) rotate(23.036243)" xlink:href="#s"/><use transform="translate(12,4) rotate(45.869898)" xlink:href="#s"/><use transform="translate(12,7) rotate(69.945396)" xlink:href="#s"/><use transform="translate(10,9) rotate(20.659808)" xlink:href="#s"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../ja/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Japanese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="90" height="60" version="1.1" viewBox="0 0 90 60"><g id="surface1"><rect width="90" height="60" x="0" y="0" fill="#A0A0A0" fill-opacity="1" stroke="none"/><path fill="#FFF" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562"/><path fill="#BE0026" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30"/></g></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../fa/query_language/select/" class="md-flex__ellipsis md-header-nav__title"
     title="Farsi">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 630 360"><rect width="630" height="360" fill="#da0000"/><rect width="630" height="240" fill="#fff"/><rect width="630" height="120" fill="#239f40"/><g transform="translate(8.4,100.4)"><g id="tb4"><g id="tb1" fill="none" stroke="#fff" stroke-width="2"><path id="tbp1" d="M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9" transform="scale(1.4)"/><path id="tbp2" d="M0,7H9M10,7H19" transform="scale(2.8)"/><use y="120" xlink:href="#tbp2"/><use y="145.2" xlink:href="#tbp1"/></g><g id="tb3"><use x="56" xlink:href="#tb1"/><use x="112" xlink:href="#tb1"/><use x="168" xlink:href="#tb1"/></g></g><use x="168" xlink:href="#tb3"/><use x="392" xlink:href="#tb4"/></g><g fill="#da0000" transform="matrix(45,0,0,45,315,180)"><g id="emblem_half"><path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/><path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/><path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/><path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/></g><use transform="scale(-1,1)" xlink:href="#emblem_half"/></g></svg>
  </a>

        </span>
    </li>
  </ul>
</nav>
                    
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
                      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sektsiia-from" title="Секция FROM" class="md-nav__link">
    Секция FROM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-sample-clause" title="Секция SAMPLE" class="md-nav__link">
    Секция SAMPLE
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-sample-k" title="SAMPLE k" class="md-nav__link">
    SAMPLE k
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-sample-n" title="SAMPLE n" class="md-nav__link">
    SAMPLE n
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-sample-offset" title="SAMPLE k OFFSET m" class="md-nav__link">
    SAMPLE k OFFSET m
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-array-join-clause" title="Секция ARRAY JOIN" class="md-nav__link">
    Секция ARRAY JOIN
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ispolzovanie-aliasov" title="Использование алиасов" class="md-nav__link">
    Использование алиасов
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-join-s-vlozhennymi-strukturami-dannykh" title="ARRAY JOIN с вложенными структурами данных" class="md-nav__link">
    ARRAY JOIN с вложенными структурами данных
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-join" title="Секция JOIN" class="md-nav__link">
    Секция JOIN
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mnozhestvennyi-join" title="Множественный JOIN" class="md-nav__link">
    Множественный JOIN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#any-ili-all-strogost" title="ANY или ALL - строгость:" class="md-nav__link">
    ANY или ALL - строгость:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obrabotka-pustykh-iacheek-i-null" title="Обработка пустых ячеек и NULL" class="md-nav__link">
    Обработка пустых ячеек и NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ogranicheniia-sintaksisa" title="Ограничения синтаксиса" class="md-nav__link">
    Ограничения синтаксиса
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-where" title="Секция WHERE" class="md-nav__link">
    Секция WHERE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-prewhere" title="Секция PREWHERE" class="md-nav__link">
    Секция PREWHERE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-group-by-clause" title="Секция GROUP BY" class="md-nav__link">
    Секция GROUP BY
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obrabotka-null" title="Обработка NULL" class="md-nav__link">
    Обработка NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifikator-with-totals" title="Модификатор WITH TOTALS" class="md-nav__link">
    Модификатор WITH TOTALS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-group-by-in-external-memory" title="GROUP BY во внешней памяти" class="md-nav__link">
    GROUP BY во внешней памяти
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-limit-by" title="Секция LIMIT BY" class="md-nav__link">
    Секция LIMIT BY
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-having" title="Секция HAVING" class="md-nav__link">
    Секция HAVING
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-order-by" title="Секция ORDER BY" class="md-nav__link">
    Секция ORDER BY
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-select" title="Секция SELECT" class="md-nav__link">
    Секция SELECT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-distinct" title="Секция DISTINCT" class="md-nav__link">
    Секция DISTINCT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-limit" title="Секция LIMIT" class="md-nav__link">
    Секция LIMIT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-union-all" title="Секция UNION ALL" class="md-nav__link">
    Секция UNION ALL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-into-outfile" title="Секция INTO OUTFILE" class="md-nav__link">
    Секция INTO OUTFILE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sektsiia-format" title="Секция FORMAT" class="md-nav__link">
    Секция FORMAT
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-in-operators" title="Операторы IN" class="md-nav__link">
    Операторы IN
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obrabotka-null_1" title="Обработка NULL" class="md-nav__link">
    Обработка NULL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-distributed-subqueries" title="Распределённые подзапросы" class="md-nav__link">
    Распределённые подзапросы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ekstremalnye-znacheniia" title="Экстремальные значения" class="md-nav__link">
    Экстремальные значения
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamechaniia" title="Замечания" class="md-nav__link">
    Замечания
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                    
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  
                    <a href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/query_language/select.md" title="Редактировать страницу" class="md-icon md-content__icon" rel="external nofollow">&#xE3C9;</a>
                  
                
                
                <div id="content">
                
                  <h1 id="sintaksis-zaprosov-select">Синтаксис запросов SELECT<a class="headerlink" href="#sintaksis-zaprosov-select" title="Permanent link">&para;</a></h1>
<p><code>SELECT</code> осуществляет выборку данных.</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="p">[</span><span class="k">DISTINCT</span><span class="p">]</span> <span class="n">expr_list</span>
    <span class="p">[</span><span class="k">FROM</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table</span> <span class="o">|</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span> <span class="o">|</span> <span class="n">table_function</span><span class="p">]</span> <span class="p">[</span><span class="k">FINAL</span><span class="p">]</span>
    <span class="p">[</span><span class="n">SAMPLE</span> <span class="n">sample_coeff</span><span class="p">]</span>
    <span class="p">[</span><span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="p">...]</span>
    <span class="p">[</span><span class="k">GLOBAL</span><span class="p">]</span> <span class="p">[</span><span class="k">ANY</span><span class="o">|</span><span class="k">ALL</span><span class="p">]</span> <span class="p">[</span><span class="k">INNER</span><span class="o">|</span><span class="k">LEFT</span><span class="o">|</span><span class="k">RIGHT</span><span class="o">|</span><span class="k">FULL</span><span class="o">|</span><span class="k">CROSS</span><span class="p">]</span> <span class="p">[</span><span class="k">OUTER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="p">(</span><span class="n">subquery</span><span class="p">)</span><span class="o">|</span><span class="k">table</span> <span class="k">USING</span> <span class="n">columns_list</span>
    <span class="p">[</span><span class="n">PREWHERE</span> <span class="n">expr</span><span class="p">]</span>
    <span class="p">[</span><span class="k">WHERE</span> <span class="n">expr</span><span class="p">]</span>
    <span class="p">[</span><span class="k">GROUP</span> <span class="k">BY</span> <span class="n">expr_list</span><span class="p">]</span> <span class="p">[</span><span class="k">WITH</span> <span class="n">TOTALS</span><span class="p">]</span>
    <span class="p">[</span><span class="k">HAVING</span> <span class="n">expr</span><span class="p">]</span>
    <span class="p">[</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">expr_list</span><span class="p">]</span>
    <span class="p">[</span><span class="k">LIMIT</span> <span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">]</span><span class="n">m</span><span class="p">]</span>
    <span class="p">[</span><span class="k">UNION</span> <span class="k">ALL</span> <span class="p">...]</span>
    <span class="p">[</span><span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="n">filename</span><span class="p">]</span>
    <span class="p">[</span><span class="n">FORMAT</span> <span class="n">format</span><span class="p">]</span>
    <span class="p">[</span><span class="k">LIMIT</span> <span class="p">[</span><span class="n">offset_value</span><span class="p">,</span> <span class="p">]</span><span class="n">n</span> <span class="k">BY</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>


<p>Все секции, кроме списка выражений сразу после SELECT, являются необязательными.
Ниже секции будут описаны в порядке, почти соответствующем конвейеру выполнения запроса.</p>
<p>Если в запросе отсутствуют секции <code>DISTINCT</code>, <code>GROUP BY</code>, <code>ORDER BY</code>, подзапросы в <code>IN</code> и <code>JOIN</code>, то запрос будет обработан полностью потоково, с использованием O(1) количества оперативки.
Иначе запрос может съесть много оперативки, если не указаны подходящие ограничения <code>max_memory_usage</code>, <code>max_rows_to_group_by</code>, <code>max_rows_to_sort</code>, <code>max_rows_in_distinct</code>, <code>max_bytes_in_distinct</code>, <code>max_rows_in_set</code>, <code>max_bytes_in_set</code>, <code>max_rows_in_join</code>, <code>max_bytes_in_join</code>, <code>max_bytes_before_external_sort</code>, <code>max_bytes_before_external_group_by</code>. Подробнее смотрите в разделе "Настройки". Присутствует возможность использовать внешнюю сортировку (с сохранением временных данных на диск) и внешнюю агрегацию. <code>Merge join</code> в системе нет.</p>
<h3 id="sektsiia-from">Секция FROM<a class="headerlink" href="#sektsiia-from" title="Permanent link">&para;</a></h3>
<p>Если секция FROM отсутствует, то данные будут читаться из таблицы <code>system.one</code>.
Таблица system.one содержит ровно одну строку (то есть, эта таблица выполняет такую же роль, как таблица DUAL, которую можно найти в других СУБД).</p>
<p>В секции FROM указывается таблица, из которой будут читаться данные, либо подзапрос, либо табличная функция; дополнительно могут присутствовать ARRAY JOIN и обычный JOIN (смотрите ниже).</p>
<p>Вместо таблицы, может быть указан подзапрос SELECT в скобках.
В этом случае, конвейер обработки подзапроса будет встроен в конвейер обработки внешнего запроса.
В отличие от стандартного SQL, после подзапроса не нужно указывать его синоним. Для совместимости, присутствует возможность написать AS name после подзапроса, но указанное имя нигде не используется.</p>
<p>Вместо таблицы, может быть указана табличная функция. Подробнее смотрите раздел "Табличные функции".</p>
<p>Для выполнения запроса, из соответствующей таблицы, вынимаются все столбцы, перечисленные в запросе. Из подзапросов выкидываются столбцы, не нужные для внешнего запроса.
Если в запросе не перечислено ни одного столбца (например, SELECT count() FROM t), то из таблицы всё равно вынимается один какой-нибудь столбец (предпочитается самый маленький), для того, чтобы можно было хотя бы посчитать количество строк.</p>
<p>Модификатор FINAL может быть использован только при SELECT-е из таблицы типа CollapsingMergeTree. При указании FINAL, данные будут выбираться полностью "сколлапсированными". Стоит учитывать, что использование FINAL приводит к выбору кроме указанных в SELECT-е столбцов также столбцов, относящихся к первичному ключу. Также, запрос будет выполняться в один поток, и при выполнении запроса будет выполняться слияние данных. Это приводит к тому, что при использовании FINAL, запрос выполняется медленнее. В большинстве случаев, следует избегать использования FINAL. Подробнее смотрите раздел "Движок CollapsingMergeTree".</p>
<h3 id="select-sample-clause">Секция SAMPLE<a class="headerlink" href="#select-sample-clause" title="Permanent link">&para;</a></h3>
<p>Секция <code>SAMPLE</code> позволяет выполнять запросы приближённо. Например, чтобы посчитать статистику по всем визитам, можно обработать 1/10 всех визитов и результат домножить на 10.</p>
<p>Сэмплирование имеет смысл, когда:</p>
<ol>
<li>Точность результата не важна, например, для оценочных расчетов.</li>
<li>Возможности аппаратной части не позволяют соответствовать строгим критериям. Например, время ответа должно быть &lt;100 мс. При этом точность расчета имеет более низкий приоритет.</li>
<li>Точность результата участвует в бизнес-модели сервиса. Например, пользователи с бесплатной подпиской на сервис могут получать отчеты с меньшей точностью, чем пользователи с премиум подпиской.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Внимание</p>
<p>Не стоит использовать сэмплирование в тех задачах, где важна точность расчетов. Например, при работе с финансовыми отчетами.</p>
</div>
<p>Свойства сэмплирования:</p>
<ul>
<li>Сэмплирование работает детерминированно. При многократном выполнении одного и того же запроса <code>SELECT .. SAMPLE</code>, результат всегда будет одинаковым.</li>
<li>Сэмплирование поддерживает консистентность для разных таблиц. Имеется в виду, что для таблиц с одним и тем же ключом сэмплирования, подмножество данных в выборках будет одинаковым (выборки при этом должны быть сформированы для одинаковой доли данных). Например, выборка по идентификаторам посетителей выберет из разных таблиц строки с одинаковым подмножеством всех возможных идентификаторов. Это свойство позволяет использовать выборки в подзапросах в секции <a href="#select-in-operators">IN</a>, а также объединять выборки с помощью <a href="#select-join">JOIN</a>.</li>
<li>Сэмплирование позволяет читать меньше данных с диска. Обратите внимание, для этого необходимо корректно указать ключ сэмплирования. Подробнее см. в разделе <a href="../../operations/table_engines/mergetree/#table_engine-mergetree-creating-a-table">Создание таблицы MergeTree</a>.</li>
</ul>
<p>Сэмплирование поддерживается только таблицами семейства <a href="../../operations/table_engines/mergetree/">MergeTree</a> и только в том случае, если для таблиц был указан ключ сэмплирования (выражение, на основе которого должна производиться выборка). Подробнее см. в разделе <a href="../../operations/table_engines/mergetree/#table_engine-mergetree-creating-a-table">Создание таблиц MergeTree</a>.</p>
<p>Выражение <code>SAMPLE</code> в запросе можно задать следующими способами:</p>
<table>
<thead>
<tr>
<th>Способ&#160;задания&#160;SAMPLE</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SAMPLE k</code></td>
<td>Здесь <code>k</code> – это дробное число в интервале от 0 до 1.<br/> Запрос будет выполнен по <code>k</code> доле данных. Например, если указано <code>SAMPLE 1/10</code>, то запрос будет выполнен для выборки из 1/10 данных. <a href="#select-sample-k">Подробнее</a></td>
</tr>
<tr>
<td><code>SAMPLE n</code></td>
<td>Здесь <code>n</code> – это достаточно большое целое число.</br> Запрос будет выполнен для выборки, состоящей из не менее чем <code>n</code> строк. Например, если указано <code>SAMPLE 10000000</code>, то запрос будет выполнен для не менее чем 10,000,000 строк. <a href="#select-sample-n">Подробнее</a></td>
</tr>
<tr>
<td><code>SAMPLE k OFFSET m</code></td>
<td>Здесь <code>k</code> и <code>m</code> – числа от 0 до 1.</br> Запрос будет выполнен по <code>k</code> доле данных. При этом выборка будет сформирована со смещением на <code>m</code> долю. <a href="#select-sample-offset">Подробнее</a></td>
</tr>
</tbody>
</table>
<h4 id="select-sample-k">SAMPLE k<a class="headerlink" href="#select-sample-k" title="Permanent link">&para;</a></h4>
<p>Здесь <code>k</code> – число в интервале от 0 до 1. Поддерживается как дробная, так и десятичная форма записи. Например, <code>SAMPLE 1/2</code> или <code>SAMPLE 0.5</code>.</p>
<p>Если задано выражение <code>SAMPLE k</code>, запрос будет выполнен для <code>k</code> доли данных. Рассмотрим пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="n">Title</span><span class="p">,</span>
    <span class="k">count</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">AS</span> <span class="n">PageViews</span>
<span class="k">FROM</span> <span class="n">hits_distributed</span>
<span class="n">SAMPLE</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
<span class="k">WHERE</span>
    <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">Title</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">PageViews</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1000</span>
</pre></div>


<p>В этом примере запрос выполняется по выборке из 0.1 (10%) данных. Значения агрегатных функций не корректируются автоматически, поэтому чтобы получить приближённый результат, значение <code>count()</code> нужно вручную умножить на 10.</p>
<p>Выборка с указанием относительного коэффициента является "согласованной": для таблиц с одним и тем же ключом сэмплирования, выборка с одинаковой относительной долей всегда будет составлять одно и то же подмножество данных. То есть выборка из разных таблиц, на разных серверах, в разное время, формируется одинаковым образом.</p>
<h4 id="select-sample-n">SAMPLE n<a class="headerlink" href="#select-sample-n" title="Permanent link">&para;</a></h4>
<p>Здесь <code>n</code> – это достаточно большое целое число. Например, <code>SAMPLE 10000000</code>.</p>
<p>Если задано выражение <code>SAMPLE n</code>, запрос будет выполнен для выборки из не менее <code>n</code> строк (но не значительно больше этого значения). Например, если задать <code>SAMPLE 10000000</code>, в выборку попадут не менее 10,000,000 строк.</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Следует иметь в виду, что <code>n</code> должно быть достаточно большим числом. Так как минимальной единицей данных для чтения является одна гранула (её размер задаётся настройкой <code>index_granularity</code> для таблицы), имеет смысл создавать выборки, размер которых существенно превосходит размер гранулы.</p>
</div>
<p>При выполнении <code>SAMPLE n</code> коэффициент сэмплирования заранее неизвестен (то есть нет информации о том, относительно какого количества данных будет сформирована выборка). Чтобы узнать коэффициент сэмплирования, используйте столбец <code>_sample_factor</code>.</p>
<p>Виртуальный столбец <code>_sample_factor</code> автоматически создается в тех таблицах, для которых задано выражение <code>SAMPLE BY</code> (подробнее см. в разделе <a href="../../operations/table_engines/mergetree/#table_engine-mergetree-creating-a-table">Создание таблицы MergeTree</a>). В столбце содержится коэффициент сэмплирования для таблицы – он рассчитывается динамически по мере добавления данных в таблицу. Ниже приведены примеры использования столбца <code>_sample_factor</code>.</p>
<p>Предположим, у нас есть таблица, в которой ведется статистика посещений сайта. Пример ниже показывает, как рассчитать суммарное число просмотров:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">PageViews</span> <span class="o">*</span> <span class="n">_sample_factor</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">visits</span>
<span class="n">SAMPLE</span> <span class="mi">10000000</span>
</pre></div>


<p>Следующий пример показывает, как посчитать общее число визитов:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">_sample_factor</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">visits</span>
<span class="n">SAMPLE</span> <span class="mi">10000000</span>
</pre></div>


<p>В примере ниже рассчитывается среднее время на сайте. Обратите внимание, при расчете средних значений, умножать результат на коэффициент сэмплирования не нужно.</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">avg</span><span class="p">(</span><span class="n">Duration</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">visits</span>
<span class="n">SAMPLE</span> <span class="mi">10000000</span>
</pre></div>


<h4 id="select-sample-offset">SAMPLE k OFFSET m<a class="headerlink" href="#select-sample-offset" title="Permanent link">&para;</a></h4>
<p>Здесь <code>k</code> и <code>m</code> – числа в интервале от 0 до 1. Например, <code>SAMPLE 0.1 OFFSET 0.5</code>. Поддерживается как дробная, так и десятичная форма записи.</p>
<p>При задании <code>SAMPLE k OFFSET m</code>, выборка будет сформирована из <code>k</code> доли данных со смещением на долю <code>m</code>. Примеры приведены ниже.</p>
<p><strong>Пример 1</strong></p>
<div class="codehilite"><pre><span></span><span class="n">SAMPLE</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span>
</pre></div>


<p>В этом примере выборка будет сформирована по 1/10 доле всех данных:</p>
<p><code>[++------------------]</code></p>
<p><strong>Пример 2</strong></p>
<div class="codehilite"><pre><span></span><span class="n">SAMPLE</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span> <span class="k">OFFSET</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span>
</pre></div>


<p>Здесь выборка, которая состоит из 1/10 доли данных, взята из второй половины данных.</p>
<p><code>[----------++--------]</code></p>
<h3 id="select-array-join-clause">Секция ARRAY JOIN<a class="headerlink" href="#select-array-join-clause" title="Permanent link">&para;</a></h3>
<p>Позволяет выполнить <code>JOIN</code> с массивом или вложенной структурой данных. Смысл похож на функцию <a href="../functions/array_join/#functions_arrayjoin">arrayJoin</a>, но функциональность более широкая.</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">&lt;</span><span class="n">expr_list</span><span class="o">&gt;</span>
<span class="k">FROM</span> <span class="o">&lt;</span><span class="n">left_subquery</span><span class="o">&gt;</span>
<span class="p">[</span><span class="k">LEFT</span><span class="p">]</span> <span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="o">&lt;</span><span class="nb">array</span><span class="o">&gt;</span>
<span class="p">[</span><span class="k">WHERE</span><span class="o">|</span><span class="n">PREWHERE</span> <span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="p">]</span>
<span class="p">...</span>
</pre></div>


<p>В запросе может быть указано не более одной секции <code>ARRAY JOIN</code>.</p>
<p>При использовании <code>ARRAY JOIN</code>, порядок выполнения запроса оптимизируется. Несмотря на то что секция <code>ARRAY JOIN</code> всегда указывается перед выражением <code>WHERE / PREWHERE</code>, преобразование <code>JOIN</code> может быть выполнено как до выполнения выражения <code>WHERE / PREWHERE</code> (если результат необходим в этом выражении), так и после (чтобы уменьшить объем расчетов). Порядок обработки контролируется оптимизатором запросов.</p>
<p>Секция <code>ARRAY JOIN</code> поддерживает следующие формы записи:</p>
<ul>
<li><code>ARRAY JOIN</code> — в этом случае результат <code>JOIN</code> не будет содержать пустые массивы;</li>
<li><code>LEFT ARRAY JOIN</code> — пустые массивы попадут в результат выполнения <code>JOIN</code>. В качестве значения для пустых массивов устанавливается значение по умолчанию. Обычно это 0, пустая строка или NULL, в зависимости от типа элементов массива.</li>
</ul>
<p>Рассмотрим примеры использования <code>ARRAY JOIN</code> и <code>LEFT ARRAY JOIN</code>. Для начала создадим таблицу, содержащую столбец с типом <a href="../../data_types/array/">Array</a>, и добавим в него значение:</p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">arrays_test</span>
<span class="p">(</span>
    <span class="n">s</span> <span class="n">String</span><span class="p">,</span>
    <span class="n">arr</span> <span class="nb">Array</span><span class="p">(</span><span class="n">UInt8</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">Memory</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">arrays_test</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;World&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;Goodbye&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s───────────┬─arr─────┐</span>
<span class="err">│ Hello       │ [1,2]   │</span>
<span class="err">│ World       │ [3,4,5] │</span>
<span class="err">│ Goodbye     │ []      │</span>
<span class="err">└─────────────┴─────────┘</span>
</pre></div>


<p>В примере ниже используется <code>ARRAY JOIN</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="n">arr</span>
<span class="k">FROM</span> <span class="n">arrays_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">arr</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─arr─┐</span>
<span class="err">│ Hello │   1 │</span>
<span class="err">│ Hello │   2 │</span>
<span class="err">│ World │   3 │</span>
<span class="err">│ World │   4 │</span>
<span class="err">│ World │   5 │</span>
<span class="err">└───────┴─────┘</span>
</pre></div>


<p>Следующий пример использует <code>LEFT ARRAY JOIN</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="n">arr</span>
<span class="k">FROM</span> <span class="n">arrays_test</span>
<span class="k">LEFT</span> <span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">arr</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s───────────┬─arr─┐</span>
<span class="err">│ Hello       │   1 │</span>
<span class="err">│ Hello       │   2 │</span>
<span class="err">│ World       │   3 │</span>
<span class="err">│ World       │   4 │</span>
<span class="err">│ World       │   5 │</span>
<span class="err">│ Goodbye     │   0 │</span>
<span class="err">└─────────────┴─────┘</span>
</pre></div>


<h4 id="ispolzovanie-aliasov">Использование алиасов<a class="headerlink" href="#ispolzovanie-aliasov" title="Permanent link">&para;</a></h4>
<p>Для массива в секции <code>ARRAY JOIN</code> может быть указан алиас. В этом случае, элемент массива будет доступен под этим алиасом, а сам массив — под исходным именем. Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">a</span>
<span class="k">FROM</span> <span class="n">arrays_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">arr</span> <span class="k">AS</span> <span class="n">a</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─arr─────┬─a─┐</span>
<span class="err">│ Hello │ [1,2]   │ 1 │</span>
<span class="err">│ Hello │ [1,2]   │ 2 │</span>
<span class="err">│ World │ [3,4,5] │ 3 │</span>
<span class="err">│ World │ [3,4,5] │ 4 │</span>
<span class="err">│ World │ [3,4,5] │ 5 │</span>
<span class="err">└───────┴─────────┴───┘</span>
</pre></div>


<p>Используя алиасы, можно выполнять <code>JOIN</code> с внешними массивами:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="n">arr_external</span>
<span class="k">FROM</span> <span class="n">arrays_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="k">AS</span> <span class="n">arr_external</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s───────────┬─arr_external─┐</span>
<span class="err">│ Hello       │            1 │</span>
<span class="err">│ Hello       │            2 │</span>
<span class="err">│ Hello       │            3 │</span>
<span class="err">│ World       │            1 │</span>
<span class="err">│ World       │            2 │</span>
<span class="err">│ World       │            3 │</span>
<span class="err">│ Goodbye     │            1 │</span>
<span class="err">│ Goodbye     │            2 │</span>
<span class="err">│ Goodbye     │            3 │</span>
<span class="err">└─────────────┴──────────────┘</span>
</pre></div>


<p>В секции <code>ARRAY JOIN</code> можно указать через запятую сразу несколько массивов. В этом случае, <code>JOIN</code> делается с ними одновременно (прямая сумма, а не прямое произведение). Обратите внимание, массивы должны быть одинаковых размеров. Примеры:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">mapped</span>
<span class="k">FROM</span> <span class="n">arrays_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">arr</span> <span class="k">AS</span> <span class="n">a</span><span class="p">,</span> <span class="n">arrayEnumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">AS</span> <span class="n">num</span><span class="p">,</span> <span class="n">arrayMap</span><span class="p">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span> <span class="k">AS</span> <span class="n">mapped</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─arr─────┬─a─┬─num─┬─mapped─┐</span>
<span class="err">│ Hello │ [1,2]   │ 1 │   1 │      2 │</span>
<span class="err">│ Hello │ [1,2]   │ 2 │   2 │      3 │</span>
<span class="err">│ World │ [3,4,5] │ 3 │   1 │      4 │</span>
<span class="err">│ World │ [3,4,5] │ 4 │   2 │      5 │</span>
<span class="err">│ World │ [3,4,5] │ 5 │   3 │      6 │</span>
<span class="err">└───────┴─────────┴───┴─────┴────────┘</span>
</pre></div>


<p>В примере ниже используется функция <a href="../functions/array_functions/#array_functions-arrayenumerate">arrayEnumerate</a>:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">arrayEnumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">arrays_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">arr</span> <span class="k">AS</span> <span class="n">a</span><span class="p">,</span> <span class="n">arrayEnumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">AS</span> <span class="n">num</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─arr─────┬─a─┬─num─┬─arrayEnumerate(arr)─┐</span>
<span class="err">│ Hello │ [1,2]   │ 1 │   1 │ [1,2]               │</span>
<span class="err">│ Hello │ [1,2]   │ 2 │   2 │ [1,2]               │</span>
<span class="err">│ World │ [3,4,5] │ 3 │   1 │ [1,2,3]             │</span>
<span class="err">│ World │ [3,4,5] │ 4 │   2 │ [1,2,3]             │</span>
<span class="err">│ World │ [3,4,5] │ 5 │   3 │ [1,2,3]             │</span>
<span class="err">└───────┴─────────┴───┴─────┴─────────────────────┘</span>
</pre></div>


<h4 id="array-join-s-vlozhennymi-strukturami-dannykh">ARRAY JOIN с вложенными структурами данных<a class="headerlink" href="#array-join-s-vlozhennymi-strukturami-dannykh" title="Permanent link">&para;</a></h4>
<p><code>ARRAY JOIN</code> также работает с <a href="../../data_types/nested_data_structures/nested/">вложенными структурами данных</a>. Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">nested_test</span>
<span class="p">(</span>
    <span class="n">s</span> <span class="n">String</span><span class="p">,</span>
    <span class="n">nest</span> <span class="n">Nested</span><span class="p">(</span>
    <span class="n">x</span> <span class="n">UInt8</span><span class="p">,</span>
    <span class="n">y</span> <span class="n">UInt32</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">Memory</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">nested_test</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;World&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;Goodbye&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]);</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s───────┬─nest.x──┬─nest.y─────┐</span>
<span class="err">│ Hello   │ [1,2]   │ [10,20]    │</span>
<span class="err">│ World   │ [3,4,5] │ [30,40,50] │</span>
<span class="err">│ Goodbye │ []      │ []         │</span>
<span class="err">└─────────┴─────────┴────────────┘</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">y</span><span class="o">`</span>
<span class="k">FROM</span> <span class="n">nested_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">nest</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─nest.x─┬─nest.y─┐</span>
<span class="err">│ Hello │      1 │     10 │</span>
<span class="err">│ Hello │      2 │     20 │</span>
<span class="err">│ World │      3 │     30 │</span>
<span class="err">│ World │      4 │     40 │</span>
<span class="err">│ World │      5 │     50 │</span>
<span class="err">└───────┴────────┴────────┘</span>
</pre></div>


<p>При указании имени вложенной структуры данных в <code>ARRAY JOIN</code>, смысл такой же, как <code>ARRAY JOIN</code> со всеми элементами-массивами, из которых она состоит. Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">y</span><span class="o">`</span>
<span class="k">FROM</span> <span class="n">nested_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">y</span><span class="o">`</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─nest.x─┬─nest.y─┐</span>
<span class="err">│ Hello │      1 │     10 │</span>
<span class="err">│ Hello │      2 │     20 │</span>
<span class="err">│ World │      3 │     30 │</span>
<span class="err">│ World │      4 │     40 │</span>
<span class="err">│ World │      5 │     50 │</span>
<span class="err">└───────┴────────┴────────┘</span>
</pre></div>


<p>Такой вариант тоже имеет смысл:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">y</span><span class="o">`</span>
<span class="k">FROM</span> <span class="n">nested_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─nest.x─┬─nest.y─────┐</span>
<span class="err">│ Hello │      1 │ [10,20]    │</span>
<span class="err">│ Hello │      2 │ [10,20]    │</span>
<span class="err">│ World │      3 │ [30,40,50] │</span>
<span class="err">│ World │      4 │ [30,40,50] │</span>
<span class="err">│ World │      5 │ [30,40,50] │</span>
<span class="err">└───────┴────────┴────────────┘</span>
</pre></div>


<p>Алиас для вложенной структуры данных можно использовать, чтобы выбрать как результат <code>JOIN</code>-а, так и исходный массив. Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="o">`</span><span class="n">n</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">n</span><span class="p">.</span><span class="n">y</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">y</span><span class="o">`</span>
<span class="k">FROM</span> <span class="n">nested_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">nest</span> <span class="k">AS</span> <span class="n">n</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─n.x─┬─n.y─┬─nest.x──┬─nest.y─────┐</span>
<span class="err">│ Hello │   1 │  10 │ [1,2]   │ [10,20]    │</span>
<span class="err">│ Hello │   2 │  20 │ [1,2]   │ [10,20]    │</span>
<span class="err">│ World │   3 │  30 │ [3,4,5] │ [30,40,50] │</span>
<span class="err">│ World │   4 │  40 │ [3,4,5] │ [30,40,50] │</span>
<span class="err">│ World │   5 │  50 │ [3,4,5] │ [30,40,50] │</span>
<span class="err">└───────┴─────┴─────┴─────────┴────────────┘</span>
</pre></div>


<p>Пример использования функции <a href="../functions/array_functions/#array_functions-arrayenumerate">arrayEnumerate</a>:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">s</span><span class="p">,</span> <span class="o">`</span><span class="n">n</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">n</span><span class="p">.</span><span class="n">y</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">y</span><span class="o">`</span><span class="p">,</span> <span class="n">num</span>
<span class="k">FROM</span> <span class="n">nested_test</span>
<span class="nb">ARRAY</span> <span class="k">JOIN</span> <span class="n">nest</span> <span class="k">AS</span> <span class="n">n</span><span class="p">,</span> <span class="n">arrayEnumerate</span><span class="p">(</span><span class="o">`</span><span class="n">nest</span><span class="p">.</span><span class="n">x</span><span class="o">`</span><span class="p">)</span> <span class="k">AS</span> <span class="n">num</span><span class="p">;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─s─────┬─n.x─┬─n.y─┬─nest.x──┬─nest.y─────┬─num─┐</span>
<span class="err">│ Hello │   1 │  10 │ [1,2]   │ [10,20]    │   1 │</span>
<span class="err">│ Hello │   2 │  20 │ [1,2]   │ [10,20]    │   2 │</span>
<span class="err">│ World │   3 │  30 │ [3,4,5] │ [30,40,50] │   1 │</span>
<span class="err">│ World │   4 │  40 │ [3,4,5] │ [30,40,50] │   2 │</span>
<span class="err">│ World │   5 │  50 │ [3,4,5] │ [30,40,50] │   3 │</span>
<span class="err">└───────┴─────┴─────┴─────────┴────────────┴─────┘</span>
</pre></div>


<h3 id="select-join">Секция JOIN<a class="headerlink" href="#select-join" title="Permanent link">&para;</a></h3>
<p>Соединяет данные в привычном для <a href="https://en.wikipedia.org/wiki/Join_(SQL)" rel="external nofollow">SQL JOIN</a> смысле.</p>
<div class="admonition info">
<p class="admonition-title">Примечание</p>
<p>Не связана с функциональностью <a href="#select-array-join-clause">ARRAY JOIN</a>.</p>
</div>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">&lt;</span><span class="n">expr_list</span><span class="o">&gt;</span>
<span class="k">FROM</span> <span class="o">&lt;</span><span class="n">left_subquery</span><span class="o">&gt;</span>
<span class="p">[</span><span class="k">GLOBAL</span><span class="p">]</span> <span class="p">[</span><span class="k">ANY</span><span class="o">|</span><span class="k">ALL</span><span class="p">]</span> <span class="p">[</span><span class="k">INNER</span><span class="o">|</span><span class="k">LEFT</span><span class="o">|</span><span class="k">RIGHT</span><span class="o">|</span><span class="k">FULL</span><span class="o">|</span><span class="k">CROSS</span><span class="p">]</span> <span class="p">[</span><span class="k">OUTER</span><span class="p">]</span> <span class="k">JOIN</span> <span class="o">&lt;</span><span class="n">right_subquery</span><span class="o">&gt;</span>
<span class="p">(</span><span class="k">ON</span> <span class="o">&lt;</span><span class="n">expr_list</span><span class="o">&gt;</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="k">USING</span> <span class="o">&lt;</span><span class="n">column_list</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">...</span>
</pre></div>


<p>Вместо <code>&lt;left_subquery&gt;</code> и <code>&lt;right_subquery&gt;</code> можно указать имена таблиц. Это эквивалентно подзапросу <code>SELECT * FROM table</code>, за исключением особого случая таблицы с движком <a href="../../operations/table_engines/join/">Join</a> – массива, подготовленного для присоединения.</p>
<p><strong>Поддерживаемые типы <code>JOIN</code></strong></p>
<ul>
<li><code>INNER JOIN</code> (or <code>JOIN</code>)</li>
<li><code>LEFT JOIN</code> (or <code>LEFT OUTER JOIN</code>)</li>
<li><code>RIGHT JOIN</code> (or <code>RIGHT OUTER JOIN</code>)</li>
<li><code>FULL JOIN</code> (or <code>FULL OUTER JOIN</code>)</li>
<li><code>CROSS JOIN</code> (or <code>,</code> )</li>
</ul>
<p>Смотрите описание стандартного <a href="https://en.wikipedia.org/wiki/Join_(SQL)" rel="external nofollow">SQL JOIN</a>.</p>
<h4 id="mnozhestvennyi-join">Множественный JOIN<a class="headerlink" href="#mnozhestvennyi-join" title="Permanent link">&para;</a></h4>
<p>При выполнении запросов, ClickHouse перезаписывает множественный <code>JOIN</code> как комбинацию двух-табличных объединений и обрабатывает их последовательно. Например, если необходимо объединить четыре таблицы, ClickHouse объединяет первую и вторую таблицы, затем соединяет результат с третьей, а затем с четвертой.</p>
<p>Если запрос содержит секцию <code>WHERE</code>, ClickHouse пытается пробросить фильтры из этой секции в промежуточный <code>JOIN</code>. Если он не может пробросить фильтр в каждый промежуточный <code>JOIN</code>, ClickHouse применяет фильтры после того, как все <code>JOIN</code> будут выполнены.</p>
<p>Для создания запросов мы рекомендуем использоват синтаксис <code>JOIN ON</code> или <code>JOIN USING</code>. Например:</p>
<div class="codehilite"><pre><span></span><span class="err">SELECT * FROM t1 JOIN t2 ON t1.a = t2.a JOIN t3 ON t1.a = t3.a</span>
</pre></div>


<p>В секции <code>FROM</code> вы можете использовать разделенные запятыми списки таблиц для объединения. Этот синтаксис работает только при включённой настройке <a href="../../operations/settings/settings/#settings-allow_experimental_cross_to_join_conversion">allow_experimental_cross_to_join_conversion = 1</a>. Например:</p>
<div class="codehilite"><pre><span></span><span class="err">SELECT * FROM t1, t2, t3 WHERE t1.a = t2.a AND t1.a = t3.a</span>
</pre></div>


<p>Не смешивайте синтаксисы.</p>
<p>ClickHouse не поддерживает синтаксис с запятыми напрямую и мы не рекомендуем его использовать. Алгоритм пытается переписать запрос с помощью секций <code>CROSS JOIN</code> и <code>INNER JOIN</code> и затем продолжает его выполнение. При переписывании запроса, ClickHouse пытается оптимизировать производительность и потребление памяти. По умолчанию, ClickHouse трактует запятые как <code>INNER JOIN</code> и конвертирует их в <code>CROSS JOIN</code> когда не может гарантировать, что <code>INNER JOIN</code> возвращает запрошенные данные.</p>
<h4 id="any-ili-all-strogost">ANY или ALL - строгость:<a class="headerlink" href="#any-ili-all-strogost" title="Permanent link">&para;</a></h4>
<p>Если указано <code>ALL</code>, то при наличии в "правой" таблице нескольких соответствующих строк, данные будут размножены по количеству этих строк. Это нормальное поведение <code>JOIN</code> как в стандартном SQL.
Если указано <code>ANY</code>, то при наличии в "правой" таблице нескольких соответствующих строк, будет присоединена только первая попавшаяся. Если известно, что в "правой" таблице есть не более одной подходящей строки, то результаты <code>ANY</code> и <code>ALL</code> совпадают.</p>
<p>Чтобы задать значение строгости по умолчанию, используйте сессионный параметр <a href="../../operations/settings/settings/#settings-join_default_strictness">join_default_strictness</a>.</p>
<p><strong>GLOBAL JOIN</strong></p>
<p>При использовании обычного <code>JOIN</code> , запрос отправляется на удалённые серверы. На каждом из них выполняются подзапросы для формирования "правой" таблицы, и с этой таблицей выполняется соединение. То есть, "правая" таблица формируется на каждом сервере отдельно.</p>
<p>При использовании <code>GLOBAL ... JOIN</code>, сначала сервер-инициатор запроса запускает подзапрос для вычисления правой таблицы. Эта временная таблица передаётся на каждый удалённый сервер, и на них выполняются запросы с использованием переданных временных данных.</p>
<p>Будьте аккуратны при использовании <code>GLOBAL</code> . За дополнительной информацией обращайтесь в раздел <a href="#select-distributed-subqueries">Распределенные подзапросы</a>.</p>
<p><strong>Советы по использованию</strong></p>
<p>Из подзапроса удаляются все столбцы, ненужные для <code>JOIN</code>.</p>
<p>При запуске <code>JOIN</code>, отсутствует оптимизация порядка выполнения по отношению к другим стадиям запроса. Соединение (поиск в "правой" таблице) выполняется до фильтрации в <code>WHERE</code> и до агрегации. Чтобы явно задать порядок вычислений, рекомендуется выполнять <code>JOIN</code> подзапроса с подзапросом.</p>
<p>Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="n">CounterID</span><span class="p">,</span>
    <span class="n">hits</span><span class="p">,</span>
    <span class="n">visits</span>
<span class="k">FROM</span>
<span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">CounterID</span><span class="p">,</span>
        <span class="k">count</span><span class="p">()</span> <span class="k">AS</span> <span class="n">hits</span>
    <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">hits</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">CounterID</span>
<span class="p">)</span> <span class="k">ANY</span> <span class="k">LEFT</span> <span class="k">JOIN</span>
<span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">CounterID</span><span class="p">,</span>
        <span class="k">sum</span><span class="p">(</span><span class="n">Sign</span><span class="p">)</span> <span class="k">AS</span> <span class="n">visits</span>
    <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">visits</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">CounterID</span>
<span class="p">)</span> <span class="k">USING</span> <span class="n">CounterID</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">hits</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">10</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌─CounterID─┬───hits─┬─visits─┐</span>
<span class="err">│   1143050 │ 523264 │  13665 │</span>
<span class="err">│    731962 │ 475698 │ 102716 │</span>
<span class="err">│    722545 │ 337212 │ 108187 │</span>
<span class="err">│    722889 │ 252197 │  10547 │</span>
<span class="err">│   2237260 │ 196036 │   9522 │</span>
<span class="err">│  23057320 │ 147211 │   7689 │</span>
<span class="err">│    722818 │  90109 │  17847 │</span>
<span class="err">│     48221 │  85379 │   4652 │</span>
<span class="err">│  19762435 │  77807 │   7026 │</span>
<span class="err">│    722884 │  77492 │  11056 │</span>
<span class="err">└───────────┴────────┴────────┘</span>
</pre></div>


<p>У подзапросов нет возможности задать имена и нет возможности их использовать для того, чтобы сослаться на столбец из конкретного подзапроса.
Требуется, чтобы столбцы, указанные в <code>USING</code>, назывались одинаково в обоих подзапросах, а остальные столбцы - по-разному. Изменить имена столбцов в подзапросах можно с помощью синонимов (в примере используются синонимы hits и visits).</p>
<p>В секции <code>USING</code> указывается один или несколько столбцов для соединения, что обозначает условие на равенство этих столбцов. Список столбцов задаётся без скобок. Более сложные условия соединения не поддерживаются.</p>
<p>"Правая" таблица (результат подзапроса) располагается в оперативной памяти. Если её не хватает, вы не сможете выполнить <code>JOIN</code>.</p>
<p>Каждый раз для выполнения запроса с одинаковым <code>JOIN</code>, подзапрос выполняется заново — результат не кэшируется. Это можно избежать, используя специальный движок таблиц <a href="../../operations/table_engines/join/">Join</a>, представляющий собой подготовленное множество для соединения, которое всегда находится в оперативке.</p>
<p>В некоторых случаях более эффективно использовать <code>IN</code> вместо <code>JOIN</code>.
Среди разных типов <code>JOIN</code>, наиболее эффективен <code>ANY LEFT JOIN</code>, следующий по эффективности <code>ANY INNER JOIN</code>. Наименее эффективны <code>ALL LEFT JOIN</code> и <code>ALL INNER JOIN</code>.</p>
<p>Если <code>JOIN</code> необходим для соединения с таблицами измерений (dimension tables - сравнительно небольшие таблицы, которые содержат свойства измерений - например, имена для рекламных кампаний), то использование <code>JOIN</code> может быть не очень удобным из-за громоздкости синтаксиса, а также из-за того, что правая таблица читается заново при каждом запросе. Специально для таких случаев существует функциональность "Внешние словари", которую следует использовать вместо <code>JOIN</code>. Дополнительные сведения смотрите в разделе <a href="../dicts/external_dicts/">Внешние словари</a>.</p>
<h4 id="obrabotka-pustykh-iacheek-i-null">Обработка пустых ячеек и NULL<a class="headerlink" href="#obrabotka-pustykh-iacheek-i-null" title="Permanent link">&para;</a></h4>
<p>При слиянии таблиц могут появляться пустые ячейки. То, каким образом ClickHouse заполняет эти ячейки, определяется настройкой <a href="../../operations/settings/settings/#settings-join_use_nulls">join_use_nulls</a>.</p>
<p>Если ключами <code>JOIN</code> выступают поля типа <a href="../../data_types/nullable/">Nullable</a>, то строки, где хотя бы один из ключей имеет значение <a href="../syntax/#null-literal">NULL</a>, не соединяются.</p>
<h4 id="ogranicheniia-sintaksisa">Ограничения синтаксиса<a class="headerlink" href="#ogranicheniia-sintaksisa" title="Permanent link">&para;</a></h4>
<p>Для множественных секций <code>JOIN</code> в одном запросе <code>SELECT</code>:</p>
<ul>
<li>Получение всех столбцов через <code>*</code> возможно только при объединении таблиц, но не подзапросов.</li>
<li>Секция <code>PREWHERE</code> недоступна.</li>
</ul>
<p>Для секций <code>ON</code>, <code>WHERE</code> и <code>GROUP BY</code>:</p>
<ul>
<li>Нельзя использовать произвольные выражения в секциях <code>ON</code>, <code>WHERE</code>, и <code>GROUP BY</code>, однако можно определить выражение в секции <code>SELECT</code> и затем использовать его через алиас в других секциях.</li>
</ul>
<h3 id="select-where">Секция WHERE<a class="headerlink" href="#select-where" title="Permanent link">&para;</a></h3>
<p>Позволяет задать выражение, которое ClickHouse использует для фильтрации данных перед всеми другими действиями в запросе кроме выражений, содержащихся в секции <a href="#select-prewhere">PREWHERE</a>. Обычно, это выражение с логическими операторами.</p>
<p>Результат выражения должен иметь тип <code>UInt8</code>.</p>
<p>ClickHouse использует в выражении индексы, если это позволяет <a href="../../operations/table_engines/">движок таблицы</a>.</p>
<p>Если в секции необходимо проверить <a href="../syntax/#null-literal">NULL</a>, то используйте операторы <a href="../operators/#operator-is-null">IS NULL</a> и <a href="../operators/#is-not-null">IS NOT NULL</a>, а также соответствующие функции <code>isNull</code> и <code>isNotNull</code>. В противном случае выражение будет считаться всегда не выполненным.</p>
<p>Пример проверки на <code>NULL</code>:</p>
<div class="codehilite"><pre><span></span>:<span class="o">)</span> SELECT * FROM t_null WHERE y IS NULL

SELECT *
FROM t_null
WHERE isNull<span class="o">(</span>y<span class="o">)</span>

┌─x─┬────y─┐
│ <span class="m">1</span> │ ᴺᵁᴸᴸ │
└───┴──────┘

<span class="m">1</span> rows in set. Elapsed: <span class="m">0</span>.002 sec.
</pre></div>


<h3 id="select-prewhere">Секция PREWHERE<a class="headerlink" href="#select-prewhere" title="Permanent link">&para;</a></h3>
<p>Имеет такой же смысл, как и секция <a href="#select-where">WHERE</a>. Отличие состоит в том, какие данные читаются из таблицы.
При использовании <code>PREWHERE</code>, из таблицы сначала читаются только столбцы, необходимые для выполнения <code>PREWHERE</code>. Затем читаются остальные столбцы, нужные для выполнения запроса, но из них только те блоки, в которых выражение в <code>PREWHERE</code> истинное.</p>
<p><code>PREWHERE</code> имеет смысл использовать, если есть условия фильтрации, которые использует меньшинство столбцов из тех, что есть в запросе, но достаточно сильно фильтрует данные. Таким образом, сокращается количество читаемых данных.</p>
<p>Например, полезно писать <code>PREWHERE</code> для запросов, которые вынимают много столбцов, но в которых фильтрация производится лишь по нескольким столбцам.</p>
<p><code>PREWHERE</code> поддерживается только таблицами семейства <code>*MergeTree</code>.</p>
<p>В запросе могут быть одновременно указаны секции <code>PREWHERE</code> и <code>WHERE</code>. В этом случае, <code>PREWHERE</code> идёт перед <code>WHERE</code>.</p>
<p>Если настройка <code>optimize_move_to_prewhere</code> выставлена в <code>1</code>, то при отсутствии <code>PREWHERE</code>, система будет автоматически переносить части выражений из <code>WHERE</code> в <code>PREWHERE</code> согласно некоторой эвристике.</p>
<h3 id="select-group-by-clause">Секция GROUP BY<a class="headerlink" href="#select-group-by-clause" title="Permanent link">&para;</a></h3>
<p>Это одна из наиболее важных частей СУБД.</p>
<p>Секция GROUP BY, если есть, должна содержать список выражений. Каждое выражение далее будем называть "ключом".
При этом, все выражения в секциях SELECT, HAVING, ORDER BY, должны вычисляться из ключей или из агрегатных функций. То есть, каждый выбираемый из таблицы столбец, должен использоваться либо в ключах, либо внутри агрегатных функций.</p>
<p>Если запрос содержит столбцы таблицы только внутри агрегатных функций, то секция GROUP BY может не указываться, и подразумевается агрегация по пустому набору ключей.</p>
<p>Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="k">count</span><span class="p">(),</span>
    <span class="n">median</span><span class="p">(</span><span class="n">FetchTiming</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="o">?</span> <span class="mi">60</span> <span class="p">:</span> <span class="n">FetchTiming</span><span class="p">),</span>
    <span class="k">count</span><span class="p">()</span> <span class="o">-</span> <span class="k">sum</span><span class="p">(</span><span class="n">Refresh</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">hits</span>
</pre></div>


<p>Но, в отличие от стандартного SQL, если в таблице нет строк (вообще нет или после фильтрации с помощью WHERE), в качестве результата возвращается пустой результат, а не результат из одной строки, содержащий "начальные" значения агрегатных функций.</p>
<p>В отличие от MySQL (и в соответствии со стандартом SQL), вы не можете получить какое-нибудь значение некоторого столбца, не входящего в ключ или агрегатную функцию (за исключением константных выражений). Для обхода этого вы можете воспользоваться агрегатной функцией any (получить первое попавшееся значение) или min/max.</p>
<p>Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="n">domainWithoutWWW</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span> <span class="k">AS</span> <span class="k">domain</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(),</span>
    <span class="k">any</span><span class="p">(</span><span class="n">Title</span><span class="p">)</span> <span class="k">AS</span> <span class="n">title</span> <span class="c1">-- getting the first occurred page header for each domain.</span>
<span class="k">FROM</span> <span class="n">hits</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">domain</span>
</pre></div>


<p>GROUP BY вычисляет для каждого встретившегося различного значения ключей, набор значений агрегатных функций.</p>
<p>Не поддерживается GROUP BY по столбцам-массивам.</p>
<p>Не поддерживается указание констант в качестве аргументов агрегатных функций. Пример: sum(1). Вместо этого, вы можете избавиться от констант. Пример: <code>count()</code>.</p>
<h4 id="obrabotka-null">Обработка NULL<a class="headerlink" href="#obrabotka-null" title="Permanent link">&para;</a></h4>
<p>При группировке, ClickHouse рассматривает <a href="../syntax/">NULL</a> как значение, причём <code>NULL=NULL</code>.</p>
<p>Рассмотрим, что это значит на примере.</p>
<p>Пусть есть таблица:</p>
<div class="codehilite"><pre><span></span><span class="err">┌─x─┬────y─┐</span>
<span class="err">│ 1 │    2 │</span>
<span class="err">│ 2 │ ᴺᵁᴸᴸ │</span>
<span class="err">│ 3 │    2 │</span>
<span class="err">│ 3 │    3 │</span>
<span class="err">│ 3 │ ᴺᵁᴸᴸ │</span>
<span class="err">└───┴──────┘</span>
</pre></div>


<p>В результате запроса <code>SELECT sum(x), y FROM t_null_big GROUP BY y</code> мы получим:</p>
<div class="codehilite"><pre><span></span><span class="err">┌─sum(x)─┬────y─┐</span>
<span class="err">│      4 │    2 │</span>
<span class="err">│      3 │    3 │</span>
<span class="err">│      5 │ ᴺᵁᴸᴸ │</span>
<span class="err">└────────┴──────┘</span>
</pre></div>


<p>Видно, что <code>GROUP BY</code> для <code>У = NULL</code> просуммировал <code>x</code>, как будто <code>NULL</code> — это значение.</p>
<p>Если в <code>GROUP BY</code> передать несколько ключей, то в результате мы получим все комбинации выборки, как если бы <code>NULL</code> был конкретным значением.</p>
<h4 id="modifikator-with-totals">Модификатор WITH TOTALS<a class="headerlink" href="#modifikator-with-totals" title="Permanent link">&para;</a></h4>
<p>Если указан модификатор WITH TOTALS, то будет посчитана ещё одна строчка, в которой в столбцах-ключах будут содержаться значения по умолчанию (нули, пустые строки), а в столбцах агрегатных функций - значения, посчитанные по всем строкам ("тотальные" значения).</p>
<p>Эта дополнительная строчка выводится в форматах JSON*, TabSeparated*, Pretty* отдельно от остальных строчек. В остальных форматах эта строчка не выводится.</p>
<p>В форматах JSON* строчка выводится отдельным полем totals. В форматах TabSeparated* строчка выводится после основного результата, и перед ней (после остальных данных) вставляется пустая строка. В форматах Pretty* строчка выводится отдельной табличкой после основного результата.</p>
<p><code>WITH TOTALS</code> может выполняться по-разному при наличии HAVING. Поведение зависит от настройки totals_mode.
По умолчанию <code>totals_mode = 'before_having'</code>. В этом случае totals считается по всем строчкам, включая непрошедших через HAVING и max_rows_to_group_by.</p>
<p>Остальные варианты учитывают в totals только строчки, прошедшие через HAVING, и имеют разное поведение при наличии настройки <code>max_rows_to_group_by</code> и <code>group_by_overflow_mode = 'any'</code>.</p>
<p><code>after_having_exclusive</code> - не учитывать строчки, не прошедшие <code>max_rows_to_group_by</code>. То есть в totals попадёт меньше или столько же строчек, чем если бы <code>max_rows_to_group_by</code> не было.</p>
<p><code>after_having_inclusive</code> - учитывать в totals все строчки, не прошедшие max_rows_to_group_by. То есть в totals попадёт больше или столько же строчек, чем если бы <code>max_rows_to_group_by</code> не было.</p>
<p><code>after_having_auto</code> - считать долю строчек, прошедших через HAVING. Если она больше некоторого значения (по умолчанию - 50%), то включить все строчки, не прошедшие max_rows_to_group_by в totals, иначе - не включить.</p>
<p><code>totals_auto_threshold</code> - по умолчанию 0.5. Коэффициент для работы <code>after_having_auto</code>.</p>
<p>Если <code>max_rows_to_group_by</code> и <code>group_by_overflow_mode = 'any'</code> не используются, то все варианты вида <code>after_having</code> не отличаются, и вы можете использовать любой из них, например, <code>after_having_auto</code>.</p>
<p>Вы можете использовать WITH TOTALS в подзапросах, включая подзапросы в секции JOIN (в этом случае соответствующие тотальные значения будут соединены).</p>
<h4 id="select-group-by-in-external-memory">GROUP BY во внешней памяти<a class="headerlink" href="#select-group-by-in-external-memory" title="Permanent link">&para;</a></h4>
<p>Существует возможность включить сброс временных данных на диск для ограничения потребления оперативной памяти при GROUP BY.
Настройка <code>max_bytes_before_external_group_by</code> - потребление оперативки, при котором временные данные GROUP BY сбрасываются в файловую систему. Если равно 0 (по умолчанию) - значит выключено.</p>
<p>При использовании <code>max_bytes_before_external_group_by</code> рекомендуется выставить max_memory_usage примерно в два раза больше. Это следует сделать, потому что агрегация выполняется в две стадии: чтение и формирование промежуточных данных (1) и слияние промежуточных данных (2). Сброс данных на файловую систему может производиться только на стадии 1. Если сброса временных данных не было, то на стадии 2 может потребляться до такого же объёма памяти, как на стадии 1.</p>
<p>Например, если у вас <code>max_memory_usage</code> было выставлено в 10000000000, и вы хотите использовать внешнюю агрегацию, то имеет смысл выставить <code>max_bytes_before_external_group_by</code> в 10000000000, а max_memory_usage в 20000000000. При срабатывании внешней агрегации (если был хотя бы один сброс временных данных в файловую систему) максимальное потребление оперативки будет лишь чуть-чуть больше <code>max_bytes_before_external_group_by</code>.</p>
<p>При распределённой обработке запроса внешняя агрегация производится на удалённых серверах. Для того чтобы на сервере-инициаторе запроса использовалось немного оперативки, нужно выставить настройку <code>distributed_aggregation_memory_efficient</code> в 1.</p>
<p>При слиянии данных, сброшенных на диск, а также при слиянии результатов с удалённых серверов, при включенной настройке <code>distributed_aggregation_memory_efficient</code>, потребляется до 1/256 * количество потоков от общего объёма оперативки.</p>
<p>При включенной внешней агрегации, если данных было меньше <code>max_bytes_before_external_group_by</code> (то есть сброса данных не было), то запрос работает так же быстро, как без внешней агрегации. Если же какие-то временные данные были сброшены, то время выполнения будет в несколько раз больше (примерно в три раза).</p>
<p>Если после GROUP BY у вас есть ORDER BY с небольшим LIMIT, то на ORDER BY не будет тратиться существенного количества оперативки.
Но если есть ORDER BY без LIMIT, то не забудьте включить внешнюю сортировку (<code>max_bytes_before_external_sort</code>).</p>
<h3 id="sektsiia-limit-by">Секция LIMIT BY<a class="headerlink" href="#sektsiia-limit-by" title="Permanent link">&para;</a></h3>
<p>Запрос с секцией <code>LIMIT n BY expressions</code> выбирает первые <code>n</code> строк для каждого отличного значения <code>expressions</code>. Ключ <code>LIMIT BY</code> может содержать любое количество <a href="../syntax/#syntax-expressions">выражений</a>.</p>
<p>ClickHouse поддерживает следующий синтаксис:</p>
<ul>
<li><code>LIMIT [offset_value, ]n BY expressions</code></li>
<li><code>LIMIT n OFFSET offset_value BY expressions</code></li>
</ul>
<p>Во время обработки запроса, ClickHouse выбирает данные, упорядоченные по ключу сортировки. Ключ сортировки задаётся явно в секции <a href="#select-order-by">ORDER BY</a> или неявно в свойствах движка таблицы. Затем ClickHouse применяет <code>LIMIT n BY expressions</code> и возвращает первые <code>n</code> для каждой отличной комбинации <code>expressions</code>. Если указан <code>OFFSET</code>, то для каждого блока данных, который принадлежит отдельной комбинации <code>expressions</code>, ClickHouse отступает <code>offset_value</code> строк от начала блока и возвращает не более <code>n</code>. Если <code>offset_value</code> больше, чем количество строк в блоке данных, ClickHouse не возвращает ни одной строки.</p>
<p><code>LIMIT BY</code> не связана с секцией <code>LIMIT</code>. Их можно использовать в одном запросе.</p>
<p><strong>Примеры</strong></p>
<p>Образец таблицы:</p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">limit_by</span><span class="p">(</span><span class="n">id</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">val</span> <span class="nb">Int</span><span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">Memory</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">limit_by</span> <span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>
</pre></div>


<p>Запросы:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">limit_by</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span><span class="p">,</span> <span class="n">val</span> <span class="k">LIMIT</span> <span class="mi">2</span> <span class="k">BY</span> <span class="n">id</span>
</pre></div>


<div class="codehilite"><pre><span></span>┌─id─┬─val─┐
│  1 │  10 │
│  1 │  11 │
│  2 │  20 │
│  2 │  21 │
└────┴─────┘
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">limit_by</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span><span class="p">,</span> <span class="n">val</span> <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="k">BY</span> <span class="n">id</span>
</pre></div>


<div class="codehilite"><pre><span></span>┌─id─┬─val─┐
│  1 │  11 │
│  1 │  12 │
│  2 │  21 │
└────┴─────┘
</pre></div>


<p>Запрос <code>SELECT * FROM limit_by ORDER BY id, val LIMIT 2 OFFSET 1 BY id</code> возвращает такой же результат.</p>
<p>Следующий запрос выбирает топ 5 рефереров для каждой пары <code>domain, device_type</code>, но не более 100 строк (<code>LIMIT n BY + LIMIT</code>).</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="n">domainWithoutWWW</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span> <span class="k">AS</span> <span class="k">domain</span><span class="p">,</span>
    <span class="n">domainWithoutWWW</span><span class="p">(</span><span class="n">REFERRER_URL</span><span class="p">)</span> <span class="k">AS</span> <span class="n">referrer</span><span class="p">,</span>
    <span class="n">device_type</span><span class="p">,</span>
    <span class="k">count</span><span class="p">()</span> <span class="n">cnt</span>
<span class="k">FROM</span> <span class="n">hits</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">domain</span><span class="p">,</span> <span class="n">referrer</span><span class="p">,</span> <span class="n">device_type</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cnt</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">5</span> <span class="k">BY</span> <span class="k">domain</span><span class="p">,</span> <span class="n">device_type</span>
<span class="k">LIMIT</span> <span class="mi">100</span>
</pre></div>


<p>Запрос выберет топ 5 рефереров для каждой пары <code>domain, device_type</code>, но не более 100 строк (<code>LIMIT n BY + LIMIT</code>).</p>
<p><code>LIMIT n BY</code> работает с <a href="../syntax/">NULL</a> как если бы это было конкретное значение. Т.е. в результате запроса пользователь получит все комбинации полей, указанных в <code>BY</code>.</p>
<h3 id="sektsiia-having">Секция HAVING<a class="headerlink" href="#sektsiia-having" title="Permanent link">&para;</a></h3>
<p>Позволяет отфильтровать результат, полученный после GROUP BY, аналогично секции WHERE.
WHERE и HAVING отличаются тем, что WHERE выполняется до агрегации (GROUP BY), а HAVING - после.
Если агрегации не производится, то HAVING использовать нельзя.</p>
<h3 id="select-order-by">Секция ORDER BY<a class="headerlink" href="#select-order-by" title="Permanent link">&para;</a></h3>
<p>Секция ORDER BY содержит список выражений, к каждому из которых также может быть приписано DESC или ASC (направление сортировки). Если ничего не приписано - это аналогично приписыванию ASC. ASC - сортировка по возрастанию, DESC - сортировка по убыванию. Обозначение направления сортировки действует на одно выражение, а не на весь список. Пример: <code>ORDER BY Visits DESC, SearchPhrase</code></p>
<p>Для сортировки по значениям типа String есть возможность указать collation (сравнение). Пример: <code>ORDER BY SearchPhrase COLLATE 'tr'</code> - для сортировки по поисковой фразе, по возрастанию, с учётом турецкого алфавита, регистронезависимо, при допущении, что строки в кодировке UTF-8. COLLATE может быть указан или не указан для каждого выражения в ORDER BY независимо. Если есть ASC или DESC, то COLLATE указывается после них. При использовании COLLATE сортировка всегда регистронезависима.</p>
<p>Рекомендуется использовать COLLATE только для окончательной сортировки небольшого количества строк, так как производительность сортировки с указанием COLLATE меньше, чем обычной сортировки по байтам.</p>
<p>Строки, для которых список выражений, по которым производится сортировка, принимает одинаковые значения, выводятся в произвольном порядке, который может быть также недетерминированным (каждый раз разным).
Если секция ORDER BY отсутствует, то, аналогично, порядок, в котором идут строки, не определён, и может быть недетерминированным.</p>
<p>Порядок сортировки <code>NaN</code> и <code>NULL</code>:</p>
<ul>
<li>С модификатором <code>NULLS FIRST</code> — Сначала <code>NULL</code>, затем <code>NaN</code>, затем остальные значения.</li>
<li>С модификатором <code>NULLS LAST</code> — Сначала значения, затем <code>NaN</code>, затем <code>NULL</code>.</li>
<li>По умолчанию — Как с модификатором <code>NULLS LAST</code>.</li>
</ul>
<p>Пример:</p>
<p>Для таблицы</p>
<div class="codehilite"><pre><span></span><span class="err">┌─x─┬────y─┐</span>
<span class="err">│ 1 │ ᴺᵁᴸᴸ │</span>
<span class="err">│ 2 │    2 │</span>
<span class="err">│ 1 │  nan │</span>
<span class="err">│ 2 │    2 │</span>
<span class="err">│ 3 │    4 │</span>
<span class="err">│ 5 │    6 │</span>
<span class="err">│ 6 │  nan │</span>
<span class="err">│ 7 │ ᴺᵁᴸᴸ │</span>
<span class="err">│ 6 │    7 │</span>
<span class="err">│ 8 │    9 │</span>
<span class="err">└───┴──────┘</span>
</pre></div>


<p>Выполним запрос <code>SELECT * FROM t_null_nan ORDER BY y NULLS FIRST</code>, получим:</p>
<div class="codehilite"><pre><span></span><span class="err">┌─x─┬────y─┐</span>
<span class="err">│ 1 │ ᴺᵁᴸᴸ │</span>
<span class="err">│ 7 │ ᴺᵁᴸᴸ │</span>
<span class="err">│ 1 │  nan │</span>
<span class="err">│ 6 │  nan │</span>
<span class="err">│ 2 │    2 │</span>
<span class="err">│ 2 │    2 │</span>
<span class="err">│ 3 │    4 │</span>
<span class="err">│ 5 │    6 │</span>
<span class="err">│ 6 │    7 │</span>
<span class="err">│ 8 │    9 │</span>
<span class="err">└───┴──────┘</span>
</pre></div>


<p>Если кроме ORDER BY указан также не слишком большой LIMIT, то расходуется меньше оперативки. Иначе расходуется количество памяти, пропорциональное количеству данных для сортировки. При распределённой обработке запроса, если отсутствует GROUP BY, сортировка частично делается на удалённых серверах, а на сервере-инициаторе запроса производится слияние результатов. Таким образом, при распределённой сортировке, может сортироваться объём данных, превышающий размер памяти на одном сервере.</p>
<p>Существует возможность выполнять сортировку во внешней памяти (с созданием временных файлов на диске), если оперативной памяти не хватает. Для этого предназначена настройка <code>max_bytes_before_external_sort</code>. Если она выставлена в 0 (по умолчанию), то внешняя сортировка выключена. Если она включена, то при достижении объёмом данных для сортировки указанного количества байт, накопленные данные будут отсортированы и сброшены во временный файл. После того, как все данные будут прочитаны, будет произведено слияние всех сортированных файлов и выдача результата. Файлы записываются в директорию /var/lib/clickhouse/tmp/ (по умолчанию, может быть изменено с помощью параметра tmp_path) в конфиге.</p>
<p>На выполнение запроса может расходоваться больше памяти, чем max_bytes_before_external_sort. Поэтому, значение этой настройки должно быть существенно меньше, чем max_memory_usage. Для примера, если на вашем сервере 128 GB оперативки, и вам нужно выполнить один запрос, то выставите max_memory_usage в 100 GB, а max_bytes_before_external_sort в 80 GB.</p>
<p>Внешняя сортировка работает существенно менее эффективно, чем сортировка в оперативке.</p>
<h3 id="sektsiia-select">Секция SELECT<a class="headerlink" href="#sektsiia-select" title="Permanent link">&para;</a></h3>
<p>После вычислений, соответствующих всем перечисленным выше секциям, производится вычисление выражений, указанных в секции SELECT.
Вернее, вычисляются выражения, стоящие над агрегатными функциями, если есть агрегатные функции.
Сами агрегатные функции и то, что под ними, вычисляются при агрегации (GROUP BY).
Эти выражения работают так, как будто применяются к отдельным строкам результата.</p>
<h3 id="select-distinct">Секция DISTINCT<a class="headerlink" href="#select-distinct" title="Permanent link">&para;</a></h3>
<p>Если указано <code>DISTINCT</code>, то из всех множеств полностью совпадающих строк результата, будет оставляться только одна строка.
Результат выполнения будет таким же, как если указано <code>GROUP BY</code> по всем указанным полям в <code>SELECT</code> и не указаны агрегатные функции. Но имеется несколько отличий от <code>GROUP BY</code>:</p>
<ul>
<li><code>DISTINCT</code> может применяться совместно с <code>GROUP BY</code>;</li>
<li>при отсутствии <code>ORDER BY</code> и наличии <code>LIMIT</code>, запрос прекратит выполнение сразу после того, как будет прочитано необходимое количество различных строк - в этом случае использование DISTINCT существенно более оптимально;</li>
<li>блоки данных будут выдаваться по мере их обработки, не дожидаясь выполнения всего запроса.</li>
</ul>
<p><code>DISTINCT</code> не поддерживается, если в <code>SELECT</code> присутствует хотя бы один столбец типа массив.</p>
<p><code>DISTINCT</code> работает с <a href="../syntax/">NULL</a> как если бы <code>NULL</code> был конкретным значением, причём <code>NULL=NULL</code>. Т.е. в результате <code>DISTINCT</code> разные комбинации с <code>NULL</code> встретятся только по одному разу.</p>
<p>ClickHouse поддерживает использование в одном запросе секций <code>DISTINCT</code> и <code>ORDER BY</code> для разных столбцов. Секция <code>DISTINCT</code> исполняется перед секцией <code>ORDER BY</code>.</p>
<p>Таблица для примера:</p>
<div class="codehilite"><pre><span></span>┌─a─┬─b─┐
│ 2 │ 1 │
│ 1 │ 2 │
│ 3 │ 3 │
│ 2 │ 4 │
└───┴───┘
</pre></div>


<p>При выборке данных запросом <code>SELECT DISTINCT a FROM t1 ORDER BY b ASC</code>, мы получаем следующий результат:</p>
<div class="codehilite"><pre><span></span>┌─a─┐
│ 2 │
│ 1 │
│ 3 │
└───┘
</pre></div>


<p>Если изменить направление сортировки <code>SELECT DISTINCT a FROM t1 ORDER BY b DESC</code>, то результат получается следующий:</p>
<div class="codehilite"><pre><span></span>┌─a─┐
│ 3 │
│ 1 │
│ 2 │
└───┘
</pre></div>


<p>Строка <code>2, 4</code> была удалена перед сортировкой.</p>
<p>Учитывайте эту особенность реализации при программировании запросов.</p>
<h3 id="sektsiia-limit">Секция LIMIT<a class="headerlink" href="#sektsiia-limit" title="Permanent link">&para;</a></h3>
<p><code>LIMIT m</code> позволяет выбрать из результата первые <code>m</code> строк.</p>
<p><code>LIMIT n, m</code> позволяет выбрать из результата первые <code>m</code> строк после пропуска первых <code>n</code> строк. Синтаксис <code>LIMIT m OFFSET n</code> также поддерживается.</p>
<p><code>n</code> и <code>m</code> должны быть неотрицательными целыми числами.</p>
<p>При отсутствии секции <code>ORDER BY</code>, однозначно сортирующей результат, результат может быть произвольным и может являться недетерминированным.</p>
<h3 id="sektsiia-union-all">Секция UNION ALL<a class="headerlink" href="#sektsiia-union-all" title="Permanent link">&para;</a></h3>
<p>Произвольное количество запросов может быть объединено с помощью <code>UNION ALL</code>. Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">CounterID</span><span class="p">,</span> <span class="mi">1</span> <span class="k">AS</span> <span class="k">table</span><span class="p">,</span> <span class="n">toInt64</span><span class="p">(</span><span class="k">count</span><span class="p">())</span> <span class="k">AS</span> <span class="k">c</span>
    <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">hits</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">CounterID</span>

<span class="k">UNION</span> <span class="k">ALL</span>

<span class="k">SELECT</span> <span class="n">CounterID</span><span class="p">,</span> <span class="mi">2</span> <span class="k">AS</span> <span class="k">table</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">Sign</span><span class="p">)</span> <span class="k">AS</span> <span class="k">c</span>
    <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">visits</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">CounterID</span>
    <span class="k">HAVING</span> <span class="k">c</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>


<p>Поддерживается только <code>UNION ALL</code>. Обычный <code>UNION</code> (<code>UNION DISTINCT</code>) не поддерживается. Если вам нужен <code>UNION DISTINCT</code>, то вы можете написать <code>SELECT DISTINCT</code> из подзапроса, содержащего <code>UNION ALL</code>.</p>
<p>Запросы - части <code>UNION ALL</code> могут выполняться параллельно, и их результаты могут возвращаться вперемешку.</p>
<p>Структура результатов (количество и типы столбцов) у запросов должна совпадать. Но имена столбцов могут отличаться. В этом случае, имена столбцов для общего результата будут взяты из первого запроса. При объединении выполняется приведение типов. Например, если в двух объединяемых запросах одно и тоже поле имеет типы не-<code>Nullable</code> и <code>Nullable</code> от совместимого типа, то в результате <code>UNION ALL</code> получим поле типа <code>Nullable</code>.</p>
<p>Запросы - части <code>UNION ALL</code> нельзя заключить в скобки. <code>ORDER BY</code> и <code>LIMIT</code> применяются к отдельным запросам, а не к общему результату. Если вам нужно применить какое-либо преобразование к общему результату, то вы можете разместить все запросы с <code>UNION ALL</code> в подзапросе в секции <code>FROM</code>.</p>
<h3 id="sektsiia-into-outfile">Секция INTO OUTFILE<a class="headerlink" href="#sektsiia-into-outfile" title="Permanent link">&para;</a></h3>
<p>При указании <code>INTO OUTFILE filename</code> (где filename - строковый литерал), результат запроса будет сохранён в файл filename.
В отличие от MySQL, файл создаётся на стороне клиента. Если файл с таким именем уже существует, это приведёт к ошибке.
Функциональность доступна в клиенте командной строки и clickhouse-local (попытка выполнить запрос с INTO OUTFILE через HTTP интерфейс приведёт к ошибке).</p>
<p>Формат вывода по умолчанию - TabSeparated, как и в неинтерактивном режиме клиента командной строки.</p>
<h3 id="sektsiia-format">Секция FORMAT<a class="headerlink" href="#sektsiia-format" title="Permanent link">&para;</a></h3>
<p>При указании FORMAT format вы можете получить данные в любом указанном формате.
Это может использоваться для удобства или для создания дампов.
Подробнее смотрите раздел "Форматы".
Если секция FORMAT отсутствует, то используется формат по умолчанию, который зависит от используемого интерфейса для доступа к БД и от настроек. Для HTTP интерфейса, а также для клиента командной строки, используемого в batch-режиме, по умолчанию используется формат TabSeparated. Для клиента командной строки, используемого в интерактивном режиме, по умолчанию используется формат PrettyCompact (прикольные таблички, компактные).</p>
<p>При использовании клиента командной строки данные на клиент передаются во внутреннем эффективном формате. При этом клиент самостоятельно интерпретирует секцию FORMAT запроса и форматирует данные на своей стороне (снимая нагрузку на сеть и сервер).</p>
<h3 id="select-in-operators">Операторы IN<a class="headerlink" href="#select-in-operators" title="Permanent link">&para;</a></h3>
<p>Операторы <code>IN</code>, <code>NOT IN</code>, <code>GLOBAL IN</code>, <code>GLOBAL NOT IN</code> рассматриваются отдельно, так как их функциональность достаточно богатая.</p>
<p>В качестве левой части оператора, может присутствовать как один столбец, так и кортеж.</p>
<p>Примеры:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">)</span> <span class="k">FROM</span> <span class="p">...</span>
<span class="k">SELECT</span> <span class="p">(</span><span class="n">CounterID</span><span class="p">,</span> <span class="n">UserID</span><span class="p">)</span> <span class="k">IN</span> <span class="p">((</span><span class="mi">34</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span> <span class="p">(</span><span class="mi">101500</span><span class="p">,</span> <span class="mi">456</span><span class="p">))</span> <span class="k">FROM</span> <span class="p">...</span>
</pre></div>


<p>Если слева стоит один столбец, входящий в индекс, а справа - множество констант, то при выполнении запроса, система воспользуется индексом.</p>
<p>Не перечисляйте слишком большое количество значений (миллионы) явно. Если множество большое - лучше загрузить его во временную таблицу (например, смотрите раздел "Внешние данные для обработки запроса"), и затем воспользоваться подзапросом.</p>
<p>В качестве правой части оператора может быть множество константных выражений, множество кортежей с константными выражениями (показано в примерах выше), а также имя таблицы или подзапрос SELECT в скобках.</p>
<p>Если в качестве правой части оператора указано имя таблицы (например, <code>UserID IN users</code>), то это эквивалентно подзапросу <code>UserID IN (SELECT * FROM users)</code>. Это используется при работе с внешними данными, отправляемым вместе с запросом. Например, вместе с запросом может быть отправлено множество идентификаторов посетителей, загруженное во временную таблицу users, по которому следует выполнить фильтрацию.</p>
<p>Если в качестве правой части оператора, указано имя таблицы, имеющий движок Set (подготовленное множество, постоянно находящееся в оперативке), то множество не будет создаваться заново при каждом запросе.</p>
<p>В подзапросе может быть указано более одного столбца для фильтрации кортежей.
Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="p">(</span><span class="n">CounterID</span><span class="p">,</span> <span class="n">UserID</span><span class="p">)</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">CounterID</span><span class="p">,</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="p">...)</span> <span class="k">FROM</span> <span class="p">...</span>
</pre></div>


<p>Типы столбцов слева и справа оператора IN, должны совпадать.</p>
<p>Оператор IN и подзапрос могут встречаться в любой части запроса, в том числе в агрегатных и лямбда функциях.
Пример:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="n">EventDate</span><span class="p">,</span>
    <span class="k">avg</span><span class="p">(</span><span class="n">UserID</span> <span class="k">IN</span>
    <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">UserID</span>
        <span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">hits</span>
        <span class="k">WHERE</span> <span class="n">EventDate</span> <span class="o">=</span> <span class="n">toDate</span><span class="p">(</span><span class="s1">&#39;2014-03-17&#39;</span><span class="p">)</span>
    <span class="p">))</span> <span class="k">AS</span> <span class="n">ratio</span>
<span class="k">FROM</span> <span class="n">test</span><span class="p">.</span><span class="n">hits</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">EventDate</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">EventDate</span> <span class="k">ASC</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">┌──EventDate─┬────ratio─┐</span>
<span class="err">│ 2014-03-17 │        1 │</span>
<span class="err">│ 2014-03-18 │ 0.807696 │</span>
<span class="err">│ 2014-03-19 │ 0.755406 │</span>
<span class="err">│ 2014-03-20 │ 0.723218 │</span>
<span class="err">│ 2014-03-21 │ 0.697021 │</span>
<span class="err">│ 2014-03-22 │ 0.647851 │</span>
<span class="err">│ 2014-03-23 │ 0.648416 │</span>
<span class="err">└────────────┴──────────┘</span>
</pre></div>


<p>за каждый день после 17 марта считаем долю хитов, сделанных посетителями, которые заходили на сайт 17 марта.
Подзапрос в секции IN на одном сервере всегда выполняется только один раз. Зависимых подзапросов не существует.</p>
<h4 id="obrabotka-null_1">Обработка NULL<a class="headerlink" href="#obrabotka-null_1" title="Permanent link">&para;</a></h4>
<p>При обработке запроса оператор IN будет считать, что результат операции с <a href="../syntax/">NULL</a> всегда равен <code>0</code>, независимо от того, находится <code>NULL</code> в правой или левой части оператора. Значения <code>NULL</code> не входят ни в какое множество, не соответствуют друг другу и не могут сравниваться.</p>
<p>Рассмотрим для примера таблицу <code>t_null</code>:</p>
<div class="codehilite"><pre><span></span><span class="err">┌─x─┬────y─┐</span>
<span class="err">│ 1 │ ᴺᵁᴸᴸ │</span>
<span class="err">│ 2 │    3 │</span>
<span class="err">└───┴──────┘</span>
</pre></div>


<p>При выполнении запроса <code>SELECT x FROM t_null WHERE y IN (NULL,3)</code> получим следующий результат:</p>
<div class="codehilite"><pre><span></span><span class="err">┌─x─┐</span>
<span class="err">│ 2 │</span>
<span class="err">└───┘</span>
</pre></div>


<p>Видно, что строка, в которой <code>y = NULL</code>, выброшена из результатов запроса. Это произошло потому, что ClickHouse не может решить входит ли <code>NULL</code> в множество <code>(NULL,3)</code>, возвращает результат операции <code>0</code>, а <code>SELECT</code> выбрасывает эту строку из финальной выдачи.</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">y</span> <span class="k">IN</span> <span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">t_null</span>

<span class="err">┌─</span><span class="k">in</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">tuple</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="err">─┐</span>
<span class="err">│</span>                     <span class="mi">0</span> <span class="err">│</span>
<span class="err">│</span>                     <span class="mi">1</span> <span class="err">│</span>
<span class="err">└───────────────────────┘</span>
</pre></div>


<h4 id="select-distributed-subqueries">Распределённые подзапросы<a class="headerlink" href="#select-distributed-subqueries" title="Permanent link">&para;</a></h4>
<p>Существует два варианта IN-ов с подзапросами (аналогично для JOIN-ов): обычный <code>IN</code> / <code>JOIN</code> и <code>GLOBAL IN</code> / <code>GLOBAL JOIN</code>. Они отличаются способом выполнения при распределённой обработке запроса.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Помните, что алгоритмы, описанные ниже, могут работать иначе в зависимости от <a href="../../operations/settings/settings/">настройки</a> <code>distributed_product_mode</code>.</p>
</div>
<p>При использовании обычного IN-а, запрос отправляется на удалённые серверы, и на каждом из них выполняются подзапросы в секциях <code>IN</code> / <code>JOIN</code>.</p>
<p>При использовании <code>GLOBAL IN</code> / <code>GLOBAL JOIN-а</code>, сначала выполняются все подзапросы для <code>GLOBAL IN</code> / <code>GLOBAL JOIN-ов</code>, и результаты складываются во временные таблицы. Затем эти временные таблицы передаются на каждый удалённый сервер, и на них выполняются запросы, с использованием этих переданных временных данных.</p>
<p>Если запрос не распределённый, используйте обычный <code>IN</code> / <code>JOIN</code>.</p>
<p>Следует быть внимательным при использовании подзапросов в секции <code>IN</code> / <code>JOIN</code> в случае распределённой обработки запроса.</p>
<p>Рассмотрим это на примерах. Пусть на каждом сервере кластера есть обычная таблица <strong>local_table</strong>. Пусть также есть таблица <strong>distributed_table</strong> типа <strong>Distributed</strong>, которая смотрит на все серверы кластера.</p>
<p>При запросе к распределённой таблице <strong>distributed_table</strong>, запрос будет отправлен на все удалённые серверы, и на них будет выполнен с использованием таблицы <strong>local_table</strong>.</p>
<p>Например, запрос</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">distributed_table</span>
</pre></div>


<p>будет отправлен на все удалённые серверы в виде</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">local_table</span>
</pre></div>


<p>, выполнен параллельно на каждом из них до стадии, позволяющей объединить промежуточные результаты; затем промежуточные результаты вернутся на сервер-инициатор запроса, будут на нём объединены, и финальный результат будет отправлен клиенту.</p>
<p>Теперь рассмотрим запрос с IN-ом:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>


<ul>
<li>расчёт пересечения аудиторий двух сайтов.</li>
</ul>
<p>Этот запрос будет отправлен на все удалённые серверы в виде</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>


<p>То есть, множество в секции IN будет собрано на каждом сервере независимо, только по тем данным, которые есть локально на каждом из серверов.</p>
<p>Это будет работать правильно и оптимально, если вы предусмотрели такой случай, и раскладываете данные по серверам кластера таким образом, чтобы данные одного UserID-а лежали только на одном сервере. В таком случае все необходимые данные будут присутствовать на каждом сервере локально. В противном случае результат будет посчитан неточно. Назовём этот вариант запроса "локальный IN".</p>
<p>Чтобы исправить работу запроса, когда данные размазаны по серверам кластера произвольным образом, можно было бы указать <strong>distributed_table</strong> внутри подзапроса. Запрос будет выглядеть так:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>


<p>Этот запрос будет отправлен на все удалённые серверы в виде</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>


<p>На каждом удалённом сервере начнёт выполняться подзапрос. Так как в подзапросе используется распределённая таблица, то подзапрос будет, на каждом удалённом сервере, снова отправлен на каждый удалённый сервер, в виде</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span>
</pre></div>


<p>Например, если у вас кластер из 100 серверов, то выполнение всего запроса потребует 10 000 элементарных запросов, что, как правило, является неприемлемым.</p>
<p>В таких случаях всегда следует использовать GLOBAL IN вместо IN. Рассмотрим его работу для запроса</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">GLOBAL</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span><span class="p">)</span>
</pre></div>


<p>На сервере-инициаторе запроса будет выполнен подзапрос</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">UserID</span> <span class="k">FROM</span> <span class="n">distributed_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span>
</pre></div>


<p>, и результат будет сложен во временную таблицу в оперативке. Затем запрос будет отправлен на каждый удалённый сервер в виде</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">uniq</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">local_table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">AND</span> <span class="n">UserID</span> <span class="k">GLOBAL</span> <span class="k">IN</span> <span class="n">_data1</span>
</pre></div>


<p>, и вместе с запросом, на каждый удалённый сервер будет отправлена временная таблица <code>_data1</code> (имя временной таблицы - implementation defined).</p>
<p>Это гораздо более оптимально, чем при использовании обычного IN. Но при этом, следует помнить о нескольких вещах:</p>
<ol>
<li>При создании временной таблицы данные не уникализируются. Чтобы уменьшить объём передаваемых по сети данных, укажите в подзапросе DISTINCT (для обычного IN-а этого делать не нужно).</li>
<li>Временная таблица будет передана на все удалённые серверы. Передача не учитывает топологию сети. Например, если 10 удалённых серверов расположены в удалённом относительно сервера-инициатора запроса датацентре, то по каналу в удалённый датацентр данные будет переданы 10 раз. Старайтесь не использовать большие множества при использовании GLOBAL IN.</li>
<li>При передаче данных на удалённые серверы не настраивается ограничение использования сетевой полосы. Вы можете перегрузить сеть.</li>
<li>Старайтесь распределять данные по серверам так, чтобы в GLOBAL IN-ах не было частой необходимости.</li>
<li>Если в GLOBAL IN есть частая необходимость, то спланируйте размещение кластера ClickHouse таким образом, чтобы в каждом датацентре была хотя бы одна реплика каждого шарда, и среди них была быстрая сеть - чтобы запрос целиком можно было бы выполнить, передавая данные в пределах одного датацентра.</li>
</ol>
<p>В секции <code>GLOBAL IN</code> также имеет смысл указывать локальную таблицу - в случае, если эта локальная таблица есть только на сервере-инициаторе запроса, и вы хотите воспользоваться данными из неё на удалённых серверах.</p>
<h3 id="ekstremalnye-znacheniia">Экстремальные значения<a class="headerlink" href="#ekstremalnye-znacheniia" title="Permanent link">&para;</a></h3>
<p>Вы можете получить в дополнение к результату также минимальные и максимальные значения по столбцам результата. Для этого выставите настройку <strong>extremes</strong> в 1. Минимумы и максимумы считаются для числовых типов, дат, дат-с-временем. Для остальных столбцов будут выведены значения по умолчанию.</p>
<p>Вычисляются дополнительные две строчки - минимумы и максимумы, соответственно. Эти дополнительные две строчки выводятся в форматах JSON*, TabSeparated*, Pretty* отдельно от остальных строчек. В остальных форматах они не выводится.</p>
<p>В форматах JSON* экстремальные значения выводятся отдельным полем extremes. В форматах TabSeparated* строчка выводится после основного результата и после totals, если есть. Перед ней (после остальных данных) вставляется пустая строка. В форматах Pretty* строчка выводится отдельной табличкой после основного результата и после totals, если есть.</p>
<p>Экстремальные значения считаются по строчкам, прошедшим через LIMIT. Но при этом, при использовании LIMIT offset, size, строчки до offset учитываются в extremes. В потоковых запросах, в результате может учитываться также небольшое количество строчек, прошедших LIMIT.</p>
<h3 id="zamechaniia">Замечания<a class="headerlink" href="#zamechaniia" title="Permanent link">&para;</a></h3>
<p>В секциях <code>GROUP BY</code>, <code>ORDER BY</code>, в отличие от диалекта MySQL, и в соответствии со стандартным SQL, не поддерживаются позиционные аргументы.
Например, если вы напишите <code>GROUP BY 1, 2</code> - то это будет воспринято, как группировка по константам (то есть, агрегация всех строк в одну).</p>
<p>Вы можете использовать синонимы (алиасы <code>AS</code>) в любом месте запроса.</p>
<p>В любом месте запроса, вместо выражения, может стоять звёздочка. При анализе запроса звёздочка раскрывается в список всех столбцов таблицы (за исключением <code>MATERIALIZED</code> и <code>ALIAS</code> столбцов). Есть лишь немного случаев, когда оправдано использовать звёздочку:</p>
<ul>
<li>при создании дампа таблицы;</li>
<li>для таблиц, содержащих всего несколько столбцов - например, системных таблиц;</li>
<li>для получения информации о том, какие столбцы есть в таблице; в этом случае, укажите <code>LIMIT 1</code>. Но лучше используйте запрос <code>DESC TABLE</code>;</li>
<li>при наличии сильной фильтрации по небольшому количеству столбцов с помощью <code>PREWHERE</code>;</li>
<li>в подзапросах (так как из подзапросов выкидываются столбцы, не нужные для внешнего запроса).</li>
</ul>
<p>В других случаях использование звёздочки является издевательством над системой, так как вместо преимуществ столбцовой СУБД вы получаете недостатки. То есть использовать звёздочку не рекомендуется.</p>
                
                </div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
          <a href="../../operations/table_engines/odbc/" title="ODBC" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Назад
                </span>
                ODBC
              </span>
            </div>
          </a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
          <a href="../../query_language/insert_into/" title="INSERT INTO" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Вперед
                </span>
                INSERT INTO
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©2016–2020 Yandex LLC
          </div>
        
      </div>
      
        <div class="md-footer-social">
  <span class="md-footer-copyright__highlight">Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/b34fe924267ab72357cf81044fddaf6b3f336e43" rel="external nofollow">b34fe92</a></span>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      
        <script src="../../assets/javascripts/modernizr.js"></script>
      
      <script src="../../assets/javascripts/application.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              <script src="../../assets/javascripts/lunr/lunr.ru.js"></script>
            
          
          
            <script src="../../assets/javascripts/lunr/lunr.multi.js"></script>
          
        
      
      
    
    
      
    

    <script type="text/javascript">
      function ready(callback){
          if (document.readyState != 'loading') {
              callback();
          } else if (document.addEventListener) {
              document.addEventListener('DOMContentLoaded', callback);
          } else document.attachEvent('onreadystatechange', function() {
              if (document.readyState == 'complete') {
                  callback();
              }
          });
      }
      ready(function () {
          var i;
          
          app.initialize({
              version: "1.0.4",
              url: {
                  base: "../.."
              }
          });
          var beforePrint = function() {
            var details = document.getElementsByTagName("details");
            for (i = 0; i < details.length; ++i) {
                details[i].open = 1;
            }
          };
          if (window.matchMedia) {
              window.matchMedia('print').addListener(function(q) {
                  if (q.matches) {
                      beforePrint();
                  }
              });
          }
          window.onbeforeprint = beforePrint;

          var name = window.location.hostname.split('.')[0];
          var feedback_address = name + '-feedback' + '@yandex-team.ru';
          var feedback_email = document.getElementsByClassName('feedback-email');
          for (i = 0; i < feedback_email.length; i++) {
            feedback_email[i].setAttribute('href', 'mailto:' + feedback_address);
            feedback_email[i].innerHTML = feedback_address;
          }

          document.getElementById("releases-selector").addEventListener(
            "change",
            function() {
              var target = window.location.href.split('docs')[0] + 'docs/';
              if (this.value) {
                target = target + this.value + '/';
              }
              window.location = target + 'ru';
            }
          )
      });
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script type="text/javascript"> docsearch({
apiKey: 'e239649803024433599de47a53b2d416',
indexName: 'yandex_clickhouse',
inputSelector: '#md-search__input',
algoliaOptions: {
  advancedSyntax: true,
  clickAnalytics: true,
  hitsPerPage: 25,
  'facetFilters': ["lang:ru"]
},
debug: false
});
</script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter18343495 = new Ya.Metrika2({
                        id:18343495,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor: true
                    });
                } catch(e) { }
            });
            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/tag.js";
            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks2");
    </script>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/18343495" style="position:absolute; left:-9999px;" alt=""/></div>
    </noscript>
    <!-- /Yandex.Metrika counter -->
  </body>
</html>