



<!DOCTYPE html>
<html lang="ru" class="no-js" data-version="v19.15" data-single-page="false">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://clickhouse.yandex/docs/ru/operations/table_engines/mergetree/">
      
      
      
      <meta name="lang:clipboard.copy" content="Копировать в буфер">
      
      <meta name="lang:clipboard.copied" content="Скопировано в буфер">
      
      <meta name="lang:search.language" content="ru">
      
      <meta name="lang:search.pipeline.stopwords" content="">
      
      <meta name="lang:search.pipeline.trimmer" content="">
      
      <meta name="lang:search.result.none" content="Совпадений не найдено">
      
      <meta name="lang:search.result.one" content="Найдено 1 совпадение">
      
      <meta name="lang:search.result.other" content="Найдено # совпадений">
      
      <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.ico">
    
    
      
        <title>MergeTree - Документация ClickHouse v19.15</title>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
      <link rel="stylesheet" href="../../../assets/stylesheets/application.2a88008a.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/custom.css?7bc0aa2?1582279136">
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="white" class="md-lang-ru">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">

  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="/" title="Документация ClickHouse v19.15" class="md-header-nav__button md-logo">
          
            <img src="../../../images/logo.svg" width="40" height="40">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Документация ClickHouse v19.15
              </span>
              <span class="md-header-nav__topic">
                MergeTree
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" id="md-search__input" class="md-search__input" name="query" required placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Начните печатать для поиска
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div id="md-language-switch" class="md-header-nav__source">
            

  <a class="md-alt-lang"
     href="../../../../en/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="English">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 60 30"><clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath><path fill="#00247d" d="M0,0 v30 h60 v-30 z"/><path stroke="#fff" stroke-width="6" d="M0,0 L60,30 M60,0 L0,30"/><path stroke="#cf142b" stroke-width="4" d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)"/><path stroke="#fff" stroke-width="10" d="M30,0 v30 M0,15 h60"/><path stroke="#cf142b" stroke-width="6" d="M30,0 v30 M0,15 h60"/></svg>
  </a>

  <a class="md-alt-lang md-current-lang"
     href="../../../../ru/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Russian">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 9 6"><rect width="9" height="3" fill="#fff"/><rect width="9" height="3" y="3" fill="#d52b1e"/><rect width="9" height="2" y="2" fill="#0039a6"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../../zh/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Chinese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 30 20"><defs><path id="s" fill="#ffde00" d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/></defs><rect width="30" height="20" fill="#de2910"/><use transform="translate(5,5) scale(3)" xlink:href="#s"/><use transform="translate(10,2) rotate(23.036243)" xlink:href="#s"/><use transform="translate(12,4) rotate(45.869898)" xlink:href="#s"/><use transform="translate(12,7) rotate(69.945396)" xlink:href="#s"/><use transform="translate(10,9) rotate(20.659808)" xlink:href="#s"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../../ja/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Japanese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="90" height="60" version="1.1" viewBox="0 0 90 60"><g id="surface1"><rect width="90" height="60" x="0" y="0" fill="#A0A0A0" fill-opacity="1" stroke="none"/><path fill="#FFF" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562"/><path fill="#BE0026" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30"/></g></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../../fa/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Farsi">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 630 360"><rect width="630" height="360" fill="#da0000"/><rect width="630" height="240" fill="#fff"/><rect width="630" height="120" fill="#239f40"/><g transform="translate(8.4,100.4)"><g id="tb4"><g id="tb1" fill="none" stroke="#fff" stroke-width="2"><path id="tbp1" d="M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9" transform="scale(1.4)"/><path id="tbp2" d="M0,7H9M10,7H19" transform="scale(2.8)"/><use y="120" xlink:href="#tbp2"/><use y="145.2" xlink:href="#tbp1"/></g><g id="tb3"><use x="56" xlink:href="#tb1"/><use x="112" xlink:href="#tb1"/><use x="168" xlink:href="#tb1"/></g></g><use x="168" xlink:href="#tb3"/><use x="392" xlink:href="#tb4"/></g><g fill="#da0000" transform="matrix(45,0,0,45,315,180)"><g id="emblem_half"><path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/><path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/><path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/><path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/></g><use transform="scale(-1,1)" xlink:href="#emblem_half"/></g></svg>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
                      <nav class="md-nav md-nav--primary" data-md-level="0">
  
  <label class="md-nav__title md-nav__title--site" for="drawer">
    Документация ClickHouse v19.15
  </label>

  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Введение
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Введение
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../" title="Обзор" class="md-nav__link">
      Обзор
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../introduction/distinctive_features/" title="Отличительные возможности ClickHouse" class="md-nav__link">
      Отличительные возможности ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../introduction/features_considered_disadvantages/" title="Особенности ClickHouse, которые могут считаться недостатками" class="md-nav__link">
      Особенности ClickHouse, которые могут считаться недостатками
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../introduction/performance/" title="Производительность" class="md-nav__link">
      Производительность
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../introduction/ya_metrika_task/" title="Постановка задачи в Яндекс.Метрике" class="md-nav__link">
      Постановка задачи в Яндекс.Метрике
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../introduction/info/" title="Информационная поддержка" class="md-nav__link">
      Информационная поддержка
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Начало работы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Начало работы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/" title="Установка и запуск" class="md-nav__link">
      Установка и запуск
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Тестовые наборы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Тестовые наборы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/example_datasets/ontime/" title="OnTime" class="md-nav__link">
      OnTime
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/example_datasets/nyc_taxi/" title="Данные о такси в Нью-Йорке" class="md-nav__link">
      Данные о такси в Нью-Йорке
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/example_datasets/amplab_benchmark/" title="AMPLab Big Data Benchmark" class="md-nav__link">
      AMPLab Big Data Benchmark
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/example_datasets/wikistat/" title="WikiStat" class="md-nav__link">
      WikiStat
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/example_datasets/criteo/" title="Терабайт логов кликов от Criteo" class="md-nav__link">
      Терабайт логов кликов от Criteo
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/example_datasets/star_schema/" title="Схема «Звезда»" class="md-nav__link">
      Схема «Звезда»
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../getting_started/example_datasets/metrica/" title="Данные Яндекс.Метрики" class="md-nav__link">
      Данные Яндекс.Метрики
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Интерфейсы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Интерфейсы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/cli/" title="Клиент командной строки" class="md-nav__link">
      Клиент командной строки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/tcp/" title="Нативный интерфейс (TCP)" class="md-nav__link">
      Нативный интерфейс (TCP)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/http/" title="HTTP-интерфейс" class="md-nav__link">
      HTTP-интерфейс
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/formats/" title="Форматы входных и выходных данных" class="md-nav__link">
      Форматы входных и выходных данных
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/jdbc/" title="JDBC-драйвер" class="md-nav__link">
      JDBC-драйвер
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/odbc/" title="ODBC-драйвер" class="md-nav__link">
      ODBC-драйвер
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      От сторонних разработчиков
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        От сторонних разработчиков
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/third-party/client_libraries/" title="Клиентские библиотеки" class="md-nav__link">
      Клиентские библиотеки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/third-party/integrations/" title="Интеграции" class="md-nav__link">
      Интеграции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/third-party/gui/" title="Визуальные интерфейсы" class="md-nav__link">
      Визуальные интерфейсы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../interfaces/third-party/proxy/" title="Прокси" class="md-nav__link">
      Прокси
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Типы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Типы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/int_uint/" title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="md-nav__link">
      UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/float/" title="Float32, Float64" class="md-nav__link">
      Float32, Float64
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/decimal/" title="Decimal" class="md-nav__link">
      Decimal
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/boolean/" title="Булевы значения" class="md-nav__link">
      Булевы значения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/string/" title="String" class="md-nav__link">
      String
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/fixedstring/" title="FixedString(N)" class="md-nav__link">
      FixedString(N)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/uuid/" title="UUID" class="md-nav__link">
      UUID
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/date/" title="Date" class="md-nav__link">
      Date
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/datetime/" title="DateTime" class="md-nav__link">
      DateTime
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/enum/" title="Enum" class="md-nav__link">
      Enum
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/array/" title="Array(T)" class="md-nav__link">
      Array(T)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/nested_data_structures/aggregatefunction/" title="AggregateFunction(name, types_of_arguments...)" class="md-nav__link">
      AggregateFunction(name, types_of_arguments...)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/tuple/" title="Tuple(T1, T2, ...)" class="md-nav__link">
      Tuple(T1, T2, ...)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/nullable/" title="Nullable" class="md-nav__link">
      Nullable
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-16" type="checkbox" id="nav-4-16">
    
    <label class="md-nav__link" for="nav-4-16">
      Вложенные структуры данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-16">
        Вложенные структуры данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/nested_data_structures/nested/" title="Nested(Name1 Type1, Name2 Type2, ...)" class="md-nav__link">
      Nested(Name1 Type1, Name2 Type2, ...)
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-17" type="checkbox" id="nav-4-17">
    
    <label class="md-nav__link" for="nav-4-17">
      Служебные типы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-17">
        Служебные типы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/special_data_types/expression/" title="Expression" class="md-nav__link">
      Expression
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/special_data_types/set/" title="Set" class="md-nav__link">
      Set
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/special_data_types/nothing/" title="Nothing" class="md-nav__link">
      Nothing
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-18" type="checkbox" id="nav-4-18">
    
    <label class="md-nav__link" for="nav-4-18">
      Domains
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-18">
        Domains
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/domains/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/domains/ipv4/" title="IPv4" class="md-nav__link">
      IPv4
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../data_types/domains/ipv6/" title="IPv6" class="md-nav__link">
      IPv6
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Движки баз данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Движки баз данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../database_engines/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../database_engines/mysql/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      


  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Движки таблиц
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Движки таблиц
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          


  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2" checked>
    
    <label class="md-nav__link" for="nav-6-2">
      Семейство MergeTree
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        Семейство MergeTree
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        MergeTree
      </label>
    
    <a href="../../../operations/table_engines/mergetree/" title="MergeTree" class="md-nav__link md-nav__link--active">
      <strong>MergeTree</strong>
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table_engine-mergetree-creating-a-table" title="Создание таблицы" class="md-nav__link">
    Создание таблицы
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sektsii-zaprosa" title="Секции запроса" class="md-nav__link">
    Секции запроса
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#khranenie-dannykh" title="Хранение данных" class="md-nav__link">
    Хранение данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary-keys-and-indexes-in-queries" title="Первичные ключи и индексы в запросах" class="md-nav__link">
    Первичные ключи и индексы в запросах
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vybor-pervichnogo-kliucha" title="Выбор первичного ключа" class="md-nav__link">
    Выбор первичного ключа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pervichnyi-kliuch-otlichnyi-ot-kliucha-sortirovki" title="Первичный ключ, отличный от ключа сортировки" class="md-nav__link">
    Первичный ключ, отличный от ключа сортировки
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ispolzovanie-indeksov-i-partitsii-v-zaprosakh" title="Использование индексов и партиций в запросах" class="md-nav__link">
    Использование индексов и партиций в запросах
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ispolzovanie-indeksa-dlia-chastichno-monotonnykh-pervichnykh-kliuchei" title="Использование индекса для частично-монотонных первичных ключей" class="md-nav__link">
    Использование индекса для частично-монотонных первичных ключей
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table_engine-mergetree-data_skipping-indexes" title="Индексы пропуска данных (экспериментальная функциональность)" class="md-nav__link">
    Индексы пропуска данных (экспериментальная функциональность)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dostupnye-indeksy" title="Доступные индексы" class="md-nav__link">
    Доступные индексы
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#podderzhka-dlia-funktsii" title="Поддержка для функций" class="md-nav__link">
    Поддержка для функций
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#konkurentnyi-dostup-k-dannym" title="Конкурентный доступ к данным" class="md-nav__link">
    Конкурентный доступ к данным
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table_engine-mergetree-ttl" title="TTL для столбцов и таблиц" class="md-nav__link">
    TTL для столбцов и таблиц
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table_engine-mergetree-multiple-volumes" title="Хранение данных таблицы на нескольких блочных устройствах" class="md-nav__link">
    Хранение данных таблицы на нескольких блочных устройствах
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obshchee" title="Общее" class="md-nav__link">
    Общее
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terminy" title="Термины" class="md-nav__link">
    Термины
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table_engine-mergetree-multiple-volumes_configure" title="Конфигурация" class="md-nav__link">
    Конфигурация
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#osobennosti-raboty" title="Особенности работы" class="md-nav__link">
    Особенности работы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/replication/" title="Репликация данных" class="md-nav__link">
      Репликация данных
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/custom_partitioning_key/" title="Произвольный ключ партиционирования" class="md-nav__link">
      Произвольный ключ партиционирования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/replacingmergetree/" title="ReplacingMergeTree" class="md-nav__link">
      ReplacingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/summingmergetree/" title="SummingMergeTree" class="md-nav__link">
      SummingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/aggregatingmergetree/" title="AggregatingMergeTree" class="md-nav__link">
      AggregatingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/collapsingmergetree/" title="CollapsingMergeTree" class="md-nav__link">
      CollapsingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/versionedcollapsingmergetree/" title="VersionedCollapsingMergeTree" class="md-nav__link">
      VersionedCollapsingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/graphitemergetree/" title="GraphiteMergeTree" class="md-nav__link">
      GraphiteMergeTree
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Семейство Log
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        Семейство Log
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/log_family/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/stripelog/" title="StripeLog" class="md-nav__link">
      StripeLog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/tinylog/" title="TinyLog" class="md-nav__link">
      TinyLog
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Интеграции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        Интеграции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/kafka/" title="Kafka" class="md-nav__link">
      Kafka
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/mysql/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/jdbc/" title="JDBC" class="md-nav__link">
      JDBC
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/odbc/" title="ODBC" class="md-nav__link">
      ODBC
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/hdfs/" title="HDFS" class="md-nav__link">
      HDFS
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      Особые
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        Особые
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/distributed/" title="Distributed" class="md-nav__link">
      Distributed
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/external_data/" title="Внешние данные" class="md-nav__link">
      Внешние данные
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/dictionary/" title="Dictionary" class="md-nav__link">
      Dictionary
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/merge/" title="Merge" class="md-nav__link">
      Merge
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/file/" title="File" class="md-nav__link">
      File
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/null/" title="Null" class="md-nav__link">
      Null
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/set/" title="Set" class="md-nav__link">
      Set
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/join/" title="Join" class="md-nav__link">
      Join
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/url/" title="URL" class="md-nav__link">
      URL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/view/" title="View" class="md-nav__link">
      View
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/materializedview/" title="MaterializedView" class="md-nav__link">
      MaterializedView
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/memory/" title="Memory" class="md-nav__link">
      Memory
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/table_engines/buffer/" title="Buffer" class="md-nav__link">
      Buffer
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Справка по SQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Справка по SQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/select/" title="SELECT" class="md-nav__link">
      SELECT
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/insert_into/" title="INSERT INTO" class="md-nav__link">
      INSERT INTO
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/create/" title="CREATE" class="md-nav__link">
      CREATE
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/alter/" title="ALTER" class="md-nav__link">
      ALTER
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/system/" title="SYSTEM" class="md-nav__link">
      SYSTEM
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/misc/" title="Прочие виды запросов" class="md-nav__link">
      Прочие виды запросов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-8" type="checkbox" id="nav-7-8">
    
    <label class="md-nav__link" for="nav-7-8">
      Функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-8">
        Функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/arithmetic_functions/" title="Арифметические функции" class="md-nav__link">
      Арифметические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/comparison_functions/" title="Функции сравнения" class="md-nav__link">
      Функции сравнения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/logical_functions/" title="Логические функции" class="md-nav__link">
      Логические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/type_conversion_functions/" title="Функции преобразования типов" class="md-nav__link">
      Функции преобразования типов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/date_time_functions/" title="Функции для работы с датами и временем" class="md-nav__link">
      Функции для работы с датами и временем
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/string_functions/" title="Функции для работы со строками" class="md-nav__link">
      Функции для работы со строками
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/string_search_functions/" title="Функции поиска в строках" class="md-nav__link">
      Функции поиска в строках
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/string_replace_functions/" title="Функции поиска и замены в строках" class="md-nav__link">
      Функции поиска и замены в строках
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/conditional_functions/" title="Условные функции" class="md-nav__link">
      Условные функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/math_functions/" title="Математические функции" class="md-nav__link">
      Математические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/rounding_functions/" title="Функции округления" class="md-nav__link">
      Функции округления
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/array_functions/" title="Функции по работе с массивами" class="md-nav__link">
      Функции по работе с массивами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/splitting_merging_functions/" title="Функции разбиения и слияния строк и массивов" class="md-nav__link">
      Функции разбиения и слияния строк и массивов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/bit_functions/" title="Битовые функции" class="md-nav__link">
      Битовые функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/bitmap_functions/" title="Функции для битмапов" class="md-nav__link">
      Функции для битмапов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/hash_functions/" title="Функции хэширования" class="md-nav__link">
      Функции хэширования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/random_functions/" title="Функции генерации псевдослучайных чисел" class="md-nav__link">
      Функции генерации псевдослучайных чисел
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/uuid_functions/" title="Функции для работы с UUID" class="md-nav__link">
      Функции для работы с UUID
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/encoding_functions/" title="Функции кодирования" class="md-nav__link">
      Функции кодирования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/url_functions/" title="Функции для работы с URL" class="md-nav__link">
      Функции для работы с URL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/ip_address_functions/" title="Функции для работы с IP-адресами" class="md-nav__link">
      Функции для работы с IP-адресами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/json_functions/" title="Функции для работы с JSON." class="md-nav__link">
      Функции для работы с JSON.
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/higher_order_functions/" title="Функции высшего порядка" class="md-nav__link">
      Функции высшего порядка
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/ext_dict_functions/" title="Функции для работы с внешними словарями" class="md-nav__link">
      Функции для работы с внешними словарями
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/ym_dict_functions/" title="Функции для работы со словарями Яндекс.Метрики" class="md-nav__link">
      Функции для работы со словарями Яндекс.Метрики
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/in_functions/" title="Функции для реализации оператора IN." class="md-nav__link">
      Функции для реализации оператора IN.
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/array_join/" title="Функция arrayJoin" class="md-nav__link">
      Функция arrayJoin
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/geo/" title="Функции для работы с географическими координатами" class="md-nav__link">
      Функции для работы с географическими координатами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/functions_for_nulls/" title="Функции c Nullable агрументами" class="md-nav__link">
      Функции c Nullable агрументами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/machine_learning_functions/" title="Функции машинного обучения" class="md-nav__link">
      Функции машинного обучения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/functions/other_functions/" title="Прочие функции" class="md-nav__link">
      Прочие функции
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-9" type="checkbox" id="nav-7-9">
    
    <label class="md-nav__link" for="nav-7-9">
      Агрегатные функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-9">
        Агрегатные функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/agg_functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/agg_functions/reference/" title="Справочник функций" class="md-nav__link">
      Справочник функций
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/agg_functions/combinators/" title="Комбинаторы агрегатных функций" class="md-nav__link">
      Комбинаторы агрегатных функций
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/agg_functions/parametric_functions/" title="Параметрические агрегатные функции" class="md-nav__link">
      Параметрические агрегатные функции
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-10" type="checkbox" id="nav-7-10">
    
    <label class="md-nav__link" for="nav-7-10">
      Табличные функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-10">
        Табличные функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/file/" title="file" class="md-nav__link">
      file
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/merge/" title="merge" class="md-nav__link">
      merge
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/numbers/" title="numbers" class="md-nav__link">
      numbers
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/remote/" title="remote" class="md-nav__link">
      remote
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/url/" title="url" class="md-nav__link">
      url
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/mysql/" title="mysql" class="md-nav__link">
      mysql
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/jdbc/" title="jdbc" class="md-nav__link">
      jdbc
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/odbc/" title="odbc" class="md-nav__link">
      odbc
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/hdfs/" title="hdfs" class="md-nav__link">
      hdfs
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/table_functions/input/" title="input" class="md-nav__link">
      input
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-11" type="checkbox" id="nav-7-11">
    
    <label class="md-nav__link" for="nav-7-11">
      Словари
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-11">
        Словари
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-11-2" type="checkbox" id="nav-7-11-2">
    
    <label class="md-nav__link" for="nav-7-11-2">
      Внешние словари
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-11-2">
        Внешние словари
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/external_dicts/" title="Общее описание" class="md-nav__link">
      Общее описание
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/external_dicts_dict/" title="Настройка внешнего словаря" class="md-nav__link">
      Настройка внешнего словаря
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/external_dicts_dict_layout/" title="Хранение словарей в памяти" class="md-nav__link">
      Хранение словарей в памяти
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/external_dicts_dict_lifetime/" title="Обновление словарей" class="md-nav__link">
      Обновление словарей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/external_dicts_dict_sources/" title="Источники внешних словарей" class="md-nav__link">
      Источники внешних словарей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/external_dicts_dict_structure/" title="Ключ и поля словаря" class="md-nav__link">
      Ключ и поля словаря
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/dicts/internal_dicts/" title="Встроенные словари" class="md-nav__link">
      Встроенные словари
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/operators/" title="Операторы" class="md-nav__link">
      Операторы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../query_language/syntax/" title="Общий синтаксис" class="md-nav__link">
      Общий синтаксис
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Эксплуатация
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Эксплуатация
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/requirements/" title="Требования" class="md-nav__link">
      Требования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/monitoring/" title="Мониторинг" class="md-nav__link">
      Мониторинг
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/troubleshooting/" title="Устранение неисправностей" class="md-nav__link">
      Устранение неисправностей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/tips/" title="Советы по эксплуатации" class="md-nav__link">
      Советы по эксплуатации
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/update/" title="Обновление ClickHouse" class="md-nav__link">
      Обновление ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/access_rights/" title="Права доступа" class="md-nav__link">
      Права доступа
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/backup/" title="Резервное копирование" class="md-nav__link">
      Резервное копирование
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/configuration_files/" title="Конфигурационные файлы" class="md-nav__link">
      Конфигурационные файлы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/quotas/" title="Квоты" class="md-nav__link">
      Квоты
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/system_tables/" title="Системные таблицы" class="md-nav__link">
      Системные таблицы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-12" type="checkbox" id="nav-8-12">
    
    <label class="md-nav__link" for="nav-8-12">
      Конфигурационные параметры сервера
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-12">
        Конфигурационные параметры сервера
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/server_settings/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/server_settings/settings/" title="Серверные настройки" class="md-nav__link">
      Серверные настройки
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-13" type="checkbox" id="nav-8-13">
    
    <label class="md-nav__link" for="nav-8-13">
      Настройки
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-13">
        Настройки
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/settings/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/settings/permissions_for_queries/" title="Разрешения на выполнение запросов" class="md-nav__link">
      Разрешения на выполнение запросов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/settings/query_complexity/" title="Ограничения на сложность запроса" class="md-nav__link">
      Ограничения на сложность запроса
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/settings/settings/" title="Настройки" class="md-nav__link">
      Настройки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/settings/constraints_on_settings/" title="Ограничения на изменение настроек" class="md-nav__link">
      Ограничения на изменение настроек
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/settings/settings_profiles/" title="Профили настроек" class="md-nav__link">
      Профили настроек
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/settings/settings_users/" title="Настройки пользователей" class="md-nav__link">
      Настройки пользователей
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-14" type="checkbox" id="nav-8-14">
    
    <label class="md-nav__link" for="nav-8-14">
      Утилиты
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-14">
        Утилиты
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/utils/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/utils/clickhouse-copier/" title="clickhouse-copier" class="md-nav__link">
      clickhouse-copier
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../operations/utils/clickhouse-local/" title="clickhouse-local" class="md-nav__link">
      clickhouse-local
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      F.A.Q.
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        F.A.Q.
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../faq/general/" title="Общие вопросы" class="md-nav__link">
      Общие вопросы
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Разработка
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Разработка
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../development/architecture/" title="Обзор архитектуры ClickHouse" class="md-nav__link">
      Обзор архитектуры ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../development/build/" title="Как собрать ClickHouse на Linux" class="md-nav__link">
      Как собрать ClickHouse на Linux
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../development/build_osx/" title="Как собрать ClickHouse на Mac OS X" class="md-nav__link">
      Как собрать ClickHouse на Mac OS X
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../development/style/" title="Как писать код на C++" class="md-nav__link">
      Как писать код на C++
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../development/tests/" title="Как запустить тесты" class="md-nav__link">
      Как запустить тесты
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../development/contrib/" title="Сторонние библиотеки" class="md-nav__link">
      Сторонние библиотеки
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Что нового
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Что нового
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../security_changelog/" title="Security changelog" class="md-nav__link">
      Security changelog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../../roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
  </ul>
  

  <ul id="md-extra-nav" class="md-nav__list" data-md-scrollfix>
    <li class="md-nav__item md-nav__item--active">
      Релиз:
      <span class="md-selector">
        <select id="releases-selector">
          <option value="">последний</option>
          
            <option value="v20.1"
              
            >v20.1</option>
          
            <option value="v19.17"
              
            >v19.17</option>
          
            <option value="v19.16"
              
            >v19.16</option>
          
            <option value="v19.15"
              
                selected="selected"
              
            >v19.15</option>
          
            <option value="v19.14"
              
            >v19.14</option>
          
            <option value="v19.13"
              
            >v19.13</option>
          
            <option value="v19.11"
              
            >v19.11</option>
          
            <option value="v19.10"
              
            >v19.10</option>
          
            <option value="v19.9"
              
            >v19.9</option>
          
            <option value="v19.8"
              
            >v19.8</option>
          
            <option value="v19.7"
              
            >v19.7</option>
          
        </select><span id="releases-selector-after">&nbsp;▾</span>
      </span>
    </li>
    <li class="md-nav__item md-nav__item--active">
        
          <a href="../../../single/" class="md-nav__link md-nav__link--active">Одностраничная версия</a>
        
    </li>
    <li class="md-nav__item md-nav__item--active">
          <a href="../../../single/clickhouse_ru.pdf" class="md-nav__link md-nav__link--active">PDF версия</a>
    </li>
    
    <li class="md-nav__item md-nav__item--active">
      <a href="https://github.com/ClickHouse/ClickHouse/" rel="external nofollow" target="_blank" class="md-nav__link">
        Исходный код ClickHouse
      </a>
    </li>
    
    <li class="md-nav__item md-nav__item--active">
        <span id="md-sidebar-flags" class="md-nav__link">
        

  <a class="md-alt-lang"
     href="../../../../en/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="English">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 60 30"><clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath><path fill="#00247d" d="M0,0 v30 h60 v-30 z"/><path stroke="#fff" stroke-width="6" d="M0,0 L60,30 M60,0 L0,30"/><path stroke="#cf142b" stroke-width="4" d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)"/><path stroke="#fff" stroke-width="10" d="M30,0 v30 M0,15 h60"/><path stroke="#cf142b" stroke-width="6" d="M30,0 v30 M0,15 h60"/></svg>
  </a>

  <a class="md-alt-lang md-current-lang"
     href="../../../../ru/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Russian">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 9 6"><rect width="9" height="3" fill="#fff"/><rect width="9" height="3" y="3" fill="#d52b1e"/><rect width="9" height="2" y="2" fill="#0039a6"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../../zh/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Chinese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 30 20"><defs><path id="s" fill="#ffde00" d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/></defs><rect width="30" height="20" fill="#de2910"/><use transform="translate(5,5) scale(3)" xlink:href="#s"/><use transform="translate(10,2) rotate(23.036243)" xlink:href="#s"/><use transform="translate(12,4) rotate(45.869898)" xlink:href="#s"/><use transform="translate(12,7) rotate(69.945396)" xlink:href="#s"/><use transform="translate(10,9) rotate(20.659808)" xlink:href="#s"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../../ja/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Japanese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="90" height="60" version="1.1" viewBox="0 0 90 60"><g id="surface1"><rect width="90" height="60" x="0" y="0" fill="#A0A0A0" fill-opacity="1" stroke="none"/><path fill="#FFF" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562"/><path fill="#BE0026" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30"/></g></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../../fa/operations/table_engines/mergetree/" class="md-flex__ellipsis md-header-nav__title"
     title="Farsi">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 630 360"><rect width="630" height="360" fill="#da0000"/><rect width="630" height="240" fill="#fff"/><rect width="630" height="120" fill="#239f40"/><g transform="translate(8.4,100.4)"><g id="tb4"><g id="tb1" fill="none" stroke="#fff" stroke-width="2"><path id="tbp1" d="M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9" transform="scale(1.4)"/><path id="tbp2" d="M0,7H9M10,7H19" transform="scale(2.8)"/><use y="120" xlink:href="#tbp2"/><use y="145.2" xlink:href="#tbp1"/></g><g id="tb3"><use x="56" xlink:href="#tb1"/><use x="112" xlink:href="#tb1"/><use x="168" xlink:href="#tb1"/></g></g><use x="168" xlink:href="#tb3"/><use x="392" xlink:href="#tb4"/></g><g fill="#da0000" transform="matrix(45,0,0,45,315,180)"><g id="emblem_half"><path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/><path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/><path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/><path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/></g><use transform="scale(-1,1)" xlink:href="#emblem_half"/></g></svg>
  </a>

        </span>
    </li>
  </ul>
</nav>
                    
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
                      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table_engine-mergetree-creating-a-table" title="Создание таблицы" class="md-nav__link">
    Создание таблицы
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sektsii-zaprosa" title="Секции запроса" class="md-nav__link">
    Секции запроса
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#khranenie-dannykh" title="Хранение данных" class="md-nav__link">
    Хранение данных
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary-keys-and-indexes-in-queries" title="Первичные ключи и индексы в запросах" class="md-nav__link">
    Первичные ключи и индексы в запросах
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vybor-pervichnogo-kliucha" title="Выбор первичного ключа" class="md-nav__link">
    Выбор первичного ключа
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pervichnyi-kliuch-otlichnyi-ot-kliucha-sortirovki" title="Первичный ключ, отличный от ключа сортировки" class="md-nav__link">
    Первичный ключ, отличный от ключа сортировки
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ispolzovanie-indeksov-i-partitsii-v-zaprosakh" title="Использование индексов и партиций в запросах" class="md-nav__link">
    Использование индексов и партиций в запросах
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ispolzovanie-indeksa-dlia-chastichno-monotonnykh-pervichnykh-kliuchei" title="Использование индекса для частично-монотонных первичных ключей" class="md-nav__link">
    Использование индекса для частично-монотонных первичных ключей
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table_engine-mergetree-data_skipping-indexes" title="Индексы пропуска данных (экспериментальная функциональность)" class="md-nav__link">
    Индексы пропуска данных (экспериментальная функциональность)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dostupnye-indeksy" title="Доступные индексы" class="md-nav__link">
    Доступные индексы
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#podderzhka-dlia-funktsii" title="Поддержка для функций" class="md-nav__link">
    Поддержка для функций
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#konkurentnyi-dostup-k-dannym" title="Конкурентный доступ к данным" class="md-nav__link">
    Конкурентный доступ к данным
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table_engine-mergetree-ttl" title="TTL для столбцов и таблиц" class="md-nav__link">
    TTL для столбцов и таблиц
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table_engine-mergetree-multiple-volumes" title="Хранение данных таблицы на нескольких блочных устройствах" class="md-nav__link">
    Хранение данных таблицы на нескольких блочных устройствах
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obshchee" title="Общее" class="md-nav__link">
    Общее
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terminy" title="Термины" class="md-nav__link">
    Термины
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table_engine-mergetree-multiple-volumes_configure" title="Конфигурация" class="md-nav__link">
    Конфигурация
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#osobennosti-raboty" title="Особенности работы" class="md-nav__link">
    Особенности работы
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                    
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  
                    <a href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/operations/table_engines/mergetree.md" title="Редактировать страницу" class="md-icon md-content__icon" rel="external nofollow">&#xE3C9;</a>
                  
                
                
                <div id="content">
                
                  <h1 id="table_engines-mergetree">MergeTree<a class="headerlink" href="#table_engines-mergetree" title="Permanent link">&para;</a></h1>
<p>Движок <code>MergeTree</code>, а также другие движки этого семейства (<code>*MergeTree</code>) — это наиболее функциональные движки таблиц ClickHousе.</p>
<p>Основная идея, заложенная в основу движков семейства <code>MergeTree</code> следующая. Когда у вас есть огромное количество данных, которые должны быть вставлены в таблицу, вы должны быстро записать их по частям, а затем объединить части по некоторым правилам в фоновом режиме. Этот метод намного эффективнее, чем постоянная перезапись данных в хранилище при вставке.</p>
<p>Основные возможности:</p>
<ul>
<li>
<p>Хранит данные, отсортированные по первичному ключу.</p>
<p>Это позволяет создавать разреженный индекс небольшого объёма, который позволяет быстрее находить данные.</p>
</li>
<li>
<p>Позволяет оперировать партициями, если задан <a href="../custom_partitioning_key/">ключ партиционирования</a>.</p>
<p>ClickHouse поддерживает отдельные операции с партициями, которые работают эффективнее, чем общие операции с этим же результатом над этими же данными. Также, ClickHouse автоматически отсекает данные по партициям там, где ключ партиционирования указан в запросе. Это также увеличивает эффективность выполнения запросов.</p>
</li>
<li>
<p>Поддерживает репликацию данных.</p>
<p>Для этого используется семейство таблиц <code>ReplicatedMergeTree</code>. Подробнее читайте в разделе <a href="../replication/">Репликация данных</a>.</p>
</li>
<li>
<p>Поддерживает сэмплирование данных.</p>
<p>При необходимости можно задать способ сэмплирования данных в таблице.</p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Движок <a href="../merge/">Merge</a> не относится к семейству <code>*MergeTree</code>.</p>
</div>
<h2 id="table_engine-mergetree-creating-a-table">Создание таблицы<a class="headerlink" href="#table_engine-mergetree-creating-a-table" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span><span class="p">]</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table_name</span> <span class="p">[</span><span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span><span class="p">]</span>
<span class="p">(</span>
    <span class="n">name1</span> <span class="p">[</span><span class="n">type1</span><span class="p">]</span> <span class="p">[</span><span class="k">DEFAULT</span><span class="o">|</span><span class="n">MATERIALIZED</span><span class="o">|</span><span class="k">ALIAS</span> <span class="n">expr1</span><span class="p">]</span> <span class="p">[</span><span class="n">TTL</span> <span class="n">expr1</span><span class="p">],</span>
    <span class="n">name2</span> <span class="p">[</span><span class="n">type2</span><span class="p">]</span> <span class="p">[</span><span class="k">DEFAULT</span><span class="o">|</span><span class="n">MATERIALIZED</span><span class="o">|</span><span class="k">ALIAS</span> <span class="n">expr2</span><span class="p">]</span> <span class="p">[</span><span class="n">TTL</span> <span class="n">expr2</span><span class="p">],</span>
    <span class="p">...</span>
    <span class="k">INDEX</span> <span class="n">index_name1</span> <span class="n">expr1</span> <span class="k">TYPE</span> <span class="n">type1</span><span class="p">(...)</span> <span class="n">GRANULARITY</span> <span class="n">value1</span><span class="p">,</span>
    <span class="k">INDEX</span> <span class="n">index_name2</span> <span class="n">expr2</span> <span class="k">TYPE</span> <span class="n">type2</span><span class="p">(...)</span> <span class="n">GRANULARITY</span> <span class="n">value2</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">MergeTree</span><span class="p">()</span>
<span class="p">[</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">expr</span><span class="p">]</span>
<span class="p">[</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">expr</span><span class="p">]</span>
<span class="p">[</span><span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">expr</span><span class="p">]</span>
<span class="p">[</span><span class="n">SAMPLE</span> <span class="k">BY</span> <span class="n">expr</span><span class="p">]</span>
<span class="p">[</span><span class="n">TTL</span> <span class="n">expr</span><span class="p">]</span>
<span class="p">[</span><span class="n">SETTINGS</span> <span class="n">name</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="p">...]</span>
</pre></div>


<p>Описание параметров смотрите в <a href="../../../query_language/create/">описании запроса CREATE</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>INDEX</code> — экспериментальная возможность, смотрите <a href="#table_engine-mergetree-data_skipping-indexes">Индексы пропуска данных</a>.</p>
</div>
<h3 id="sektsii-zaprosa">Секции запроса<a class="headerlink" href="#sektsii-zaprosa" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>ENGINE</code> — имя и параметры движка. <code>ENGINE = MergeTree()</code>. <code>MergeTree</code> не имеет параметров.</p>
</li>
<li>
<p><code>PARTITION BY</code> — <a href="../custom_partitioning_key/">ключ партиционирования</a>.</p>
<p>Для партиционирования по месяцам используйте выражение <code>toYYYYMM(date_column)</code>, где <code>date_column</code> — столбец с датой типа <a href="../../../data_types/date/">Date</a>. В этом случае имена партиций имеют формат <code>"YYYYMM"</code>.</p>
</li>
<li>
<p><code>ORDER BY</code> — ключ сортировки.</p>
<p>Кортеж столбцов или произвольных выражений. Пример: <code>ORDER BY (CounterID, EventDate)</code>.</p>
</li>
<li>
<p><code>PRIMARY KEY</code> — первичный ключ, если он <a href="./">отличается от ключа сортировки</a>.</p>
<p>По умолчанию первичный ключ совпадает с ключом сортировки (который задаётся секцией <code>ORDER BY</code>.) Поэтому в большинстве случаев секцию <code>PRIMARY KEY</code> отдельно указывать не нужно.</p>
</li>
<li>
<p><code>SAMPLE BY</code> — выражение для сэмплирования.</p>
<p>Если используется выражение для сэмплирования, то первичный ключ должен содержать его. Пример:
<code>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code>.</p>
</li>
<li>
<p><code>TTL</code> — выражение, определяющее длительность хранения строк.</p>
<p>Должно зависеть от столбца <code>Date</code> или <code>DateTime</code> и возвращать столбец <code>Date</code> или <code>DateTime</code>. Пример:<code>TTL date + INTERVAL 1 DAY</code></p>
<p>Дополнительные сведения смотрите в разделе <a href="./">TTL для столбцов и таблиц</a></p>
</li>
<li>
<p><code>SETTINGS</code> — дополнительные параметры, регулирующие поведение <code>MergeTree</code>:</p>
<ul>
<li><code>index_granularity</code> — гранулярность индекса. Число строк данных между «засечками» индекса. По умолчанию — 8192. Список всех доступных параметров можно посмотреть в <a href="https://github.com/ClickHouse/ClickHouse/blob/master/dbms/src/Storages/MergeTree/MergeTreeSettings.h" rel="external nofollow">MergeTreeSettings.h</a>.</li>
<li><code>min_merge_bytes_to_use_direct_io</code> — минимальный объем данных, необходимый для прямого (небуферизованного) чтения/записи (direct I/O) на диск. При слиянии частей данных ClickHouse вычисляет общий объем хранения всех данных, подлежащих слиянию. Если общий объем хранения всех данных для чтения превышает <code>min_bytes_to_use_direct_io</code> байт, тогда ClickHouse  использует флаг <code>O_DIRECT</code> при чтении данных с диска. Если <code>min_merge_bytes_to_use_direct_io = 0</code>, тогда прямой ввод-вывод отключен. Значение по умолчанию: <code>10 * 1024 * 1024 * 1024</code> байт.
<a name="mergetree_setting-merge_with_ttl_timeout"></a></li>
<li><code>merge_with_ttl_timeout</code> - Минимальное время в секундах для повторного выполнения слияний с TTL. По умолчанию - 86400 (1 день).</li>
</ul>
</li>
</ul>
<p><strong>Пример задания секций</strong></p>
<div class="codehilite"><pre><span></span><span class="n">ENGINE</span> <span class="n">MergeTree</span><span class="p">()</span> <span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">toYYYYMM</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="p">(</span><span class="n">CounterID</span><span class="p">,</span> <span class="n">EventDate</span><span class="p">,</span> <span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">))</span> <span class="n">SAMPLE</span> <span class="k">BY</span> <span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">)</span> <span class="n">SETTINGS</span> <span class="n">index_granularity</span><span class="o">=</span><span class="mi">8192</span>
</pre></div>


<p>В примере мы устанавливаем партиционирование по месяцам.</p>
<p>Также мы задаем выражение для сэмплирования в виде хэша по идентификатору посетителя. Это позволяет псевдослучайным образом перемешать данные в таблице для каждого <code>CounterID</code> и <code>EventDate</code>. Если при выборке данных задать секцию <a href="../../../query_language/select/#select-sample-clause">SAMPLE</a>, то ClickHouse вернёт равномерно-псевдослучайную выборку данных для подмножества посетителей.</p>
<p><code>index_granularity</code> можно было не указывать, поскольку 8192 — это значение по умолчанию.</p>
<p><details markdown="1"><summary>Устаревший способ создания таблицы</summary></p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Не используйте этот способ в новых проектах и по возможности переведите старые проекты на способ, описанный выше.</p>
</div>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span><span class="p">]</span> <span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table_name</span> <span class="p">[</span><span class="k">ON</span> <span class="k">CLUSTER</span> <span class="k">cluster</span><span class="p">]</span>
<span class="p">(</span>
    <span class="n">name1</span> <span class="p">[</span><span class="n">type1</span><span class="p">]</span> <span class="p">[</span><span class="k">DEFAULT</span><span class="o">|</span><span class="n">MATERIALIZED</span><span class="o">|</span><span class="k">ALIAS</span> <span class="n">expr1</span><span class="p">],</span>
    <span class="n">name2</span> <span class="p">[</span><span class="n">type2</span><span class="p">]</span> <span class="p">[</span><span class="k">DEFAULT</span><span class="o">|</span><span class="n">MATERIALIZED</span><span class="o">|</span><span class="k">ALIAS</span> <span class="n">expr2</span><span class="p">],</span>
    <span class="p">...</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="n">MergeTree</span><span class="p">(</span><span class="nb">date</span><span class="o">-</span><span class="k">column</span> <span class="p">[,</span> <span class="n">sampling_expression</span><span class="p">],</span> <span class="p">(</span><span class="k">primary</span><span class="p">,</span> <span class="k">key</span><span class="p">),</span> <span class="n">index_granularity</span><span class="p">)</span>
</pre></div>


<p><strong>Параметры MergeTree()</strong></p>
<ul>
<li><code>date-column</code> — имя столбца с типом <a href="../../../data_types/date/">Date</a>. На основе этого столбца ClickHouse автоматически создаёт партиции по месяцам. Имена партиций имеют формат <code>"YYYYMM"</code>.</li>
<li><code>sampling_expression</code> — выражение для сэмплирования.</li>
<li><code>(primary, key)</code> — первичный ключ. Тип — <a href="../../../data_types/tuple/">Tuple()</a></li>
<li><code>index_granularity</code> — гранулярность индекса. Число строк данных между «засечками» индекса. Для большинства задач подходит значение 8192.</li>
</ul>
<p><strong>Пример</strong></p>
<div class="codehilite"><pre><span></span><span class="n">MergeTree</span><span class="p">(</span><span class="n">EventDate</span><span class="p">,</span> <span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">),</span> <span class="p">(</span><span class="n">CounterID</span><span class="p">,</span> <span class="n">EventDate</span><span class="p">,</span> <span class="n">intHash32</span><span class="p">(</span><span class="n">UserID</span><span class="p">)),</span> <span class="mi">8192</span><span class="p">)</span>
</pre></div>


<p>Движок <code>MergeTree</code> сконфигурирован таким же образом, как и в примере выше для основного способа конфигурирования движка.</p>
<p></details></p>
<h2 id="khranenie-dannykh">Хранение данных<a class="headerlink" href="#khranenie-dannykh" title="Permanent link">&para;</a></h2>
<p>Таблица состоит из <em>кусков</em> данных (data parts), отсортированных по первичному ключу.</p>
<p>При вставке в таблицу создаются отдельные куски данных, каждый из которых лексикографически отсортирован по первичному ключу. Например, если первичный ключ — <code>(CounterID, Date)</code>, то данные в куске будут лежать в порядке <code>CounterID</code>, а для каждого <code>CounterID</code> в порядке <code>Date</code>.</p>
<p>Данные, относящиеся к разным партициям, разбиваются на разные куски. В фоновом режиме ClickHouse выполняет слияния (merge) кусков данных для более эффективного хранения. Куски, относящиеся к разным партициям не объединяются. Механизм слияния не гарантирует, что все строки с одинаковым первичным ключом окажутся в одном куске.</p>
<p>Для каждого куска данных ClickHouse создаёт индексный файл, который содержит значение первичного ключа для каждой индексной строки («засечка»). Номера строк индекса определяются как <code>n * index_granularity</code>. Максимальное значение <code>n</code> равно целой части деления общего числа строк на <code>index_granularity</code>. Для каждого столбца "засечки" также записываются для тех же строк индекса, что и первичный ключ. Эти "засечки" позволяют находить данные непосредственно в столбцах.</p>
<p>Вы можете использовать одну большую таблицу, постоянно добавляя в неё данные пачками, именно для этого предназначен движок <code>MergeTree</code>.</p>
<h2 id="primary-keys-and-indexes-in-queries">Первичные ключи и индексы в запросах<a class="headerlink" href="#primary-keys-and-indexes-in-queries" title="Permanent link">&para;</a></h2>
<p>Рассмотрим первичный ключ — <code>(CounterID, Date)</code>. В этом случае сортировку и индекс можно проиллюстрировать следующим образом:</p>
<div class="codehilite"><pre><span></span>Whole data:     [-------------------------------------------------------------------------]
CounterID:      [aaaaaaaaaaaaaaaaaabbbbcdeeeeeeeeeeeeefgggggggghhhhhhhhhiiiiiiiiikllllllll]
Date:           [1111111222222233331233211111222222333211111112122222223111112223311122333]
Marks:           |      |      |      |      |      |      |      |      |      |      |
                a,1    a,2    a,3    b,3    e,2    e,3    g,1    h,2    i,1    i,3    l,3
Marks numbers:   0      1      2      3      4      5      6      7      8      9      10
</pre></div>


<p>Если в запросе к данным указать:</p>
<ul>
<li><code>CounterID IN ('a', 'h')</code>, то сервер читает данные в диапазонах засечек <code>[0, 3)</code> и <code>[6, 8)</code>.</li>
<li><code>CounterID IN ('a', 'h') AND Date = 3</code>, то сервер читает данные в диапазонах засечек <code>[1, 3)</code> и <code>[7, 8)</code>.</li>
<li><code>Date = 3</code>, то сервер читает данные в диапазоне засечек <code>[1, 10]</code>.</li>
</ul>
<p>Примеры выше показывают, что использование индекса всегда эффективнее, чем full scan.</p>
<p>Разреженный индекс допускает чтение лишних строк. При чтении одного диапазона первичного ключа, может быть прочитано до <code>index_granularity * 2</code> лишних строк в каждом блоке данных. В большинстве случаев ClickHouse не теряет производительности при <code>index_granularity = 8192</code>.</p>
<p>Разреженность индекса позволяет работать даже с очень большим количеством строк в таблицах, поскольку такой индекс всегда помещается в оперативную память компьютера.</p>
<p>ClickHouse не требует уникального первичного ключа. Можно вставить много строк с одинаковым первичным ключом.</p>
<h3 id="vybor-pervichnogo-kliucha">Выбор первичного ключа<a class="headerlink" href="#vybor-pervichnogo-kliucha" title="Permanent link">&para;</a></h3>
<p>Количество столбцов в первичном ключе не ограничено явным образом. В зависимости от структуры данных в первичный ключ можно включать больше или меньше столбцов. Это может:</p>
<ul>
<li>
<p>Увеличить эффективность индекса.</p>
<p>Пусть первичный ключ — <code>(a, b)</code>, тогда добавление ещё одного столбца <code>c</code> повысит эффективность, если выполнены условия:</p>
<ul>
<li>Есть запросы с условием на столбец <code>c</code>.</li>
<li>Часто встречаются достаточно длинные (в несколько раз больше <code>index_granularity</code>) диапазоны данных с одинаковыми значениями <code>(a, b)</code>. Иначе говоря, когда добавление ещё одного столбца позволит пропускать достаточно длинные диапазоны данных.</li>
</ul>
</li>
<li>
<p>Улучшить сжатие данных.</p>
<p>ClickHouse сортирует данные по первичному ключу, поэтому чем выше однородность, тем лучше сжатие.</p>
</li>
<li>
<p>Обеспечить дополнительную логику при слиянии кусков данных в движках <a href="../collapsingmergetree/#table_engine-collapsingmergetree">CollapsingMergeTree</a> и <a href="../summingmergetree/">SummingMergeTree</a>.</p>
<p>В этом случае имеет смысл указать отдельный <em>ключ сортировки</em>, отличающийся от первичного ключа.</p>
</li>
</ul>
<p>Длинный первичный ключ будет негативно влиять на производительность вставки и потребление памяти, однако на производительность ClickHouse при запросах <code>SELECT</code> лишние столбцы в первичном ключе не влияют.</p>
<h3 id="pervichnyi-kliuch-otlichnyi-ot-kliucha-sortirovki">Первичный ключ, отличный от ключа сортировки<a class="headerlink" href="#pervichnyi-kliuch-otlichnyi-ot-kliucha-sortirovki" title="Permanent link">&para;</a></h3>
<p>Существует возможность задать первичный ключ (выражение, значения которого будут записаны в индексный файл для
каждой засечки), отличный от ключа сортировки (выражение, по которому будут упорядочены строки в кусках
данных). Кортеж выражения первичного ключа при этом должен быть префиксом кортежа выражения ключа
сортировки.</p>
<p>Данная возможность особенно полезна при использовании движков <a href="../summingmergetree/">SummingMergeTree</a>
и <a href="../aggregatingmergetree/">AggregatingMergeTree</a>. В типичном сценарии использования этих движков таблица
содержит столбцы двух типов: <em>измерения</em> (dimensions) и <em>меры</em> (measures). Типичные запросы агрегируют
значения столбцов-мер с произвольной группировкой и фильтрацией по измерениям. Так как <code>SummingMergeTree</code>
и <code>AggregatingMergeTree</code> производят фоновую агрегацию строк с одинаковым значением ключа сортировки, приходится
добавлять в него все столбцы-измерения. В результате выражение ключа содержит большой список столбцов,
который приходится постоянно расширять при добавлении новых измерений.</p>
<p>В этом сценарии имеет смысл оставить в первичном ключе всего несколько столбцов, которые обеспечат эффективную фильтрацию по индексу, а остальные столбцы-измерения добавить в выражение ключа сортировки.</p>
<p><a href="../../../query_language/alter/">ALTER ключа сортировки</a> — лёгкая операция, так как при одновременном добавлении нового столбца в таблицу и ключ сортировки не нужно изменять данные кусков (они остаются упорядоченными и по новому выражению ключа).</p>
<h3 id="ispolzovanie-indeksov-i-partitsii-v-zaprosakh">Использование индексов и партиций в запросах<a class="headerlink" href="#ispolzovanie-indeksov-i-partitsii-v-zaprosakh" title="Permanent link">&para;</a></h3>
<p>Для запросов <code>SELECT</code> ClickHouse анализирует возможность использования индекса. Индекс может использоваться, если в секции <code>WHERE/PREWHERE</code>, в качестве одного из элементов конъюнкции, или целиком, есть выражение, представляющее операции сравнения на равенства, неравенства, а также <code>IN</code> или <code>LIKE</code> с фиксированным префиксом, над столбцами или выражениями, входящими в первичный ключ или ключ партиционирования, либо над некоторыми частично монотонными функциями от этих столбцов, а также логические связки над такими выражениями.</p>
<p>Таким образом, обеспечивается возможность быстро выполнять запросы по одному или многим диапазонам первичного ключа. Например, в указанном примере будут быстро работать запросы для конкретного счётчика; для конкретного счётчика и диапазона дат; для конкретного счётчика и даты, для нескольких счётчиков и диапазона дат и т. п.</p>
<p>Рассмотрим движок сконфигурированный следующим образом:</p>
<div class="codehilite"><pre><span></span><span class="n">ENGINE</span> <span class="n">MergeTree</span><span class="p">()</span> <span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">toYYYYMM</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="p">(</span><span class="n">CounterID</span><span class="p">,</span> <span class="n">EventDate</span><span class="p">)</span> <span class="n">SETTINGS</span> <span class="n">index_granularity</span><span class="o">=</span><span class="mi">8192</span>
</pre></div>


<p>В этом случае в запросах:</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">()</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">WHERE</span> <span class="n">EventDate</span> <span class="o">=</span> <span class="n">toDate</span><span class="p">(</span><span class="n">now</span><span class="p">())</span> <span class="k">AND</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span>
<span class="k">SELECT</span> <span class="k">count</span><span class="p">()</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">WHERE</span> <span class="n">EventDate</span> <span class="o">=</span> <span class="n">toDate</span><span class="p">(</span><span class="n">now</span><span class="p">())</span> <span class="k">AND</span> <span class="p">(</span><span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span> <span class="k">OR</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="k">count</span><span class="p">()</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">WHERE</span> <span class="p">((</span><span class="n">EventDate</span> <span class="o">&gt;=</span> <span class="n">toDate</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">)</span> <span class="k">AND</span> <span class="n">EventDate</span> <span class="o">&lt;=</span> <span class="n">toDate</span><span class="p">(</span><span class="s1">&#39;2014-01-31&#39;</span><span class="p">))</span> <span class="k">OR</span> <span class="n">EventDate</span> <span class="o">=</span> <span class="n">toDate</span><span class="p">(</span><span class="s1">&#39;2014-05-01&#39;</span><span class="p">))</span> <span class="k">AND</span> <span class="n">CounterID</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">101500</span><span class="p">,</span> <span class="mi">731962</span><span class="p">,</span> <span class="mi">160656</span><span class="p">)</span> <span class="k">AND</span> <span class="p">(</span><span class="n">CounterID</span> <span class="o">=</span> <span class="mi">101500</span> <span class="k">OR</span> <span class="n">EventDate</span> <span class="o">!=</span> <span class="n">toDate</span><span class="p">(</span><span class="s1">&#39;2014-05-01&#39;</span><span class="p">))</span>
</pre></div>


<p>ClickHouse будет использовать индекс по первичному ключу для отсечения не подходящих данных, а также ключ партиционирования по месяцам для отсечения партиций, которые находятся в не подходящих диапазонах дат.</p>
<p>Запросы выше показывают, что индекс используется даже для сложных выражений. Чтение из таблицы организовано так, что использование индекса не может быть медленнее, чем full scan.</p>
<p>В примере ниже индекс не может использоваться.</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">()</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">WHERE</span> <span class="n">CounterID</span> <span class="o">=</span> <span class="mi">34</span> <span class="k">OR</span> <span class="n">URL</span> <span class="k">LIKE</span> <span class="s1">&#39;%upyachka%&#39;</span>
</pre></div>


<p>Чтобы проверить, сможет ли ClickHouse использовать индекс при выполнении запроса, используйте настройки <a href="../../settings/settings/#settings-force_index_by_date">force_index_by_date</a> и <a href="../../settings/settings/#settings-force_primary_key">force_primary_key</a>.</p>
<p>Ключ партиционирования по месяцам обеспечивает чтение только тех блоков данных, которые содержат даты из нужного диапазона. При этом блок данных может содержать данные за многие даты (до целого месяца). В пределах одного блока данные упорядочены по первичному ключу, который может не содержать дату в качестве первого столбца. В связи с этим, при использовании запроса с указанием условия только на дату, но не на префикс первичного ключа, будет читаться данных больше, чем за одну дату.</p>
<h3 id="ispolzovanie-indeksa-dlia-chastichno-monotonnykh-pervichnykh-kliuchei">Использование индекса для частично-монотонных первичных ключей<a class="headerlink" href="#ispolzovanie-indeksa-dlia-chastichno-monotonnykh-pervichnykh-kliuchei" title="Permanent link">&para;</a></h3>
<p>Рассмотрим, например, дни месяца. Они образуют последовательность <a href="https://ru.wikipedia.org/wiki/Монотонная_последовательность" rel="external nofollow">монотонную</a> в течение одного месяца, но не монотонную на более длительных периодах. Это частично-монотонная последовательность. Если пользователь создаёт таблицу с частично-монотонным первичным ключом, ClickHouse как обычно создаёт разреженный индекс. Когда пользователь выбирает данные из такого рода таблиц, ClickHouse анализирует условия запроса. Если пользователь хочет получить данные между двумя метками индекса, и обе эти метки находятся внутри одного месяца, ClickHouse может использовать индекс в данном конкретном случае, поскольку он может рассчитать расстояние между параметрами запроса и индексными метками.</p>
<p>ClickHouse не может использовать индекс, если значения первичного ключа в диапазоне параметров запроса не представляют собой монотонную последовательность. В этом случае ClickHouse использует метод полного сканирования.</p>
<p>ClickHouse использует эту логику не только для последовательностей дней месяца, но и для любого частично-монотонного первичного ключа.</p>
<h3 id="table_engine-mergetree-data_skipping-indexes">Индексы пропуска данных (экспериментальная функциональность)<a class="headerlink" href="#table_engine-mergetree-data_skipping-indexes" title="Permanent link">&para;</a></h3>
<p>Для использования требуется установить настройку <code>allow_experimental_data_skipping_indices</code> в 1. (запустить <code>SET allow_experimental_data_skipping_indices = 1</code>).</p>
<p>Объявление индексов при определении столбцов в запросе <code>CREATE</code>.</p>
<div class="codehilite"><pre><span></span><span class="k">INDEX</span> <span class="n">index_name</span> <span class="n">expr</span> <span class="k">TYPE</span> <span class="k">type</span><span class="p">(...)</span> <span class="n">GRANULARITY</span> <span class="n">granularity_value</span>
</pre></div>


<p>Для таблиц семейства <code>*MergeTree</code> можно задать дополнительные индексы в секции столбцов.</p>
<p>Индексы агрегируют для заданного выражения некоторые данные, а потом при <code>SELECT</code> запросе используют для пропуска блоков данных (пропускаемый блок состоит из гранул данных в количестве равном гранулярности данного индекса), на которых секция <code>WHERE</code> не может быть выполнена, тем самым уменьшая объем данных читаемых с диска.</p>
<p><strong>Пример</strong></p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span>
<span class="p">(</span>
    <span class="n">u64</span> <span class="n">UInt64</span><span class="p">,</span>
    <span class="n">i32</span> <span class="n">Int32</span><span class="p">,</span>
    <span class="n">s</span> <span class="n">String</span><span class="p">,</span>
    <span class="p">...</span>
    <span class="k">INDEX</span> <span class="n">a</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span> <span class="n">i32</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">TYPE</span> <span class="n">minmax</span> <span class="n">GRANULARITY</span> <span class="mi">3</span><span class="p">,</span>
    <span class="k">INDEX</span> <span class="n">b</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span> <span class="k">length</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">TYPE</span> <span class="k">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="n">GRANULARITY</span> <span class="mi">4</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">MergeTree</span><span class="p">()</span>
<span class="p">...</span>
</pre></div>


<p>Эти индексы смогут использоваться для оптимизации следующих запросов</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="k">count</span><span class="p">()</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">WHERE</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="s1">&#39;z&#39;</span>
<span class="k">SELECT</span> <span class="k">count</span><span class="p">()</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">WHERE</span> <span class="n">u64</span> <span class="o">*</span> <span class="n">i32</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">AND</span> <span class="n">u64</span> <span class="o">*</span> <span class="k">length</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1234</span>
</pre></div>


<h4 id="dostupnye-indeksy">Доступные индексы<a class="headerlink" href="#dostupnye-indeksy" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><code>minmax</code> — Хранит минимум и максимум выражения (если выражение - <code>tuple</code>, то для каждого элемента <code>tuple</code>), используя их для пропуска блоков аналогично первичному ключу.</p>
</li>
<li>
<p><code>set(max_rows)</code> — Хранит уникальные значения выражения на блоке в количестве не более <code>max_rows</code> (если <code>max_rows = 0</code>, то ограничений нет), используя их для пропуска блоков, оценивая выполнимость <code>WHERE</code> выражения на хранимых данных.</p>
</li>
<li>
<p><code>bloom_filter([false_positive])</code> — <a href="https://en.wikipedia.org/wiki/Bloom_filter" rel="external nofollow">фильтр Блума</a> для указанных стоблцов.</p>
<p>Необязательный параметр <code>false_positive</code> — это вероятность получения ложноположительного срабатывания. Возможные значения: (0, 1). Значение по умолчанию: 0.025.</p>
<p>Поддержанные типы данных: <code>Int*</code>, <code>UInt*</code>, <code>Float*</code>, <code>Enum</code>, <code>Date</code>, <code>DateTime</code>, <code>String</code>, <code>FixedString</code>.</p>
<p>Фильтром могут пользоваться функции: <a href="../../../query_language/functions/comparison_functions/">equals</a>, <a href="../../../query_language/functions/comparison_functions/">notEquals</a>, <a href="../../../query_language/functions/in_functions/">in</a>, <a href="../../../query_language/functions/in_functions/">notIn</a>.</p>
</li>
</ul>
<p><strong>Примеры</strong></p>
<div class="codehilite"><pre><span></span><span class="k">INDEX</span> <span class="n">b</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span> <span class="k">length</span><span class="p">(</span><span class="n">str</span><span class="p">),</span> <span class="n">i32</span> <span class="o">+</span> <span class="n">f64</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">date</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span> <span class="k">TYPE</span> <span class="n">minmax</span> <span class="n">GRANULARITY</span> <span class="mi">4</span>
<span class="k">INDEX</span> <span class="n">b</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span> <span class="k">length</span><span class="p">(</span><span class="n">str</span><span class="p">),</span> <span class="n">i32</span> <span class="o">+</span> <span class="n">f64</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">date</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span> <span class="k">TYPE</span> <span class="k">set</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">GRANULARITY</span> <span class="mi">4</span>
</pre></div>


<h4 id="podderzhka-dlia-funktsii">Поддержка для функций<a class="headerlink" href="#podderzhka-dlia-funktsii" title="Permanent link">&para;</a></h4>
<p>Условия в секции <code>WHERE</code> содержат вызовы функций, оперирующих со столбцами. Если столбец - часть индекса, ClickHouse пытается использовать индекс при выполнении функции. Для разных видов индексов, ClickHouse поддерживает различные наборы функций, которые могут использоваться индексами.</p>
<p>Индекс <code>set</code> используется со всеми функциями. Наборы функций для остальных индексов представлены в таблице ниже.</p>
<table>
<thead>
<tr>
<th>Function (operator) / Index</th>
<th>primary key</th>
<th>minmax</th>
<th>ngrambf_v1</th>
<th>tokenbf_v1</th>
<th>bloom_filter</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../../../query_language/functions/comparison_functions/#function-equals">equals (=, ==)</a></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/comparison_functions/#function-notequals">notEquals(!=, &lt;&gt;)</a></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/string_search_functions/#function-like">like</a></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/string_search_functions/#function-notlike">notLike</a></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/string_functions/#function-startswith">startsWith</a></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/string_functions/#function-endswith">endsWith</a></td>
<td>✗</td>
<td>✗</td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/string_search_functions/#function-multisearchany">multiSearchAny</a></td>
<td>✗</td>
<td>✗</td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/in_functions/#in-functions">in</a></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/in_functions/#in-functions">notIn</a></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/comparison_functions/#function-less">less (&lt;)</a></td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/comparison_functions/#function-greater">greater (&gt;)</a></td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/comparison_functions/#function-lessorequals">lessOrEquals (&lt;=)</a></td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/comparison_functions/#function-greaterorequals">greaterOrEquals (&gt;=)</a></td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/array_functions/#function-empty">empty</a></td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td><a href="../../../query_language/functions/array_functions/#function-notempty">notEmpty</a></td>
<td>✔</td>
<td>✔</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
</tr>
<tr>
<td>hasToken</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>✔</td>
<td>✗</td>
</tr>
</tbody>
</table>
<p>Функции с постоянным агрументом, который меньше, чем размер ngram не могут использовать индекс <code>ngrambf_v1</code> для оптимизации запроса.</p>
<p>Фильтры Блума могут иметь ложнопозитивные срабатывания, следовательно индексы <code>ngrambf_v1</code>, <code>tokenbf_v1</code> и <code>bloom_filter</code> невозможно использовать для оптимизации запросов, в которых результат функции предполается false, например:</p>
<ul>
<li>Можно оптимизировать:<ul>
<li><code>s LIKE '%test%'</code></li>
<li><code>NOT s NOT LIKE '%test%'</code></li>
<li><code>s = 1</code></li>
<li><code>NOT s != 1</code></li>
<li><code>startsWith(s, 'test')</code></li>
</ul>
</li>
<li>Нельзя оптимизировать:<ul>
<li><code>NOT s LIKE '%test%'</code></li>
<li><code>s NOT LIKE '%test%'</code></li>
<li><code>NOT s = 1</code></li>
<li><code>s != 1</code></li>
<li><code>NOT startsWith(s, 'test')</code></li>
</ul>
</li>
</ul>
<h2 id="konkurentnyi-dostup-k-dannym">Конкурентный доступ к данным<a class="headerlink" href="#konkurentnyi-dostup-k-dannym" title="Permanent link">&para;</a></h2>
<p>Для конкурентного доступа к таблице используется мультиверсионность. То есть, при одновременном чтении и обновлении таблицы, данные будут читаться из набора кусочков, актуального на момент запроса. Длинных блокировок нет. Вставки никак не мешают чтениям.</p>
<p>Чтения из таблицы автоматически распараллеливаются.</p>
<h2 id="table_engine-mergetree-ttl">TTL для столбцов и таблиц<a class="headerlink" href="#table_engine-mergetree-ttl" title="Permanent link">&para;</a></h2>
<p>Определяет время жизни значений.</p>
<p>Секция <code>TTL</code> может быть установлена как для всей таблицы, так и для каждого отдельного столбца. Если установлены оба <code>TTL</code>, то ClickHouse использует тот, что истекает раньше.</p>
<p>Таблица должна иметь столбец типа <a href="../../../data_types/date/">Date</a> или <a href="../../../data_types/datetime/">DateTime</a>. Для установки времени жизни данных, следует использовать операцию со столбцом с временем, например:</p>
<div class="codehilite"><pre><span></span><span class="n">TTL</span> <span class="n">time_column</span>
<span class="n">TTL</span> <span class="n">time_column</span> <span class="o">+</span> <span class="nb">interval</span>
</pre></div>


<p>Чтобы задать <code>interval</code>, используйте операторы <a href="../../../query_language/operators/#operators-datetime">интервала времени</a>.</p>
<div class="codehilite"><pre><span></span><span class="n">TTL</span> <span class="n">date_time</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">MONTH</span>
<span class="n">TTL</span> <span class="n">date_time</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">15</span> <span class="n">HOUR</span>
</pre></div>


<p><strong>TTL столбца</strong></p>
<p>Когда срок действия значений в столбце истечет, ClickHouse заменит их значениями по умолчанию для типа данных столбца. Если срок действия всех значений столбцов в части данных истек, ClickHouse удаляет столбец из куска данных в файловой системе.</p>
<p>Секцию <code>TTL</code> нельзя использовать для ключевых столбцов.</p>
<p>Примеры:</p>
<p>Создание таблицы с TTL</p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example_table</span>
<span class="p">(</span>
    <span class="n">d</span> <span class="n">DateTime</span><span class="p">,</span>
    <span class="n">a</span> <span class="nb">Int</span> <span class="n">TTL</span> <span class="n">d</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">MONTH</span><span class="p">,</span>
    <span class="n">b</span> <span class="nb">Int</span> <span class="n">TTL</span> <span class="n">d</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">MONTH</span><span class="p">,</span>
    <span class="k">c</span> <span class="n">String</span>
<span class="p">)</span>
<span class="n">ENGINE</span> <span class="o">=</span> <span class="n">MergeTree</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">toYYYYMM</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">d</span><span class="p">;</span>
</pre></div>


<p>Добавление TTL на колонку существующей таблицы</p>
<div class="codehilite"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">example_table</span>
    <span class="k">MODIFY</span> <span class="k">COLUMN</span>
    <span class="k">c</span> <span class="n">String</span> <span class="n">TTL</span> <span class="n">d</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">DAY</span><span class="p">;</span>
</pre></div>


<p>Изменение TTL у колонки</p>
<div class="codehilite"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">example_table</span>
    <span class="k">MODIFY</span> <span class="k">COLUMN</span>
    <span class="k">c</span> <span class="n">String</span> <span class="n">TTL</span> <span class="n">d</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">MONTH</span><span class="p">;</span>
</pre></div>


<p><strong>TTL таблицы</strong></p>
<p>Когда некоторые данные в таблице устаревают, ClickHouse удаляет все соответствующие строки.</p>
<p>Примеры:</p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example_table</span>
<span class="p">(</span>
    <span class="n">d</span> <span class="n">DateTime</span><span class="p">,</span>
    <span class="n">a</span> <span class="nb">Int</span>
<span class="p">)</span>
<span class="n">ENGINE</span> <span class="o">=</span> <span class="n">MergeTree</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">toYYYYMM</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">d</span>
<span class="n">TTL</span> <span class="n">d</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">MONTH</span><span class="p">;</span>
</pre></div>


<p>Изменение TTL</p>
<div class="codehilite"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">example_table</span>
    <span class="k">MODIFY</span> <span class="n">TTL</span> <span class="n">d</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">DAY</span><span class="p">;</span>
</pre></div>


<p><strong>Удаление данных</strong></p>
<p>Данные с истекшим TTL удаляются, когда ClickHouse мёржит куски данных.</p>
<p>Когда ClickHouse видит, что некоторые данные устарели, он выполняет внеплановые мёржи. Для управление частотой подобных мёржей, можно задать настройку <a href="#mergetree_setting-merge_with_ttl_timeout">merge_with_ttl_timeout</a>. Если её значение слишком низкое, придется выполнять много внеплановых мёржей, которые могут начать потреблять значительную долю ресурсов сервера.</p>
<p>Если вы выполните запрос <code>SELECT</code> между слияниями вы можете получить устаревшие данные. Чтобы избежать этого используйте запрос <a href="../../../query_language/misc/#misc_operations-optimize">OPTIMIZE</a> перед <code>SELECT</code>.</p>
<h2 id="table_engine-mergetree-multiple-volumes">Хранение данных таблицы на нескольких блочных устройствах<a class="headerlink" href="#table_engine-mergetree-multiple-volumes" title="Permanent link">&para;</a></h2>
<h3 id="obshchee">Общее<a class="headerlink" href="#obshchee" title="Permanent link">&para;</a></h3>
<p>Данные таблиц семейства MergeTree могут храниться на нескольких блочных устройствах. Это может оказаться полезным, например, при неявном разделении данных одной таблицы на "горячие" и "холодные", когда наиболее свежая часть занимает малый объем и запрашивается регулярно, а большой хвост исторических данных запрашивается редко. При наличии в системе нескольких дисков, "горячая" часть данных может быть размещена на быстрых дисках (NVMe SSDs или даже в памяти), а холодная на более медленных (HDD).</p>
<p>Минимальной перемещаемой единицей для MergeTree является кусок (part). Данные одного куска могут находится только на одном диске. Куски могут перемещаться между дисками в фоне, согласно пользовательским настройкам, а также с помощью <a href="../../../query_language/alter/#alter_move-partition">ALTER</a> запросов.</p>
<h3 id="terminy">Термины<a class="headerlink" href="#terminy" title="Permanent link">&para;</a></h3>
<ul>
<li>Диск — примонтированное в файловой системе блочное устройство.</li>
<li>Диск по умолчанию — диск, на котором находится путь, указанный в корне <code>config.xml</code> в теге <code>&lt;path&gt;</code>.</li>
<li>Том (Volume) — упорядоченный набор равноценных дисков (схоже с <a href="https://ru.wikipedia.org/wiki/JBOD" rel="external nofollow">JBOD</a>)</li>
<li>Политика хранения (StoragePolicy) — множество томов с правилами перемещения данных между ними.</li>
</ul>
<p>У всех описанных сущностей, при создании, указываются имена, которые будут отражены в системных таблицах <a href="../../system_tables/#system_tables-storage_policies">system.storage_policies</a> и <a href="../../system_tables/#system_tables-disks">system.disks</a>. Имя политики хранения используется как настройка у таблиц семейства MergeTree.</p>
<h3 id="table_engine-mergetree-multiple-volumes_configure">Конфигурация<a class="headerlink" href="#table_engine-mergetree-multiple-volumes_configure" title="Permanent link">&para;</a></h3>
<p>Диски, тома и политики хранения задаются в корне конфигурации (внутри тега <code>&lt;yandex&gt;</code>) в основном файле <code>config.xml</code> или в отдельном файле в директории <code>config.d</code>. Правила составления данной секции конфигурации имеет следующую структуру:</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;disks&gt;</span>
    <span class="nt">&lt;fast_disk&gt;</span> <span class="c">&lt;!-- disk name --&gt;</span>
        <span class="nt">&lt;path&gt;</span>/mnt/fast_ssd/clickhouse<span class="nt">&lt;/path&gt;</span>
    <span class="nt">&lt;/fast_disk&gt;</span>
    <span class="nt">&lt;disk1&gt;</span>
        <span class="nt">&lt;path&gt;</span>/mnt/hdd1/clickhouse<span class="nt">&lt;/path&gt;</span>
        <span class="nt">&lt;keep_free_space_bytes&gt;</span>10485760<span class="nt">&lt;/keep_free_space_bytes&gt;</span>_
    <span class="nt">&lt;/disk1&gt;</span>
    <span class="nt">&lt;disk2&gt;</span>
        <span class="nt">&lt;path&gt;</span>/mnt/hdd2/clickhouse<span class="nt">&lt;/path&gt;</span>
        <span class="nt">&lt;keep_free_space_bytes&gt;</span>10485760<span class="nt">&lt;/keep_free_space_bytes&gt;</span>_
    <span class="nt">&lt;/disk2&gt;</span>

    ...
<span class="nt">&lt;/disks&gt;</span>
</pre></div>


<p>Где,</p>
<ul>
<li>имя диска задается внутри имени тега.</li>
<li><code>path</code> — путь по которому будут храниться данные сервера (каталоги <code>data</code> и <code>shadow</code>), должен быть терминирован <code>/</code>.</li>
<li><code>keep_free_space_bytes</code> — размер зарезервированного свободного места на диске.</li>
</ul>
<p>Порядок задания дисков не имеет значения.</p>
<p>Конфигурация политик хранения:</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;policies&gt;</span>
    <span class="nt">&lt;hdd_in_order&gt;</span> <span class="c">&lt;!-- policy name --&gt;</span>
        <span class="nt">&lt;volumes&gt;</span>
            <span class="nt">&lt;single&gt;</span> <span class="c">&lt;!-- volume name --&gt;</span>
                <span class="nt">&lt;disk&gt;</span>disk1<span class="nt">&lt;/disk&gt;</span>
                <span class="nt">&lt;disk&gt;</span>disk2<span class="nt">&lt;/disk&gt;</span>
            <span class="nt">&lt;/single&gt;</span>
        <span class="nt">&lt;/volumes&gt;</span>
    <span class="nt">&lt;/hdd_in_order&gt;</span>

    <span class="nt">&lt;moving_from_ssd_to_hdd&gt;</span>
        <span class="nt">&lt;volumes&gt;</span>
            <span class="nt">&lt;hot&gt;</span>
                <span class="nt">&lt;disk&gt;</span>fast_ssd<span class="nt">&lt;/disk&gt;</span>
                <span class="nt">&lt;max_data_part_size_bytes&gt;</span>1073741824<span class="nt">&lt;/max_data_part_size_bytes&gt;</span>
            <span class="nt">&lt;/hot&gt;</span>
            <span class="nt">&lt;cold&gt;</span>
                <span class="nt">&lt;disk&gt;</span>disk1<span class="nt">&lt;/disk&gt;</span>
            <span class="nt">&lt;/cold&gt;</span>
            <span class="nt">&lt;move_factor&gt;</span>0.2<span class="nt">&lt;/move_factor&gt;</span>
        <span class="nt">&lt;/volumes&gt;</span>
    <span class="nt">&lt;/moving_from_ssd_to_hdd&gt;</span>
<span class="nt">&lt;/policies&gt;</span>
</pre></div>


<p>Где,</p>
<ul>
<li>имя политики и тома задаются внутри имен тегов.</li>
<li><code>disk</code> — диск, находящийся внутри тома.</li>
<li><code>max_data_part_size_bytes</code> — максимальный размер куска, который может находится на любом из дисков этого тома.</li>
<li><code>move_factor</code> — доля свободного места, при превышении которого данные начинают перемещаться на следующий том, если он есть (по умолчанию 0.1).</li>
</ul>
<p>В приведенном примере, политика <code>hdd_in_order</code> реализует прицип <a href="https://ru.wikipedia.org/wiki/Round-robin_(%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC)" rel="external nofollow">round-robin</a>. Так как в политике есть всего 1 том (<code>single</code>) все записи производятся на его диски по круговому циклу. Такая политика может быть полезна при наличии в системе нескольких похожих дисков. Политика <code>moving_from_ssd_to_hdd</code> полезна при наличии в разных типов дисков. В томе <code>hot</code> находится один SSD-диск (<code>fast_ssd</code>), а также задается ограничение на максимальный размер куска, который может храниться на этом томе (1GB).   Все куски такой таблицы больше 1GB будут записываться сразу на том <code>cold</code>, в котором содержится один HDD-диск <code>disk1</code>. Также, при заполнении диска <code>fast_ssd</code> более чем на 80% данные будут переносится на диск <code>disk1</code> фоновым процессом.</p>
<p>Порядок томов в политиках хранения важен, при достижении условий на переполнение тома данные переносятся на следующий. Порядок дисков в томах так же важен, данные пишутся по очереди на каждый из них.</p>
<p>После задания конфигурации дисков и политик хранения их можно использовать, как настройку при создании таблиц:</p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">table_with_non_default_policy</span> <span class="p">(</span>
    <span class="n">EventDate</span> <span class="nb">Date</span><span class="p">,</span>
    <span class="n">OrderID</span> <span class="n">UInt64</span><span class="p">,</span>
    <span class="n">BannerID</span> <span class="n">UInt64</span><span class="p">,</span>
    <span class="n">SearchPhrase</span> <span class="n">String</span>
<span class="p">)</span> <span class="n">ENGINE</span> <span class="o">=</span> <span class="n">MergeTree</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="p">(</span><span class="n">OrderID</span><span class="p">,</span> <span class="n">BannerID</span><span class="p">)</span>
<span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">toYYYYMM</span><span class="p">(</span><span class="n">EventDate</span><span class="p">)</span>
<span class="n">SETTINGS</span> <span class="n">storage_policy</span> <span class="o">=</span> <span class="s1">&#39;moving_from_ssd_to_hdd&#39;</span>
</pre></div>


<p>По умолчанию используется политика хранения <code>default</code> в которой есть один том и один диск, указанный в <code>&lt;path&gt;</code>. В данный момент менять политику хранения после создания таблицы нельзя.</p>
<h3 id="osobennosti-raboty">Особенности работы<a class="headerlink" href="#osobennosti-raboty" title="Permanent link">&para;</a></h3>
<p>В таблицах MergeTree данные попадают на диск несколькими способами:</p>
<ul>
<li>В результате вставки (запрос <code>INSERT</code>).</li>
<li>В фоновых операциях слияний и <a href="../../../query_language/alter/#alter-mutations">мутаций</a>.</li>
<li>При скачивании данных с другой реплики.</li>
<li>В результате заморозки партиций <a href="../../../query_language/alter/#alter_freeze-partition">ALTER TABLE ... FREEZE PARTITION</a>.</li>
</ul>
<p>Во всех случаях, кроме мутаций и заморозки партиций, при записи куска выбирается том и диск в соответствии с указанной конфигурацией хранилища:</p>
<ol>
<li>Выбирается первый по порядку том, на котором есть свободное место для записи куска (<code>unreserved_space &gt; current_part_size</code>) и который позволяет записывать куски требуемого размера <code>max_data_part_size_bytes &gt; current_part_size</code>.</li>
<li>Внутри тома выбирается следующий диск после того, на который была предыдущая запись и на котором свободного места больше чем размер куска (<code>unreserved_space - keep_free_space_bytes &gt; current_part_size</code>)</li>
</ol>
<p>Мутации и запросы заморозки партиций в реализации используют <a href="https://ru.wikipedia.org/wiki/%D0%96%D1%91%D1%81%D1%82%D0%BA%D0%B0%D1%8F_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B0" rel="external nofollow">жесткие ссылки</a>. Жесткие ссылки между различными дисками не поддерживаются, поэтому в случае таких операций куски размещаются на тех же дисках, что и исходные.</p>
<p>В фоне куски перемещаются между томами на основе информации о занятом месте (настройка <code>move_factor</code>) по порядку, в котором указаны тома в конфигурации. Данные никогда не перемещаются с последнего тома и на первый том. Следить за фоновыми перемещениями можно с помощью системных таблиц <a href="../../system_tables/#system_tables-part-log">system.part_log</a> (поле <code>type = MOVE_PART</code>) и <a href="../../system_tables/#system_tables-parts">system.parts</a> (поля <code>path</code> и <code>disk</code>). Также подробная информация о перемещениях доступна в логах сервера.</p>
<p>С помощью запроса <a href="../../../query_language/alter/#alter_move-partition">ALTER TABLE ... MOVE PART|PARTITION ... TO VOLUME|DISK ...</a> пользователь может принудительно перенести кусок или партицию с одного раздела на другой. При этом учитываются все ограничения, указанные для фоновых операций. Запрос самостоятельно инициирует процесс перемещения не дожидаясь фоновых операций. В случае недостатка места или неудовлетворения ограничениям пользователь получит сообщение об ошибке.</p>
<p>Перемещения данных не взаимодействуют с репликацией данных, поэтому на разных репликах одной и той же таблицы могут быть указаны разные политики хранения.</p>
<p>После выполнения фоновых слияний или мутаций старые куски не удаляются сразу, а через некоторое время (табличная настройка <code>old_parts_lifetime</code>). Также они не перемещаются на другие тома или диски, поэтому до момента удаления они продолжают учитываться при подсчёте занятого дискового пространства.</p>
                
                </div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
          <a href="../../../operations/table_engines/" title="Введение" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Назад
                </span>
                Введение
              </span>
            </div>
          </a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
          <a href="../../../operations/table_engines/replication/" title="Репликация данных" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Вперед
                </span>
                Репликация данных
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©2016–2020 Yandex LLC
          </div>
        
      </div>
      
        <div class="md-footer-social">
  <span class="md-footer-copyright__highlight">Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/7bc0aa2bed65a44161006cea8efad249600ac881" rel="external nofollow">7bc0aa2</a></span>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      
        <script src="../../../assets/javascripts/modernizr.js"></script>
      
      <script src="../../../assets/javascripts/application.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              <script src="../../../assets/javascripts/lunr/lunr.ru.js"></script>
            
          
          
            <script src="../../../assets/javascripts/lunr/lunr.multi.js"></script>
          
        
      
      
    
    
      
    

    <script type="text/javascript">
      function ready(callback){
          if (document.readyState != 'loading') {
              callback();
          } else if (document.addEventListener) {
              document.addEventListener('DOMContentLoaded', callback);
          } else document.attachEvent('onreadystatechange', function() {
              if (document.readyState == 'complete') {
                  callback();
              }
          });
      }
      ready(function () {
          var i;
          
          app.initialize({
              version: "1.0.4",
              url: {
                  base: "../../.."
              }
          });
          var beforePrint = function() {
            var details = document.getElementsByTagName("details");
            for (i = 0; i < details.length; ++i) {
                details[i].open = 1;
            }
          };
          if (window.matchMedia) {
              window.matchMedia('print').addListener(function(q) {
                  if (q.matches) {
                      beforePrint();
                  }
              });
          }
          window.onbeforeprint = beforePrint;

          var name = window.location.hostname.split('.')[0];
          var feedback_address = name + '-feedback' + '@yandex-team.ru';
          var feedback_email = document.getElementsByClassName('feedback-email');
          for (i = 0; i < feedback_email.length; i++) {
            feedback_email[i].setAttribute('href', 'mailto:' + feedback_address);
            feedback_email[i].innerHTML = feedback_address;
          }

          document.getElementById("releases-selector").addEventListener(
            "change",
            function() {
              var target = window.location.href.split('docs')[0] + 'docs/';
              if (this.value) {
                target = target + this.value + '/';
              }
              window.location = target + 'ru';
            }
          )
      });
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script type="text/javascript"> docsearch({
apiKey: 'e239649803024433599de47a53b2d416',
indexName: 'yandex_clickhouse',
inputSelector: '#md-search__input',
algoliaOptions: {
  advancedSyntax: true,
  clickAnalytics: true,
  hitsPerPage: 25,
  'facetFilters': ["lang:ru"]
},
debug: false
});
</script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter18343495 = new Ya.Metrika2({
                        id:18343495,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor: true
                    });
                } catch(e) { }
            });
            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/tag.js";
            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks2");
    </script>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/18343495" style="position:absolute; left:-9999px;" alt=""/></div>
    </noscript>
    <!-- /Yandex.Metrika counter -->
  </body>
</html>