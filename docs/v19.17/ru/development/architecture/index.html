



<!DOCTYPE html>
<html lang="ru" class="no-js" data-version="v19.17" data-single-page="false">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://clickhouse.yandex/docs/ru/development/architecture/">
      
      
      
      <meta name="lang:clipboard.copy" content="Копировать в буфер">
      
      <meta name="lang:clipboard.copied" content="Скопировано в буфер">
      
      <meta name="lang:search.language" content="ru">
      
      <meta name="lang:search.pipeline.stopwords" content="">
      
      <meta name="lang:search.pipeline.trimmer" content="">
      
      <meta name="lang:search.result.none" content="Совпадений не найдено">
      
      <meta name="lang:search.result.one" content="Найдено 1 совпадение">
      
      <meta name="lang:search.result.other" content="Найдено # совпадений">
      
      <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.ico">
    
    
      
        <title>Обзор архитектуры ClickHouse - Документация ClickHouse v19.17</title>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
      <link rel="stylesheet" href="../../assets/stylesheets/application.2a88008a.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/custom.css?b34fe92?1582274483">
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="white" class="md-lang-ru">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">

  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="/" title="Документация ClickHouse v19.17" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.svg" width="40" height="40">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Документация ClickHouse v19.17
              </span>
              <span class="md-header-nav__topic">
                Обзор архитектуры ClickHouse
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" id="md-search__input" class="md-search__input" name="query" required placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Начните печатать для поиска
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div id="md-language-switch" class="md-header-nav__source">
            

  <a class="md-alt-lang"
     href="../../../en/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="English">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 60 30"><clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath><path fill="#00247d" d="M0,0 v30 h60 v-30 z"/><path stroke="#fff" stroke-width="6" d="M0,0 L60,30 M60,0 L0,30"/><path stroke="#cf142b" stroke-width="4" d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)"/><path stroke="#fff" stroke-width="10" d="M30,0 v30 M0,15 h60"/><path stroke="#cf142b" stroke-width="6" d="M30,0 v30 M0,15 h60"/></svg>
  </a>

  <a class="md-alt-lang md-current-lang"
     href="../../../ru/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Russian">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 9 6"><rect width="9" height="3" fill="#fff"/><rect width="9" height="3" y="3" fill="#d52b1e"/><rect width="9" height="2" y="2" fill="#0039a6"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../zh/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Chinese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 30 20"><defs><path id="s" fill="#ffde00" d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/></defs><rect width="30" height="20" fill="#de2910"/><use transform="translate(5,5) scale(3)" xlink:href="#s"/><use transform="translate(10,2) rotate(23.036243)" xlink:href="#s"/><use transform="translate(12,4) rotate(45.869898)" xlink:href="#s"/><use transform="translate(12,7) rotate(69.945396)" xlink:href="#s"/><use transform="translate(10,9) rotate(20.659808)" xlink:href="#s"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../ja/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Japanese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="90" height="60" version="1.1" viewBox="0 0 90 60"><g id="surface1"><rect width="90" height="60" x="0" y="0" fill="#A0A0A0" fill-opacity="1" stroke="none"/><path fill="#FFF" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562"/><path fill="#BE0026" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30"/></g></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../fa/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Farsi">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 630 360"><rect width="630" height="360" fill="#da0000"/><rect width="630" height="240" fill="#fff"/><rect width="630" height="120" fill="#239f40"/><g transform="translate(8.4,100.4)"><g id="tb4"><g id="tb1" fill="none" stroke="#fff" stroke-width="2"><path id="tbp1" d="M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9" transform="scale(1.4)"/><path id="tbp2" d="M0,7H9M10,7H19" transform="scale(2.8)"/><use y="120" xlink:href="#tbp2"/><use y="145.2" xlink:href="#tbp1"/></g><g id="tb3"><use x="56" xlink:href="#tb1"/><use x="112" xlink:href="#tb1"/><use x="168" xlink:href="#tb1"/></g></g><use x="168" xlink:href="#tb3"/><use x="392" xlink:href="#tb4"/></g><g fill="#da0000" transform="matrix(45,0,0,45,315,180)"><g id="emblem_half"><path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/><path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/><path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/><path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/></g><use transform="scale(-1,1)" xlink:href="#emblem_half"/></g></svg>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
                      <nav class="md-nav md-nav--primary" data-md-level="0">
  
  <label class="md-nav__title md-nav__title--site" for="drawer">
    Документация ClickHouse v19.17
  </label>

  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Введение
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Введение
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../" title="Обзор" class="md-nav__link">
      Обзор
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/distinctive_features/" title="Отличительные возможности ClickHouse" class="md-nav__link">
      Отличительные возможности ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/features_considered_disadvantages/" title="Особенности ClickHouse, которые могут считаться недостатками" class="md-nav__link">
      Особенности ClickHouse, которые могут считаться недостатками
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/performance/" title="Производительность" class="md-nav__link">
      Производительность
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/ya_metrika_task/" title="Постановка задачи в Яндекс.Метрике" class="md-nav__link">
      Постановка задачи в Яндекс.Метрике
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../introduction/info/" title="Информационная поддержка" class="md-nav__link">
      Информационная поддержка
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Начало работы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Начало работы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/" title="Установка и запуск" class="md-nav__link">
      Установка и запуск
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Тестовые наборы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Тестовые наборы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/ontime/" title="OnTime" class="md-nav__link">
      OnTime
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/nyc_taxi/" title="Данные о такси в Нью-Йорке" class="md-nav__link">
      Данные о такси в Нью-Йорке
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/amplab_benchmark/" title="AMPLab Big Data Benchmark" class="md-nav__link">
      AMPLab Big Data Benchmark
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/wikistat/" title="WikiStat" class="md-nav__link">
      WikiStat
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/criteo/" title="Терабайт логов кликов от Criteo" class="md-nav__link">
      Терабайт логов кликов от Criteo
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/star_schema/" title="Схема «Звезда»" class="md-nav__link">
      Схема «Звезда»
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../getting_started/example_datasets/metrica/" title="Данные Яндекс.Метрики" class="md-nav__link">
      Данные Яндекс.Метрики
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Интерфейсы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Интерфейсы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/cli/" title="Клиент командной строки" class="md-nav__link">
      Клиент командной строки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/tcp/" title="Нативный интерфейс (TCP)" class="md-nav__link">
      Нативный интерфейс (TCP)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/http/" title="HTTP-интерфейс" class="md-nav__link">
      HTTP-интерфейс
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/formats/" title="Форматы входных и выходных данных" class="md-nav__link">
      Форматы входных и выходных данных
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/jdbc/" title="JDBC-драйвер" class="md-nav__link">
      JDBC-драйвер
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/odbc/" title="ODBC-драйвер" class="md-nav__link">
      ODBC-драйвер
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/cpp/" title="C++ клиентская библиотека" class="md-nav__link">
      C++ клиентская библиотека
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-9" type="checkbox" id="nav-3-9">
    
    <label class="md-nav__link" for="nav-3-9">
      От сторонних разработчиков
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-9">
        От сторонних разработчиков
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/client_libraries/" title="Клиентские библиотеки" class="md-nav__link">
      Клиентские библиотеки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/integrations/" title="Интеграции" class="md-nav__link">
      Интеграции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/gui/" title="Визуальные интерфейсы" class="md-nav__link">
      Визуальные интерфейсы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../interfaces/third-party/proxy/" title="Прокси" class="md-nav__link">
      Прокси
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Движки баз данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Движки баз данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../database_engines/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../database_engines/mysql/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Движки таблиц
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Движки таблиц
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Семейство MergeTree
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Семейство MergeTree
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/mergetree/" title="MergeTree" class="md-nav__link">
      MergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/replication/" title="Репликация данных" class="md-nav__link">
      Репликация данных
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/custom_partitioning_key/" title="Произвольный ключ партиционирования" class="md-nav__link">
      Произвольный ключ партиционирования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/replacingmergetree/" title="ReplacingMergeTree" class="md-nav__link">
      ReplacingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/summingmergetree/" title="SummingMergeTree" class="md-nav__link">
      SummingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/aggregatingmergetree/" title="AggregatingMergeTree" class="md-nav__link">
      AggregatingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/collapsingmergetree/" title="CollapsingMergeTree" class="md-nav__link">
      CollapsingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/versionedcollapsingmergetree/" title="VersionedCollapsingMergeTree" class="md-nav__link">
      VersionedCollapsingMergeTree
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/graphitemergetree/" title="GraphiteMergeTree" class="md-nav__link">
      GraphiteMergeTree
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Семейство Log
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Семейство Log
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/log_family/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/stripelog/" title="StripeLog" class="md-nav__link">
      StripeLog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/tinylog/" title="TinyLog" class="md-nav__link">
      TinyLog
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Интеграции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        Интеграции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/kafka/" title="Kafka" class="md-nav__link">
      Kafka
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/mysql/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/jdbc/" title="JDBC" class="md-nav__link">
      JDBC
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/odbc/" title="ODBC" class="md-nav__link">
      ODBC
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/hdfs/" title="HDFS" class="md-nav__link">
      HDFS
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      Особые
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        Особые
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/distributed/" title="Distributed" class="md-nav__link">
      Distributed
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/external_data/" title="Внешние данные" class="md-nav__link">
      Внешние данные
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/dictionary/" title="Dictionary" class="md-nav__link">
      Dictionary
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/merge/" title="Merge" class="md-nav__link">
      Merge
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/file/" title="File" class="md-nav__link">
      File
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/null/" title="Null" class="md-nav__link">
      Null
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/set/" title="Set" class="md-nav__link">
      Set
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/join/" title="Join" class="md-nav__link">
      Join
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/url/" title="URL" class="md-nav__link">
      URL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/view/" title="View" class="md-nav__link">
      View
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/materializedview/" title="MaterializedView" class="md-nav__link">
      MaterializedView
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/memory/" title="Memory" class="md-nav__link">
      Memory
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/table_engines/buffer/" title="Buffer" class="md-nav__link">
      Buffer
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Справка по SQL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Справка по SQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/syntax/" title="Общий синтаксис" class="md-nav__link">
      Общий синтаксис
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Запросы
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        Запросы
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/select/" title="SELECT" class="md-nav__link">
      SELECT
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/insert_into/" title="INSERT INTO" class="md-nav__link">
      INSERT INTO
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/create/" title="CREATE" class="md-nav__link">
      CREATE
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/alter/" title="ALTER" class="md-nav__link">
      ALTER
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/system/" title="SYSTEM" class="md-nav__link">
      SYSTEM
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/show/" title="SHOW" class="md-nav__link">
      SHOW
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/misc/" title="Прочие" class="md-nav__link">
      Прочие
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        Функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/arithmetic_functions/" title="Арифметические функции" class="md-nav__link">
      Арифметические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/comparison_functions/" title="Функции сравнения" class="md-nav__link">
      Функции сравнения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/logical_functions/" title="Логические функции" class="md-nav__link">
      Логические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/type_conversion_functions/" title="Функции преобразования типов" class="md-nav__link">
      Функции преобразования типов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/date_time_functions/" title="Функции для работы с датами и временем" class="md-nav__link">
      Функции для работы с датами и временем
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/string_functions/" title="Функции для работы со строками" class="md-nav__link">
      Функции для работы со строками
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/string_search_functions/" title="Функции поиска в строках" class="md-nav__link">
      Функции поиска в строках
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/string_replace_functions/" title="Функции поиска и замены в строках" class="md-nav__link">
      Функции поиска и замены в строках
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/conditional_functions/" title="Условные функции" class="md-nav__link">
      Условные функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/math_functions/" title="Математические функции" class="md-nav__link">
      Математические функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/rounding_functions/" title="Функции округления" class="md-nav__link">
      Функции округления
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/array_functions/" title="Функции по работе с массивами" class="md-nav__link">
      Функции по работе с массивами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/splitting_merging_functions/" title="Функции разбиения и слияния строк и массивов" class="md-nav__link">
      Функции разбиения и слияния строк и массивов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/bit_functions/" title="Битовые функции" class="md-nav__link">
      Битовые функции
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/bitmap_functions/" title="Функции для битмапов" class="md-nav__link">
      Функции для битмапов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/hash_functions/" title="Функции хэширования" class="md-nav__link">
      Функции хэширования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/random_functions/" title="Функции генерации псевдослучайных чисел" class="md-nav__link">
      Функции генерации псевдослучайных чисел
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/uuid_functions/" title="Функции для работы с UUID" class="md-nav__link">
      Функции для работы с UUID
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/encoding_functions/" title="Функции кодирования" class="md-nav__link">
      Функции кодирования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/url_functions/" title="Функции для работы с URL" class="md-nav__link">
      Функции для работы с URL
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/ip_address_functions/" title="Функции для работы с IP-адресами" class="md-nav__link">
      Функции для работы с IP-адресами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/json_functions/" title="Функции для работы с JSON." class="md-nav__link">
      Функции для работы с JSON.
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/higher_order_functions/" title="Функции высшего порядка" class="md-nav__link">
      Функции высшего порядка
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/ext_dict_functions/" title="Функции для работы с внешними словарями" class="md-nav__link">
      Функции для работы с внешними словарями
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/ym_dict_functions/" title="Функции для работы со словарями Яндекс.Метрики" class="md-nav__link">
      Функции для работы со словарями Яндекс.Метрики
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/in_functions/" title="Функции для реализации оператора IN." class="md-nav__link">
      Функции для реализации оператора IN.
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/array_join/" title="Функция arrayJoin" class="md-nav__link">
      Функция arrayJoin
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/geo/" title="Функции для работы с географическими координатами" class="md-nav__link">
      Функции для работы с географическими координатами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/functions_for_nulls/" title="Функции c Nullable аргументами" class="md-nav__link">
      Функции c Nullable аргументами
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/machine_learning_functions/" title="Функции машинного обучения" class="md-nav__link">
      Функции машинного обучения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/functions/other_functions/" title="Прочие функции" class="md-nav__link">
      Прочие функции
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      Агрегатные функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        Агрегатные функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/reference/" title="Справочник функций" class="md-nav__link">
      Справочник функций
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/combinators/" title="Комбинаторы агрегатных функций" class="md-nav__link">
      Комбинаторы агрегатных функций
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/agg_functions/parametric_functions/" title="Параметрические агрегатные функции" class="md-nav__link">
      Параметрические агрегатные функции
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6" type="checkbox" id="nav-6-6">
    
    <label class="md-nav__link" for="nav-6-6">
      Табличные функции
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-6">
        Табличные функции
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/file/" title="file" class="md-nav__link">
      file
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/merge/" title="merge" class="md-nav__link">
      merge
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/numbers/" title="numbers" class="md-nav__link">
      numbers
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/remote/" title="remote" class="md-nav__link">
      remote
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/url/" title="url" class="md-nav__link">
      url
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/mysql/" title="mysql" class="md-nav__link">
      mysql
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/jdbc/" title="jdbc" class="md-nav__link">
      jdbc
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/odbc/" title="odbc" class="md-nav__link">
      odbc
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/hdfs/" title="hdfs" class="md-nav__link">
      hdfs
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/table_functions/input/" title="input" class="md-nav__link">
      input
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7" type="checkbox" id="nav-6-7">
    
    <label class="md-nav__link" for="nav-6-7">
      Словари
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-7">
        Словари
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-7-2" type="checkbox" id="nav-6-7-2">
    
    <label class="md-nav__link" for="nav-6-7-2">
      Внешние словари
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-7-2">
        Внешние словари
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts/" title="Общее описание" class="md-nav__link">
      Общее описание
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict/" title="Настройка внешнего словаря" class="md-nav__link">
      Настройка внешнего словаря
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_layout/" title="Хранение словарей в памяти" class="md-nav__link">
      Хранение словарей в памяти
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_lifetime/" title="Обновление словарей" class="md-nav__link">
      Обновление словарей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_sources/" title="Источники внешних словарей" class="md-nav__link">
      Источники внешних словарей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/external_dicts_dict_structure/" title="Ключ и поля словаря" class="md-nav__link">
      Ключ и поля словаря
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/dicts/internal_dicts/" title="Встроенные словари" class="md-nav__link">
      Встроенные словари
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../query_language/operators/" title="Операторы" class="md-nav__link">
      Операторы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-9" type="checkbox" id="nav-6-9">
    
    <label class="md-nav__link" for="nav-6-9">
      Типы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-9">
        Типы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/int_uint/" title="UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64" class="md-nav__link">
      UInt8, UInt16, UInt32, UInt64, Int8, Int16, Int32, Int64
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/float/" title="Float32, Float64" class="md-nav__link">
      Float32, Float64
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/decimal/" title="Decimal" class="md-nav__link">
      Decimal
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/boolean/" title="Булевы значения" class="md-nav__link">
      Булевы значения
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/string/" title="String" class="md-nav__link">
      String
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/fixedstring/" title="FixedString(N)" class="md-nav__link">
      FixedString(N)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/uuid/" title="UUID" class="md-nav__link">
      UUID
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/date/" title="Date" class="md-nav__link">
      Date
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/datetime/" title="DateTime" class="md-nav__link">
      DateTime
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/enum/" title="Enum" class="md-nav__link">
      Enum
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/array/" title="Array(T)" class="md-nav__link">
      Array(T)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/nested_data_structures/aggregatefunction/" title="AggregateFunction(name, types_of_arguments...)" class="md-nav__link">
      AggregateFunction(name, types_of_arguments...)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/tuple/" title="Tuple(T1, T2, ...)" class="md-nav__link">
      Tuple(T1, T2, ...)
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/nullable/" title="Nullable" class="md-nav__link">
      Nullable
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-9-16" type="checkbox" id="nav-6-9-16">
    
    <label class="md-nav__link" for="nav-6-9-16">
      Вложенные структуры данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-9-16">
        Вложенные структуры данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/nested_data_structures/nested/" title="Nested(Name1 Type1, Name2 Type2, ...)" class="md-nav__link">
      Nested(Name1 Type1, Name2 Type2, ...)
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-9-17" type="checkbox" id="nav-6-9-17">
    
    <label class="md-nav__link" for="nav-6-9-17">
      Служебные типы данных
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-9-17">
        Служебные типы данных
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/special_data_types/expression/" title="Expression" class="md-nav__link">
      Expression
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/special_data_types/set/" title="Set" class="md-nav__link">
      Set
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/special_data_types/nothing/" title="Nothing" class="md-nav__link">
      Nothing
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-9-18" type="checkbox" id="nav-6-9-18">
    
    <label class="md-nav__link" for="nav-6-9-18">
      Domains
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-9-18">
        Domains
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/domains/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/domains/ipv4/" title="IPv4" class="md-nav__link">
      IPv4
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../data_types/domains/ipv6/" title="IPv6" class="md-nav__link">
      IPv6
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Руководства
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Руководства
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../guides/" title="Обзор" class="md-nav__link">
      Обзор
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../guides/apply_catboost_model/" title="Применение CatBoost моделей" class="md-nav__link">
      Применение CatBoost моделей
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Эксплуатация
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Эксплуатация
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/requirements/" title="Требования" class="md-nav__link">
      Требования
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/monitoring/" title="Мониторинг" class="md-nav__link">
      Мониторинг
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/troubleshooting/" title="Устранение неисправностей" class="md-nav__link">
      Устранение неисправностей
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/tips/" title="Советы по эксплуатации" class="md-nav__link">
      Советы по эксплуатации
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/update/" title="Обновление ClickHouse" class="md-nav__link">
      Обновление ClickHouse
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/access_rights/" title="Права доступа" class="md-nav__link">
      Права доступа
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/backup/" title="Резервное копирование" class="md-nav__link">
      Резервное копирование
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/configuration_files/" title="Конфигурационные файлы" class="md-nav__link">
      Конфигурационные файлы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/quotas/" title="Квоты" class="md-nav__link">
      Квоты
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/system_tables/" title="Системные таблицы" class="md-nav__link">
      Системные таблицы
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-12" type="checkbox" id="nav-8-12">
    
    <label class="md-nav__link" for="nav-8-12">
      Конфигурационные параметры сервера
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-12">
        Конфигурационные параметры сервера
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/server_settings/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/server_settings/settings/" title="Серверные настройки" class="md-nav__link">
      Серверные настройки
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-13" type="checkbox" id="nav-8-13">
    
    <label class="md-nav__link" for="nav-8-13">
      Настройки
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-13">
        Настройки
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/permissions_for_queries/" title="Разрешения на выполнение запросов" class="md-nav__link">
      Разрешения на выполнение запросов
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/query_complexity/" title="Ограничения на сложность запроса" class="md-nav__link">
      Ограничения на сложность запроса
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/settings/" title="Настройки" class="md-nav__link">
      Настройки
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/constraints_on_settings/" title="Ограничения на изменение настроек" class="md-nav__link">
      Ограничения на изменение настроек
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/settings_profiles/" title="Профили настроек" class="md-nav__link">
      Профили настроек
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/settings/settings_users/" title="Настройки пользователей" class="md-nav__link">
      Настройки пользователей
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
          
          
          



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-14" type="checkbox" id="nav-8-14">
    
    <label class="md-nav__link" for="nav-8-14">
      Утилиты
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-14">
        Утилиты
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/utils/" title="Введение" class="md-nav__link">
      Введение
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/utils/clickhouse-copier/" title="clickhouse-copier" class="md-nav__link">
      clickhouse-copier
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../operations/utils/clickhouse-local/" title="clickhouse-local" class="md-nav__link">
      clickhouse-local
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      


  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      Разработка
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Разработка
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          
        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Обзор архитектуры ClickHouse
      </label>
    
    <a href="../../development/architecture/" title="Обзор архитектуры ClickHouse" class="md-nav__link md-nav__link--active">
      <strong>Обзор архитектуры ClickHouse</strong>
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#columns" title="Columns" class="md-nav__link">
    Columns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field" title="Field" class="md-nav__link">
    Field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leaky-abstractions" title="Leaky Abstractions" class="md-nav__link">
    Leaky Abstractions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-types" title="Data Types" class="md-nav__link">
    Data Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#block" title="Block" class="md-nav__link">
    Block
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#block-streams" title="Block Streams" class="md-nav__link">
    Block Streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formats" title="Formats" class="md-nav__link">
    Formats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#i-o" title="I/O" class="md-nav__link">
    I/O
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tables" title="Tables" class="md-nav__link">
    Tables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsers" title="Parsers" class="md-nav__link">
    Parsers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpreters" title="Interpreters" class="md-nav__link">
    Interpreters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" title="Functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregate-functions" title="Aggregate Functions" class="md-nav__link">
    Aggregate Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server" title="Server" class="md-nav__link">
    Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-query-execution" title="Distributed Query Execution" class="md-nav__link">
    Distributed Query Execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merge-tree" title="Merge Tree" class="md-nav__link">
    Merge Tree
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replication" title="Replication" class="md-nav__link">
    Replication
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/build/" title="Как собрать ClickHouse на Linux" class="md-nav__link">
      Как собрать ClickHouse на Linux
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/build_osx/" title="Как собрать ClickHouse на Mac OS X" class="md-nav__link">
      Как собрать ClickHouse на Mac OS X
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/build_cross/" title="Как собрать ClickHouse на Linux для Mac OS X" class="md-nav__link">
      Как собрать ClickHouse на Linux для Mac OS X
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/style/" title="Как писать код на C++" class="md-nav__link">
      Как писать код на C++
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/tests/" title="Как запустить тесты" class="md-nav__link">
      Как запустить тесты
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../development/contrib/" title="Сторонние библиотеки" class="md-nav__link">
      Сторонние библиотеки
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Что нового
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Что нового
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../security_changelog/" title="Security changelog" class="md-nav__link">
      Security changelog
    </a>
  </li>


        
          
          
          



  <li class="md-nav__item">
    <a href="../../roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
      
      
      



  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      F.A.Q.
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        F.A.Q.
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="../../faq/general/" title="Общие вопросы" class="md-nav__link">
      Общие вопросы
    </a>
  </li>


        
      </ul>
    </nav>
  </li>


    
  </ul>
  

  <ul id="md-extra-nav" class="md-nav__list" data-md-scrollfix>
    <li class="md-nav__item md-nav__item--active">
      Релиз:
      <span class="md-selector">
        <select id="releases-selector">
          <option value="">последний</option>
          
            <option value="v20.1"
              
            >v20.1</option>
          
            <option value="v19.17"
              
                selected="selected"
              
            >v19.17</option>
          
            <option value="v19.16"
              
            >v19.16</option>
          
            <option value="v19.15"
              
            >v19.15</option>
          
            <option value="v19.14"
              
            >v19.14</option>
          
            <option value="v19.13"
              
            >v19.13</option>
          
            <option value="v19.11"
              
            >v19.11</option>
          
            <option value="v19.10"
              
            >v19.10</option>
          
            <option value="v19.9"
              
            >v19.9</option>
          
            <option value="v19.8"
              
            >v19.8</option>
          
            <option value="v19.7"
              
            >v19.7</option>
          
        </select><span id="releases-selector-after">&nbsp;▾</span>
      </span>
    </li>
    <li class="md-nav__item md-nav__item--active">
        
          <a href="../../single/" class="md-nav__link md-nav__link--active">Одностраничная версия</a>
        
    </li>
    <li class="md-nav__item md-nav__item--active">
          <a href="../../single/clickhouse_ru.pdf" class="md-nav__link md-nav__link--active">PDF версия</a>
    </li>
    
    <li class="md-nav__item md-nav__item--active">
      <a href="https://github.com/ClickHouse/ClickHouse/" rel="external nofollow" target="_blank" class="md-nav__link">
        Исходный код ClickHouse
      </a>
    </li>
    
    <li class="md-nav__item md-nav__item--active">
        <span id="md-sidebar-flags" class="md-nav__link">
        

  <a class="md-alt-lang"
     href="../../../en/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="English">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 60 30"><clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath><path fill="#00247d" d="M0,0 v30 h60 v-30 z"/><path stroke="#fff" stroke-width="6" d="M0,0 L60,30 M60,0 L0,30"/><path stroke="#cf142b" stroke-width="4" d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)"/><path stroke="#fff" stroke-width="10" d="M30,0 v30 M0,15 h60"/><path stroke="#cf142b" stroke-width="6" d="M30,0 v30 M0,15 h60"/></svg>
  </a>

  <a class="md-alt-lang md-current-lang"
     href="../../../ru/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Russian">
    <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" viewBox="0 0 9 6"><rect width="9" height="3" fill="#fff"/><rect width="9" height="3" y="3" fill="#d52b1e"/><rect width="9" height="2" y="2" fill="#0039a6"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../zh/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Chinese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 30 20"><defs><path id="s" fill="#ffde00" d="M0,-1 0.587785,0.809017 -0.951057,-0.309017H0.951057L-0.587785,0.809017z"/></defs><rect width="30" height="20" fill="#de2910"/><use transform="translate(5,5) scale(3)" xlink:href="#s"/><use transform="translate(10,2) rotate(23.036243)" xlink:href="#s"/><use transform="translate(12,4) rotate(45.869898)" xlink:href="#s"/><use transform="translate(12,7) rotate(69.945396)" xlink:href="#s"/><use transform="translate(10,9) rotate(20.659808)" xlink:href="#s"/></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../ja/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Japanese">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="90" height="60" version="1.1" viewBox="0 0 90 60"><g id="surface1"><rect width="90" height="60" x="0" y="0" fill="#A0A0A0" fill-opacity="1" stroke="none"/><path fill="#FFF" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 0.601562 0.601562 L 89.398438 0.601562 L 89.398438 59.398438 L 0.601562 59.398438 Z M 0.601562 0.601562"/><path fill="#BE0026" fill-opacity="1" fill-rule="nonzero" stroke="none" d="M 63 30 C 63 39.941406 54.941406 48 45 48 C 35.058594 48 27 39.941406 27 30 C 27 20.058594 35.058594 12 45 12 C 54.941406 12 63 20.058594 63 30 Z M 63 30"/></g></svg>
  </a>

  <a class="md-alt-lang"
     href="../../../fa/development/architecture/" class="md-flex__ellipsis md-header-nav__title"
     title="Farsi">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" viewBox="0 0 630 360"><rect width="630" height="360" fill="#da0000"/><rect width="630" height="240" fill="#fff"/><rect width="630" height="120" fill="#239f40"/><g transform="translate(8.4,100.4)"><g id="tb4"><g id="tb1" fill="none" stroke="#fff" stroke-width="2"><path id="tbp1" d="M0,1H26M1,10V5H9V9H17V5H12M4,9H6M26,9H21V5H29M29,0V9H37V0M33,0V9" transform="scale(1.4)"/><path id="tbp2" d="M0,7H9M10,7H19" transform="scale(2.8)"/><use y="120" xlink:href="#tbp2"/><use y="145.2" xlink:href="#tbp1"/></g><g id="tb3"><use x="56" xlink:href="#tb1"/><use x="112" xlink:href="#tb1"/><use x="168" xlink:href="#tb1"/></g></g><use x="168" xlink:href="#tb3"/><use x="392" xlink:href="#tb4"/></g><g fill="#da0000" transform="matrix(45,0,0,45,315,180)"><g id="emblem_half"><path d="M-0.54815,0.83638A0.912046,0.912046 0 0,0 0.328544,-0.722384A1,1 0 0,1 -0.54815,0.83638"/><path d="M0.618339,0.661409A0.763932,0.763932 0 0,0 0.421644,-0.741049A1,1 0 0,1 0.618339,0.661409"/><path d="M0,1 -0.05,0 0,-0.787278A0.309995,0.309995 0 0,0 0.118034,-0.688191V-0.100406L0.077809,0.892905z"/><path d="M-0.02,-0.85 0,-0.831217A0.14431,0.14431 0 0,0 0.252075,-0.967708A0.136408,0.136408 0 0,1 0,-0.924634"/></g><use transform="scale(-1,1)" xlink:href="#emblem_half"/></g></svg>
  </a>

        </span>
    </li>
  </ul>
</nav>
                    
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
                      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Содержание</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#columns" title="Columns" class="md-nav__link">
    Columns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field" title="Field" class="md-nav__link">
    Field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leaky-abstractions" title="Leaky Abstractions" class="md-nav__link">
    Leaky Abstractions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-types" title="Data Types" class="md-nav__link">
    Data Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#block" title="Block" class="md-nav__link">
    Block
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#block-streams" title="Block Streams" class="md-nav__link">
    Block Streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formats" title="Formats" class="md-nav__link">
    Formats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#i-o" title="I/O" class="md-nav__link">
    I/O
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tables" title="Tables" class="md-nav__link">
    Tables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsers" title="Parsers" class="md-nav__link">
    Parsers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpreters" title="Interpreters" class="md-nav__link">
    Interpreters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" title="Functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregate-functions" title="Aggregate Functions" class="md-nav__link">
    Aggregate Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server" title="Server" class="md-nav__link">
    Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-query-execution" title="Distributed Query Execution" class="md-nav__link">
    Distributed Query Execution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merge-tree" title="Merge Tree" class="md-nav__link">
    Merge Tree
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replication" title="Replication" class="md-nav__link">
    Replication
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                    
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  
                    <a href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/ru/development/architecture.md" title="Редактировать страницу" class="md-icon md-content__icon" rel="external nofollow">&#xE3C9;</a>
                  
                
                
                <div id="content">
                
                  <h1 id="overview-of-clickhouse-architecture">Overview of ClickHouse Architecture<a class="headerlink" href="#overview-of-clickhouse-architecture" title="Permanent link">&para;</a></h1>
<p>ClickHouse is a true column-oriented DBMS. Data is stored by columns, and during the execution of arrays (vectors or chunks of columns). Whenever possible, operations are dispatched on arrays, rather than on individual values. This is called "vectorized query execution," and it helps lower the cost of actual data processing.</p>
<blockquote>
<p>This idea is nothing new. It dates back to the <code>APL</code> programming language and its descendants: <code>A +</code>, <code>J</code>, <code>K</code>, and <code>Q</code>. Array programming is used in scientific data processing. Neither is this idea something new in relational databases: for example, it is used in the <code>Vectorwise</code> system.</p>
</blockquote>
<p>There are two different approaches for speeding up the query processing: vectorized query execution and runtime code generation. In the latter, the code is generated for every kind of query on the fly, removing all indirection and dynamic dispatch. Neither of these approaches is strictly better than the other. Runtime code generation can be better when it fuses many operations together, thus fully utilizing CPU execution units and the pipeline. Vectorized query execution can be less practical, because it involves temporary vectors that must be written to the cache and read back. If the temporary data does not fit in the L2 cache, this becomes an issue. But vectorized query execution more easily utilizes the SIMD capabilities of the CPU. A <a href="http://15721.courses.cs.cmu.edu/spring2016/papers/p5-sompolski.pdf" rel="external nofollow">research paper</a> written by our friends shows that it is better to combine both approaches. ClickHouse uses vectorized query execution and has limited initial support for runtime code generation.</p>
<h2 id="columns">Columns<a class="headerlink" href="#columns" title="Permanent link">&para;</a></h2>
<p>To represent columns in memory (actually, chunks of columns), the <code>IColumn</code> interface is used. This interface provides helper methods for implementation of various relational operators. Almost all operations are immutable: they do not modify the original column, but create a new modified one. For example, the <code>IColumn :: filter</code> method accepts a filter byte mask. It is used for the <code>WHERE</code> and <code>HAVING</code> relational operators. Additional examples: the <code>IColumn :: permute</code> method to support <code>ORDER BY</code>, the <code>IColumn :: cut</code> method to support <code>LIMIT</code>, and so on.</p>
<p>Various <code>IColumn</code> implementations (<code>ColumnUInt8</code>, <code>ColumnString</code> and so on) are responsible for the memory layout of columns. Memory layout is usually a contiguous array. For the integer type of columns it is just one contiguous array, like <code>std :: vector</code>. For <code>String</code> and <code>Array</code> columns, it is two vectors: one for all array elements, placed contiguously, and a second one for offsets to the beginning of each array. There is also <code>ColumnConst</code> that stores just one value in memory, but looks like a column.</p>
<h2 id="field">Field<a class="headerlink" href="#field" title="Permanent link">&para;</a></h2>
<p>Nevertheless, it is possible to work with individual values as well. To represent an individual value, the <code>Field</code> is used. <code>Field</code> is just a discriminated union of <code>UInt64</code>, <code>Int64</code>, <code>Float64</code>, <code>String</code> and <code>Array</code>. <code>IColumn</code> has the <code>operator[]</code> method to get the n-th value as a <code>Field</code>, and the <code>insert</code> method to append a <code>Field</code> to the end of a column. These methods are not very efficient, because they require dealing with temporary <code>Field</code> objects representing an individual value. There are more efficient methods, such as <code>insertFrom</code>, <code>insertRangeFrom</code>, and so on.</p>
<p><code>Field</code> doesn't have enough information about a specific data type for a table. For example, <code>UInt8</code>, <code>UInt16</code>, <code>UInt32</code>, and <code>UInt64</code> are all represented as <code>UInt64</code> in a <code>Field</code>.</p>
<h2 id="leaky-abstractions">Leaky Abstractions<a class="headerlink" href="#leaky-abstractions" title="Permanent link">&para;</a></h2>
<p><code>IColumn</code> has methods for common relational transformations of data, but they don't meet all needs. For example, <code>ColumnUInt64</code> doesn't have a method to calculate the sum of two columns, and <code>ColumnString</code> doesn't have a method to run a substring search. These countless routines are implemented outside of <code>IColumn</code>.</p>
<p>Various functions on columns can be implemented in a generic, non-efficient way using <code>IColumn</code> methods to extract <code>Field</code> values, or in a specialized way using knowledge of inner memory layout of data in a specific <code>IColumn</code> implementation. To do this, functions are cast to a specific <code>IColumn</code> type and deal with internal representation directly. For example, <code>ColumnUInt64</code> has the <code>getData</code> method that returns a reference to an internal array, then a separate routine reads or fills that array directly. In fact, we have "leaky abstractions" to allow efficient specializations of various routines.</p>
<h2 id="data-types">Data Types<a class="headerlink" href="#data-types" title="Permanent link">&para;</a></h2>
<p><code>IDataType</code> is responsible for serialization and deserialization: for reading and writing chunks of columns or individual values in binary or text form.
<code>IDataType</code> directly corresponds to data types in tables. For example, there are <code>DataTypeUInt32</code>, <code>DataTypeDateTime</code>, <code>DataTypeString</code> and so on.</p>
<p><code>IDataType</code> and <code>IColumn</code> are only loosely related to each other. Different data types can be represented in memory by the same <code>IColumn</code> implementations. For example, <code>DataTypeUInt32</code> and <code>DataTypeDateTime</code> are both represented by <code>ColumnUInt32</code> or <code>ColumnConstUInt32</code>. In addition, the same data type can be represented by different <code>IColumn</code> implementations. For example, <code>DataTypeUInt8</code> can be represented by <code>ColumnUInt8</code> or <code>ColumnConstUInt8</code>.</p>
<p><code>IDataType</code> only stores metadata. For instance, <code>DataTypeUInt8</code> doesn't store anything at all (except vptr) and <code>DataTypeFixedString</code> stores just <code>N</code> (the size of fixed-size strings).</p>
<p><code>IDataType</code> has helper methods for various data formats. Examples are methods to serialize a value with possible quoting, to serialize a value for JSON, and to serialize a value as part of XML format. There is no direct correspondence to data formats. For example, the different data formats <code>Pretty</code> and <code>TabSeparated</code> can use the same <code>serializeTextEscaped</code> helper method from the <code>IDataType</code> interface.</p>
<h2 id="block">Block<a class="headerlink" href="#block" title="Permanent link">&para;</a></h2>
<p>A <code>Block</code> is a container that represents a subset (chunk) of a table in memory. It is just a set of triples: <code>(IColumn, IDataType, column name)</code>. During query execution, data is processed by <code>Block</code>s. If we have a <code>Block</code>, we have data (in the <code>IColumn</code> object), we have information about its type (in <code>IDataType</code>) that tells us how to deal with that column, and we have the column name (either the original column name from the table, or some artificial name assigned for getting temporary results of calculations).</p>
<p>When we calculate some function over columns in a block, we add another column with its result to the block, and we don't touch columns for arguments of the function because operations are immutable. Later, unneeded columns can be removed from the block, but not modified. This is convenient for elimination of common subexpressions.</p>
<p>Blocks are created for every processed chunk of data. Note that for the same type of calculation, the column names and types remain the same for different blocks, and only column data changes. It is better to split block data from the block header, because small block sizes will have a high overhead of temporary strings for copying shared_ptrs and column names.</p>
<h2 id="block-streams">Block Streams<a class="headerlink" href="#block-streams" title="Permanent link">&para;</a></h2>
<p>Block streams are for processing data. We use streams of blocks to read data from somewhere, perform data transformations, or write data to somewhere. <code>IBlockInputStream</code> has the <code>read</code> method to fetch the next block while available. <code>IBlockOutputStream</code> has the <code>write</code> method to push the block somewhere.</p>
<p>Streams are responsible for:</p>
<ol>
<li>Reading or writing to a table. The table just returns a stream for reading or writing blocks.</li>
<li>Implementing data formats. For example, if you want to output data to a terminal in <code>Pretty</code> format, you create a block output stream where you push blocks, and it formats them.</li>
<li>Performing data transformations. Let's say you have <code>IBlockInputStream</code> and want to create a filtered stream. You create <code>FilterBlockInputStream</code> and initialize it with your stream. Then when you pull a block from <code>FilterBlockInputStream</code>, it pulls a block from your stream, filters it, and returns the filtered block to you. Query execution pipelines are represented this way.</li>
</ol>
<p>There are more sophisticated transformations. For example, when you pull from <code>AggregatingBlockInputStream</code>, it reads all data from its source, aggregates it, and then returns a stream of aggregated data for you. Another example: <code>UnionBlockInputStream</code> accepts many input sources in the constructor and also a number of threads. It launches multiple threads and reads from multiple sources in parallel.</p>
<blockquote>
<p>Block streams use the "pull" approach to control flow: when you pull a block from the first stream, it consequently pulls the required blocks from nested streams, and the entire execution pipeline will work. Neither "pull" nor "push" is the best solution, because control flow is implicit, and that limits implementation of various features like simultaneous execution of multiple queries (merging many pipelines together). This limitation could be overcome with coroutines or just running extra threads that wait for each other. We may have more possibilities if we make control flow explicit: if we locate the logic for passing data from one calculation unit to another outside of those calculation units. Read this <a href="http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/" rel="external nofollow">article</a> for more thoughts.</p>
</blockquote>
<p>We should note that the query execution pipeline creates temporary data at each step. We try to keep block size small enough so that temporary data fits in the CPU cache. With that assumption, writing and reading temporary data is almost free in comparison with other calculations. We could consider an alternative, which is to fuse many operations in the pipeline together, to make the pipeline as short as possible and remove much of the temporary data. This could be an advantage, but it also has drawbacks. For example, a split pipeline makes it easy to implement caching intermediate data, stealing intermediate data from similar queries running at the same time, and merging pipelines for similar queries.</p>
<h2 id="formats">Formats<a class="headerlink" href="#formats" title="Permanent link">&para;</a></h2>
<p>Data formats are implemented with block streams. There are "presentational" formats only suitable for output of data to the client, such as <code>Pretty</code> format, which provides only <code>IBlockOutputStream</code>. And there are input/output formats, such as <code>TabSeparated</code> or <code>JSONEachRow</code>.</p>
<p>There are also row streams: <code>IRowInputStream</code> and <code>IRowOutputStream</code>. They allow you to pull/push data by individual rows, not by blocks. And they are only needed to simplify implementation of row-oriented formats. The wrappers <code>BlockInputStreamFromRowInputStream</code> and <code>BlockOutputStreamFromRowOutputStream</code> allow you to convert row-oriented streams to regular block-oriented streams.</p>
<h2 id="i-o">I/O<a class="headerlink" href="#i-o" title="Permanent link">&para;</a></h2>
<p>For byte-oriented input/output, there are <code>ReadBuffer</code> and <code>WriteBuffer</code> abstract classes. They are used instead of C++ <code>iostream</code>s. Don't worry: every mature C++ project is using something other than <code>iostream</code>s for good reasons.</p>
<p><code>ReadBuffer</code> and <code>WriteBuffer</code> are just a contiguous buffer and a cursor pointing to the position in that buffer. Implementations may own or not own the memory for the buffer. There is a virtual method to fill the buffer with the following data (for <code>ReadBuffer</code>) or to flush the buffer somewhere (for <code>WriteBuffer</code>). The virtual methods are rarely called.</p>
<p>Implementations of <code>ReadBuffer</code>/<code>WriteBuffer</code> are used for working with files and file descriptors and network sockets, for implementing compression (<code>CompressedWriteBuffer</code> is initialized with another WriteBuffer and performs compression before writing data to it), and for other purposes – the names <code>ConcatReadBuffer</code>, <code>LimitReadBuffer</code>, and <code>HashingWriteBuffer</code> speak for themselves.</p>
<p>Read/WriteBuffers only deal with bytes. To help with formatted input/output (for instance, to write a number in decimal format), there are functions from <code>ReadHelpers</code> and <code>WriteHelpers</code> header files.</p>
<p>Let's look at what happens when you want to write a result set in <code>JSON</code> format to stdout. You have a result set ready to be fetched from <code>IBlockInputStream</code>. You create <code>WriteBufferFromFileDescriptor(STDOUT_FILENO)</code> to write bytes to stdout. You create <code>JSONRowOutputStream</code>, initialized with that <code>WriteBuffer</code>, to write rows in <code>JSON</code> to stdout. You create <code>BlockOutputStreamFromRowOutputStream</code> on top of it, to represent it as <code>IBlockOutputStream</code>. Then you call <code>copyData</code> to transfer data from <code>IBlockInputStream</code> to <code>IBlockOutputStream</code>, and everything works. Internally, <code>JSONRowOutputStream</code> will write various JSON delimiters and call the <code>IDataType::serializeTextJSON</code> method with a reference to <code>IColumn</code> and the row number as arguments. Consequently, <code>IDataType::serializeTextJSON</code> will call a method from <code>WriteHelpers.h</code>: for example, <code>writeText</code> for numeric types and <code>writeJSONString</code> for <code>DataTypeString</code>.</p>
<h2 id="tables">Tables<a class="headerlink" href="#tables" title="Permanent link">&para;</a></h2>
<p>Tables are represented by the <code>IStorage</code> interface. Different implementations of that interface are different table engines. Examples are <code>StorageMergeTree</code>, <code>StorageMemory</code>, and so on. Instances of these classes are just tables.</p>
<p>The most important <code>IStorage</code> methods are <code>read</code> and <code>write</code>. There are also <code>alter</code>, <code>rename</code>, <code>drop</code>, and so on. The <code>read</code> method accepts the following arguments: the set of columns to read from a table, the <code>AST</code> query to consider, and the desired number of streams to return. It returns one or multiple <code>IBlockInputStream</code> objects and information about the stage of data processing that was completed inside a table engine during query execution.</p>
<p>In most cases, the read method is only responsible for reading the specified columns from a table, not for any further data processing. All further data processing is done by the query interpreter and is outside the responsibility of <code>IStorage</code>.</p>
<p>But there are notable exceptions:</p>
<ul>
<li>The AST query is passed to the <code>read</code> method and the table engine can use it to derive index usage and to read less data from a table.</li>
<li>Sometimes the table engine can process data itself to a specific stage. For example, <code>StorageDistributed</code> can send a query to remote servers, ask them to process data to a stage where data from different remote servers can be merged, and return that preprocessed data.
The query interpreter then finishes processing the data.</li>
</ul>
<p>The table's <code>read</code> method can return multiple <code>IBlockInputStream</code> objects to allow parallel data processing. These multiple block input streams can read from a table in parallel. Then you can wrap these streams with various transformations (such as expression evaluation or filtering) that can be calculated independently and create a <code>UnionBlockInputStream</code> on top of them, to read from multiple streams in parallel.</p>
<p>There are also <code>TableFunction</code>s. These are functions that return a temporary <code>IStorage</code> object to use in the <code>FROM</code> clause of a query.</p>
<p>To get a quick idea of how to implement your own table engine, look at something simple, like <code>StorageMemory</code> or <code>StorageTinyLog</code>.</p>
<blockquote>
<p>As the result of the <code>read</code> method, <code>IStorage</code> returns <code>QueryProcessingStage</code> – information about what parts of the query were already calculated inside storage. Currently we have only very coarse granularity for that information. There is no way for the storage to say "I have already processed this part of the expression in WHERE, for this range of data". We need to work on that.</p>
</blockquote>
<h2 id="parsers">Parsers<a class="headerlink" href="#parsers" title="Permanent link">&para;</a></h2>
<p>A query is parsed by a hand-written recursive descent parser. For example, <code>ParserSelectQuery</code> just recursively calls the underlying parsers for various parts of the query. Parsers create an <code>AST</code>. The <code>AST</code> is represented by nodes, which are instances of <code>IAST</code>.</p>
<blockquote>
<p>Parser generators are not used for historical reasons.</p>
</blockquote>
<h2 id="interpreters">Interpreters<a class="headerlink" href="#interpreters" title="Permanent link">&para;</a></h2>
<p>Interpreters are responsible for creating the query execution pipeline from an <code>AST</code>. There are simple interpreters, such as <code>InterpreterExistsQuery</code>and <code>InterpreterDropQuery</code>, or the more sophisticated <code>InterpreterSelectQuery</code>. The query execution pipeline is a combination of block input or output streams. For example, the result of interpreting the <code>SELECT</code> query is the <code>IBlockInputStream</code> to read the result set from; the result of the INSERT query is the <code>IBlockOutputStream</code> to write data for insertion to; and the result of interpreting the <code>INSERT SELECT</code> query is the <code>IBlockInputStream</code> that returns an empty result set on the first read, but that copies data from <code>SELECT</code> to <code>INSERT</code> at the same time.</p>
<p><code>InterpreterSelectQuery</code> uses <code>ExpressionAnalyzer</code> and <code>ExpressionActions</code> machinery for query analysis and transformations. This is where most rule-based query optimizations are done. <code>ExpressionAnalyzer</code> is quite messy and should be rewritten: various query transformations and optimizations should be extracted to separate classes to allow modular transformations or query.</p>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<p>There are ordinary functions and aggregate functions. For aggregate functions, see the next section.</p>
<p>Ordinary functions don't change the number of rows – they work as if they are processing each row independently. In fact, functions are not called for individual rows, but for <code>Block</code>'s of data to implement vectorized query execution.</p>
<p>There are some miscellaneous functions, like <a href="../../query_language/functions/other_functions/#function-blocksize">blockSize</a>, <a href="../../query_language/functions/other_functions/#function-rownumberinblock">rowNumberInBlock</a>, and <a href="../../query_language/functions/other_functions/#function-runningaccumulate">runningAccumulate</a>, that exploit block processing and violate the independence of rows.</p>
<p>ClickHouse has strong typing, so implicit type conversion doesn't occur. If a function doesn't support a specific combination of types, an exception will be thrown. But functions can work (be overloaded) for many different combinations of types. For example, the <code>plus</code> function (to implement the <code>+</code> operator) works for any combination of numeric types: <code>UInt8</code> + <code>Float32</code>, <code>UInt16</code> + <code>Int8</code>, and so on. Also, some variadic functions can accept any number of arguments, such as the <code>concat</code> function.</p>
<p>Implementing a function may be slightly inconvenient because a function explicitly dispatches supported data types and supported <code>IColumns</code>. For example, the <code>plus</code> function has code generated by instantiation of a C++ template for each combination of numeric types, and for constant or non-constant left and right arguments.</p>
<blockquote>
<p>This is a nice place to implement runtime code generation to avoid template code bloat. Also, it will make it possible to add fused functions like fused multiply-add, or to make multiple comparisons in one loop iteration.</p>
</blockquote>
<p>Due to vectorized query execution, functions are not short-circuit. For example, if you write <code>WHERE f(x) AND g(y)</code>, both sides will be calculated, even for rows, when <code>f(x)</code> is zero (except when <code>f(x)</code> is a zero constant expression). But if selectivity of the <code>f(x)</code> condition is high, and calculation of <code>f(x)</code> is much cheaper than <code>g(y)</code>, it's better to implement multi-pass calculation: first calculate <code>f(x)</code>, then filter columns by the result, and then calculate <code>g(y)</code> only for smaller, filtered chunks of data.</p>
<h2 id="aggregate-functions">Aggregate Functions<a class="headerlink" href="#aggregate-functions" title="Permanent link">&para;</a></h2>
<p>Aggregate functions are stateful functions. They accumulate passed values into some state, and allow you to get results from that state. They are managed with the <code>IAggregateFunction</code> interface. States can be rather simple (the state for <code>AggregateFunctionCount</code> is just a single <code>UInt64</code> value) or quite complex (the state of <code>AggregateFunctionUniqCombined</code> is a combination of a linear array, a hash table and a <code>HyperLogLog</code> probabilistic data structure).</p>
<p>To deal with multiple states while executing a high-cardinality <code>GROUP BY</code> query, states are allocated in <code>Arena</code> (a memory pool), or they could be allocated in any suitable piece of memory. States can have a non-trivial constructor and destructor: for example, complex aggregation states can allocate additional memory themselves. This requires some attention to creating and destroying states and properly passing their ownership, to keep track of who and when will destroy states.</p>
<p>Aggregation states can be serialized and deserialized to pass over the network during distributed query execution or to write them on disk where there is not enough RAM. They can even be stored in a table with the <code>DataTypeAggregateFunction</code> to allow incremental aggregation of data.</p>
<blockquote>
<p>The serialized data format for aggregate function states is not versioned right now. This is ok if aggregate states are only stored temporarily. But we have the <code>AggregatingMergeTree</code> table engine for incremental aggregation, and people are already using it in production. This is why we should add support for backward compatibility when changing the serialized format for any aggregate function in the future.</p>
</blockquote>
<h2 id="server">Server<a class="headerlink" href="#server" title="Permanent link">&para;</a></h2>
<p>The server implements several different interfaces:</p>
<ul>
<li>An HTTP interface for any foreign clients.</li>
<li>A TCP interface for the native ClickHouse client and for cross-server communication during distributed query execution.</li>
<li>An interface for transferring data for replication.</li>
</ul>
<p>Internally, it is just a basic multithreaded server without coroutines, fibers, etc. Since the server is not designed to process a high rate of simple queries but is intended to process a relatively low rate of complex queries, each of them can process a vast amount of data for analytics.</p>
<p>The server initializes the <code>Context</code> class with the necessary environment for query execution: the list of available databases, users and access rights, settings, clusters, the process list, the query log, and so on. This environment is used by interpreters.</p>
<p>We maintain full backward and forward compatibility for the server TCP protocol: old clients can talk to new servers and new clients can talk to old servers. But we don't want to maintain it eternally, and we are removing support for old versions after about one year.</p>
<blockquote>
<p>For all external applications, we recommend using the HTTP interface because it is simple and easy to use. The TCP protocol is more tightly linked to internal data structures: it uses an internal format for passing blocks of data and it uses custom framing for compressed data. We haven't released a C library for that protocol because it requires linking most of the ClickHouse codebase, which is not practical.</p>
</blockquote>
<h2 id="distributed-query-execution">Distributed Query Execution<a class="headerlink" href="#distributed-query-execution" title="Permanent link">&para;</a></h2>
<p>Servers in a cluster setup are mostly independent. You can create a <code>Distributed</code> table on one or all servers in a cluster. The <code>Distributed</code> table does not store data itself – it only provides a "view" to all local tables on multiple nodes of a cluster. When you SELECT from a <code>Distributed</code> table, it rewrites that query, chooses remote nodes according to load balancing settings, and sends the query to them. The <code>Distributed</code> table requests remote servers to process a query just up to a stage where intermediate results from different servers can be merged. Then it receives the intermediate results and merges them. The distributed table tries to distribute as much work as possible to remote servers, and does not send much intermediate data over the network.</p>
<blockquote>
<p>Things become more complicated when you have subqueries in IN or JOIN clauses and each of them uses a <code>Distributed</code> table. We have different strategies for execution of these queries.</p>
</blockquote>
<p>There is no global query plan for distributed query execution. Each node has its own local query plan for its part of the job. We only have simple one-pass distributed query execution: we send queries for remote nodes and then merge the results. But this is not feasible for difficult queries with high cardinality GROUP BYs or with a large amount of temporary data for JOIN: in such cases, we need to "reshuffle" data between servers, which requires additional coordination. ClickHouse does not support that kind of query execution, and we need to work on it.</p>
<h2 id="merge-tree">Merge Tree<a class="headerlink" href="#merge-tree" title="Permanent link">&para;</a></h2>
<p><code>MergeTree</code> is a family of storage engines that supports indexing by primary key. The primary key can be an arbitrary tuple of columns or expressions. Data in a <code>MergeTree</code> table is stored in "parts". Each part stores data in the primary key order (data is ordered lexicographically by the primary key tuple). All the table columns are stored in separate <code>column.bin</code> files in these parts. The files consist of compressed blocks. Each block is usually from 64 KB to 1 MB of uncompressed data, depending on the average value size. The blocks consist of column values placed contiguously one after the other. Column values are in the same order for each column (the order is defined by the primary key), so when you iterate by many columns, you get values for the corresponding rows.</p>
<p>The primary key itself is "sparse". It doesn't address each single row, but only some ranges of data. A separate <code>primary.idx</code> file has the value of the primary key for each N-th row, where N is called <code>index_granularity</code> (usually, N = 8192). Also, for each column, we have <code>column.mrk</code> files with "marks," which are offsets to each N-th row in the data file. Each mark is a pair: the offset in the file to the beginning of the compressed block, and the offset in the decompressed block to the beginning of data. Usually compressed blocks are aligned by marks, and the offset in the decompressed block is zero. Data for <code>primary.idx</code> always resides in memory and data for <code>column.mrk</code> files is cached.</p>
<p>When we are going to read something from a part in <code>MergeTree</code>, we look at <code>primary.idx</code> data and locate ranges that could possibly contain requested data, then look at <code>column.mrk</code> data and calculate offsets for where to start reading those ranges. Because of sparseness, excess data may be read. ClickHouse is not suitable for a high load of simple point queries, because the entire range with <code>index_granularity</code> rows must be read for each key, and the entire compressed block must be decompressed for each column. We made the index sparse because we must be able to maintain trillions of rows per single server without noticeable memory consumption for the index. Also, because the primary key is sparse, it is not unique: it cannot check the existence of the key in the table at INSERT time. You could have many rows with the same key in a table.</p>
<p>When you <code>INSERT</code> a bunch of data into <code>MergeTree</code>, that bunch is sorted by primary key order and forms a new part. To keep the number of parts relatively low, there are background threads that periodically select some parts and merge them to a single sorted part. That's why it is called <code>MergeTree</code>. Of course, merging leads to "write amplification". All parts are immutable: they are only created and deleted, but not modified. When SELECT is run, it holds a snapshot of the table (a set of parts). After merging, we also keep old parts for some time to make recovery after failure easier, so if we see that some merged part is probably broken, we can replace it with its source parts.</p>
<p><code>MergeTree</code> is not an LSM tree because it doesn't contain "memtable" and "log": inserted data is written directly to the filesystem. This makes it suitable only to INSERT data in batches, not by individual row and not very frequently – about once per second is ok, but a thousand times a second is not. We did it this way for simplicity's sake, and because we are already inserting data in batches in our applications.</p>
<blockquote>
<p>MergeTree tables can only have one (primary) index: there aren't any secondary indices. It would be nice to allow multiple physical representations under one logical table, for example, to store data in more than one physical order or even to allow representations with pre-aggregated data along with original data.</p>
</blockquote>
<p>There are MergeTree engines that are doing additional work during background merges. Examples are <code>CollapsingMergeTree</code> and <code>AggregatingMergeTree</code>. This could be treated as special support for updates. Keep in mind that these are not real updates because users usually have no control over the time when background merges will be executed, and data in a <code>MergeTree</code> table is almost always stored in more than one part, not in completely merged form.</p>
<h2 id="replication">Replication<a class="headerlink" href="#replication" title="Permanent link">&para;</a></h2>
<p>Replication in ClickHouse is implemented on a per-table basis. You could have some replicated and some non-replicated tables on the same server. You could also have tables replicated in different ways, such as one table with two-factor replication and another with three-factor.</p>
<p>Replication is implemented in the <code>ReplicatedMergeTree</code> storage engine. The path in <code>ZooKeeper</code> is specified as a parameter for the storage engine. All tables with the same path in <code>ZooKeeper</code> become replicas of each other: they synchronize their data and maintain consistency. Replicas can be added and removed dynamically simply by creating or dropping a table.</p>
<p>Replication uses an asynchronous multi-master scheme. You can insert data into any replica that has a session with <code>ZooKeeper</code>, and data is replicated to all other replicas asynchronously. Because ClickHouse doesn't support UPDATEs, replication is conflict-free. As there is no quorum acknowledgment of inserts, just-inserted data might be lost if one node fails.</p>
<p>Metadata for replication is stored in ZooKeeper. There is a replication log that lists what actions to do. Actions are: get part; merge parts; drop partition, etc. Each replica copies the replication log to its queue and then executes the actions from the queue. For example, on insertion, the "get part" action is created in the log, and every replica downloads that part. Merges are coordinated between replicas to get byte-identical results. All parts are merged in the same way on all replicas. To achieve this, one replica is elected as the leader, and that replica initiates merges and writes "merge parts" actions to the log.</p>
<p>Replication is physical: only compressed parts are transferred between nodes, not queries. To lower the network cost (to avoid network amplification), merges are processed on each replica independently in most cases. Large merged parts are sent over the network only in cases of significant replication lag.</p>
<p>In addition, each replica stores its state in ZooKeeper as the set of parts and its checksums. When the state on the local filesystem diverges from the reference state in ZooKeeper, the replica restores its consistency by downloading missing and broken parts from other replicas. When there is some unexpected or broken data in the local filesystem, ClickHouse does not remove it, but moves it to a separate directory and forgets it.</p>
<blockquote>
<p>The ClickHouse cluster consists of independent shards, and each shard consists of replicas. The cluster is not elastic, so after adding a new shard, data is not rebalanced between shards automatically. Instead, the cluster load will be uneven. This implementation gives you more control, and it is fine for relatively small clusters such as tens of nodes. But for clusters with hundreds of nodes that we are using in production, this approach becomes a significant drawback. We should implement a table engine that will span its data across the cluster with dynamically replicated regions that could be split and balanced between clusters automatically.</p>
</blockquote>
                
                </div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
          <a href="../../operations/utils/clickhouse-local/" title="clickhouse-local" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Назад
                </span>
                clickhouse-local
              </span>
            </div>
          </a>
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
          <a href="../../development/build/" title="Как собрать ClickHouse на Linux" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Вперед
                </span>
                Как собрать ClickHouse на Linux
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            ©2016–2020 Yandex LLC
          </div>
        
      </div>
      
        <div class="md-footer-social">
  <span class="md-footer-copyright__highlight">Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/b34fe924267ab72357cf81044fddaf6b3f336e43" rel="external nofollow">b34fe92</a></span>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      
        <script src="../../assets/javascripts/modernizr.js"></script>
      
      <script src="../../assets/javascripts/application.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              <script src="../../assets/javascripts/lunr/lunr.ru.js"></script>
            
          
          
            <script src="../../assets/javascripts/lunr/lunr.multi.js"></script>
          
        
      
      
    
    
      
    

    <script type="text/javascript">
      function ready(callback){
          if (document.readyState != 'loading') {
              callback();
          } else if (document.addEventListener) {
              document.addEventListener('DOMContentLoaded', callback);
          } else document.attachEvent('onreadystatechange', function() {
              if (document.readyState == 'complete') {
                  callback();
              }
          });
      }
      ready(function () {
          var i;
          
          app.initialize({
              version: "1.0.4",
              url: {
                  base: "../.."
              }
          });
          var beforePrint = function() {
            var details = document.getElementsByTagName("details");
            for (i = 0; i < details.length; ++i) {
                details[i].open = 1;
            }
          };
          if (window.matchMedia) {
              window.matchMedia('print').addListener(function(q) {
                  if (q.matches) {
                      beforePrint();
                  }
              });
          }
          window.onbeforeprint = beforePrint;

          var name = window.location.hostname.split('.')[0];
          var feedback_address = name + '-feedback' + '@yandex-team.ru';
          var feedback_email = document.getElementsByClassName('feedback-email');
          for (i = 0; i < feedback_email.length; i++) {
            feedback_email[i].setAttribute('href', 'mailto:' + feedback_address);
            feedback_email[i].innerHTML = feedback_address;
          }

          document.getElementById("releases-selector").addEventListener(
            "change",
            function() {
              var target = window.location.href.split('docs')[0] + 'docs/';
              if (this.value) {
                target = target + this.value + '/';
              }
              window.location = target + 'ru';
            }
          )
      });
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script type="text/javascript"> docsearch({
apiKey: 'e239649803024433599de47a53b2d416',
indexName: 'yandex_clickhouse',
inputSelector: '#md-search__input',
algoliaOptions: {
  advancedSyntax: true,
  clickAnalytics: true,
  hitsPerPage: 25,
  'facetFilters': ["lang:ru"]
},
debug: false
});
</script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter18343495 = new Ya.Metrika2({
                        id:18343495,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor: true
                    });
                } catch(e) { }
            });
            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/tag.js";
            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks2");
    </script>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/18343495" style="position:absolute; left:-9999px;" alt=""/></div>
    </noscript>
    <!-- /Yandex.Metrika counter -->
  </body>
</html>